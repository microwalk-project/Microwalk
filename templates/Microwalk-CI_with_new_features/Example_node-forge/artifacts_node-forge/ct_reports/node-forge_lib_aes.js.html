<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CQR visualizer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
	<meta http-equiv="content-security-policy" content="script-src 'unsafe-inline'">
	<style>
		html, body, div, span, applet, object, iframe,
		h1, h2, h3, h4, h5, h6, p, blockquote, pre,
		a, abbr, acronym, address, big, cite, code,
		del, dfn, em, img, ins, kbd, q, s, samp,
		small, strike, strong, sub, sup, tt, var,
		b, u, i, center,
		dl, dt, dd, ol, ul, li,
		fieldset, form, label, legend,
		table, caption, tbody, tfoot, thead, tr, th, td,
		article, aside, canvas, details, embed,
		figure, figcaption, footer, header, hgroup,
		menu, nav, output, ruby, section, summary,
		time, mark, audio, video {
			margin: 0;
			padding: 0;
			border: 0;
			font-size: 100%;
			font: inherit;
			vertical-align: baseline;
		}
		/* HTML5 display-role reset for older browsers */
		article, aside, details, figcaption, figure,
		footer, header, hgroup, menu, nav, section {
			display: block;
		}
		header {
            position : static;
        }
		body {
			line-height: 1;
		}
		ol, ul {
			list-style: none;
		}
		blockquote, q {
			quotes: none;
		}
		blockquote:before, blockquote:after,
		q:before, q:after {
			content: '';
			content: none;
		}
		table {
			border-collapse: collapse;
			border-spacing: 0;
		}

		:root {
			--accent-color: #DC8ADD78;
            --height: 12px;
		}
		body {
			font-family: monospace;
		}
		header {
    		background-color: var(--accent-color);
    		color: black;
    		margin-bottom: 1em;
    		padding: 1em 3em;
    		font-size: 20px;
    	}
    	code {
    		white-space: break-spaces;
    	}

        .header-text {
            font-size: 0.6em;
        }

    	.line-number {
    		text-align: right;
    		display: inline-block;
    		min-width: 4em;
    		margin-right: 8px;
    		border-right: 4px solid var(--accent-color);
    		padding-right: 8px;
    	}
    	.line-number, code {
    		padding-top: 2px;
    		padding-bottom: 2px;
    	}
    	.issue-line .line-number {
    		background-color: #ff00008f;
    	}
    	.issue-inline-message {
    		background-color: #e8e3e8;
			margin: 5px 0;
    		padding: 1em 5em;
    		border-top: 1px solid #4E464E;
    		border-bottom: 1px solid #4E464E;
    	}
    	.issue-inline-message > details {
    		font-weight: bold;
    		margin-bottom: 1em;
    	}
    	.issue-inline-message.issue-critical > summary {
    		color: #C81E1E;
    	}
    	.issue-inline-message.issue-major > summary {
    		color: #AD5100;
    	}
    	.issue-inline-message.issue-minor > summary {
    		color: #615900;
    	}
    	p {
    		font-size: 0.em;
    		margin-top: 0.5em;
    	}
    	h1 {
    	    font-size: 2em;
            margin-bottom: 0.2em;

    	}
    	.In-the-target {
    	    font-size: 0.7em;
    	}
    	details {
            border-radius: 4px;
            padding: 0.5em 0.5em 0;
        }
        summary {
            font-weight: bold;
            margin: -0.5em -0.5em 0;
            padding: 0.5em;
        }
        details.header-issue-counter[open] {
            padding: 0.5em;
        }
        details.issue-inline-message[open] {
            background-color: #c5299e24;
            padding: 1em 5em;
            /*margin-bottom: 1em;*/
        }
        details.header-issue-counter[open] summary {
            border-bottom: 1px solid black;
            margin-bottom: 0.5em;
        }
        details.issue-inline-message[open] summary {
            /*background-color: #c5299e24;*/
    		margin-bottom: 1em;
        }
        i {
            color: black;
        }
        input[type="checkbox"] {
			accent-color: black;
		}
		button {
		    border: 0;
            line-height: 2.5;
            padding: 0 20px;
            font-size: 1rem;
            text-align: center;
            color: #fff;
            text-shadow: 1px 1px 1px #000;
            border-radius: 10px;
            background-color: rgba(220, 0, 0, 1);
            background-image: linear-gradient(to top left, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2) 30%, rgba(0, 0, 0, 0));
            box-shadow: inset 2px 2px 3px rgba(255, 255, 255, 0.6), inset -2px -2px 3px rgba(0, 0, 0, 0.6);
		}
		.deploy-button:hover {
            background-color: rgba(255, 0, 0, 1);
        }

        .deploy-button:active {
            box-shadow: inset -2px -2px 3px rgba(255, 255, 255, 0.6), inset 2px 2px 3px rgba(0, 0, 0, 0.6);
        }

        .cstat-no {
          background: #F6C6CE;
        }
        .line-number2 {
    		text-align: right;
    		display: inline-block;
    		min-width: 4em;
    		padding-right: 8px;
            border-right: 4px solid var(--accent-color);
    	}
    	.line-number2, code {
    		padding-top: 2px;
    		padding-bottom: 2px;
    	}
    	.source-line {
        }
        .line-counter {
    		text-align: center;
    		display: inline-block;

            height: var(--height);
    		min-width: 4em;
    		margin-right: 8px;
    		border-right: 4px
    		padding-right: 8px;
    	}

        .cline-yes {
          background: rgb(230,245,208);
          padding-top: 2px;
          padding-bottom: 2px;
        }

        .cline-no {
          background: #FCE1E5;
          padding-top: 2px;
          padding-bottom: 2px;
        }

        .header-option{
          line-height: 1;
        }

        .filter-inputs {
            display: flex;
            align-items: center;
            margin-bottom: 0.5em;
        }
        
        .button-container {
            flex: 0 0 auto;
            margin-right: 20px; 
            display: flex;
            align-items: center;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
        }
        
        .severity-options, .issue-type-options {
            margin-top: 1px;
        }

    </style>
  </head>
  <body>
  <div class="grid-container">
    <div class="head">
    <header>
<h1>node-forge/lib/aes.js</h1>
        <div class="filter-inputs">
            <div class="button-container">
                <button onclick="change()" title="Click here to expand or collapse all leak details!" class="deploy-button" Id="button1"> Deploy leak details </button>
            </div>
            <div class="options-container">
                <div class="severity-options">
                    <span class="header-option">Severity:</span>
                    <label><input type="checkbox" name="severity-critical" > Critical</label>
                    <label><input type="checkbox" name="severity-major" > Major</label>
                    <label><input type="checkbox" name="severity-minor" > Minor</label>
                </div>
                <div class="issue-type-options">
                    <span>Issue type:</span>
                    <label><input type="checkbox" name="issue-type-memory-access" > Memory access</label>
                    <label><input type="checkbox" name="issue-type-branch" > Branch</label>
                </div>
            </div>
        </div>
        <p class="header-text">Total number of problem found: 72 out of 180</p>
        <p class="header-text">Number of critical in file: 72   ≅ 100%</p>
        <p class="header-text">Number of memory access error in file: 72   ≅ 100%</p>
        <p class="header-text">Coverage proportion (on the number of character): 3357 / 37934   ≅ 9%</p>
        <p class="header-text">Coverage proportion (on the number of line): 148 / 1091   ≅ 14%</p><details open class="header-issue-counter"><summary class="In-the-target"><name="target-ECB" Id="ECB" <h2>In the target-ECB</h2></summary>
            <p class="header-text">Number of problem found: 36</p>
            <p class="header-text">Number of critical: 36   ≅ 100%</p>
            <p class="header-text">Number of memory access error: 36   ≅ 100%</p></details><details open class="header-issue-counter"><summary class="In-the-target"><name="target-GCM" Id="GCM" <h2>In the target-GCM</h2></summary>
            <p class="header-text">Number of problem found: 36</p>
            <p class="header-text">Number of critical: 36   ≅ 100%</p>
            <p class="header-text">Number of memory access error: 36   ≅ 100%</p></details>
    </header>
    </div><div class="source-line"><span class="line-number ">1</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">2</span><span class="line-counter cline-yes">&nbsp</span><code> * Advanced Encryption Standard (AES) implementation.</code></div>
<div class="source-line"><span class="line-number ">3</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">4</span><span class="line-counter cline-yes">&nbsp</span><code> * This implementation is based on the public domain library &#39;jscrypto&#39; which</code></div>
<div class="source-line"><span class="line-number ">5</span><span class="line-counter cline-yes">&nbsp</span><code> * was written by:</code></div>
<div class="source-line"><span class="line-number ">6</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">7</span><span class="line-counter cline-yes">&nbsp</span><code> * Emily Stark (estark@stanford.edu)</code></div>
<div class="source-line"><span class="line-number ">8</span><span class="line-counter cline-yes">&nbsp</span><code> * Mike Hamburg (mhamburg@stanford.edu)</code></div>
<div class="source-line"><span class="line-number ">9</span><span class="line-counter cline-yes">&nbsp</span><code> * Dan Boneh (dabo@cs.stanford.edu)</code></div>
<div class="source-line"><span class="line-number ">10</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">11</span><span class="line-counter cline-yes">&nbsp</span><code> * Parts of this code are based on the OpenSSL implementation of AES:</code></div>
<div class="source-line"><span class="line-number ">12</span><span class="line-counter cline-yes">&nbsp</span><code> * http://www.openssl.org</code></div>
<div class="source-line"><span class="line-number ">13</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">14</span><span class="line-counter cline-yes">&nbsp</span><code> * @author Dave Longley</code></div>
<div class="source-line"><span class="line-number ">15</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">16</span><span class="line-counter cline-yes">&nbsp</span><code> * Copyright (c) 2010-2014 Digital Bazaar, Inc.</code></div>
<div class="source-line"><span class="line-number ">17</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">18</span><span class="line-counter cline-yes">&nbsp</span><code>var forge = require(&#39;./forge&#39;);</code></div>
<div class="source-line"><span class="line-number ">19</span><span class="line-counter cline-yes">&nbsp</span><code>require(&#39;./cipher&#39;);</code></div>
<div class="source-line"><span class="line-number ">20</span><span class="line-counter cline-yes">&nbsp</span><code>require(&#39;./cipherModes&#39;);</code></div>
<div class="source-line"><span class="line-number ">21</span><span class="line-counter cline-yes">&nbsp</span><code>require(&#39;./util&#39;);</code></div>
<div class="source-line"><span class="line-number ">22</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">23</span><span class="line-counter cline-yes">&nbsp</span><code>/* AES API */</code></div>
<div class="source-line"><span class="line-number ">24</span><span class="line-counter cline-yes">&nbsp</span><code>module.exports = forge.aes = forge.aes || {};</code></div>
<div class="source-line"><span class="line-number ">25</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">26</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">27</span><span class="line-counter cline-yes">&nbsp</span><code> * Deprecated. Instead, use:</code></div>
<div class="source-line"><span class="line-number ">28</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">29</span><span class="line-counter cline-yes">&nbsp</span><code> * var cipher = forge.cipher.createCipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">30</span><span class="line-counter cline-yes">&nbsp</span><code> * cipher.start({iv: iv});</code></div>
<div class="source-line"><span class="line-number ">31</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">32</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates an AES cipher object to encrypt data using the given symmetric key.</code></div>
<div class="source-line"><span class="line-number ">33</span><span class="line-counter cline-yes">&nbsp</span><code> * The output will be stored in the &#39;output&#39; member of the returned cipher.</code></div>
<div class="source-line"><span class="line-number ">34</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">35</span><span class="line-counter cline-yes">&nbsp</span><code> * The key and iv may be given as a string of bytes, an array of bytes,</code></div>
<div class="source-line"><span class="line-number ">36</span><span class="line-counter cline-yes">&nbsp</span><code> * a byte buffer, or an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">37</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">38</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the symmetric key to use.</code></div>
<div class="source-line"><span class="line-number ">39</span><span class="line-counter cline-yes">&nbsp</span><code> * @param iv the initialization vector to use.</code></div>
<div class="source-line"><span class="line-number ">40</span><span class="line-counter cline-yes">&nbsp</span><code> * @param output the buffer to write to, null to create one.</code></div>
<div class="source-line"><span class="line-number ">41</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mode the cipher mode to use (default: &#39;CBC&#39;).</code></div>
<div class="source-line"><span class="line-number ">42</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">43</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the cipher.</code></div>
<div class="source-line"><span class="line-number ">44</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">45</span><span class="line-counter cline-no">！</span><code><span>forge.aes.startEncrypting = </span><span class="cstat-no" title="statement not covered">function(key, iv, output, mode) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">46</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var cipher = _createCipher({</span><span></span></code></div>
<div class="source-line"><span class="line-number ">47</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key: key,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">48</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output: output,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">49</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    decrypt: false,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">50</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    mode: mode</span><span></span></code></div>
<div class="source-line"><span class="line-number ">51</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  });</span><span></span></code></div>
<div class="source-line"><span class="line-number ">52</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  cipher.start(iv);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">53</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">54</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">55</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">56</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">57</span><span class="line-counter cline-yes">&nbsp</span><code> * Deprecated. Instead, use:</code></div>
<div class="source-line"><span class="line-number ">58</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">59</span><span class="line-counter cline-yes">&nbsp</span><code> * var cipher = forge.cipher.createCipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">60</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">61</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates an AES cipher object to encrypt data using the given symmetric key.</code></div>
<div class="source-line"><span class="line-number ">62</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">63</span><span class="line-counter cline-yes">&nbsp</span><code> * The key may be given as a string of bytes, an array of bytes, a</code></div>
<div class="source-line"><span class="line-number ">64</span><span class="line-counter cline-yes">&nbsp</span><code> * byte buffer, or an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">65</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">66</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the symmetric key to use.</code></div>
<div class="source-line"><span class="line-number ">67</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mode the cipher mode to use (default: &#39;CBC&#39;).</code></div>
<div class="source-line"><span class="line-number ">68</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">69</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the cipher.</code></div>
<div class="source-line"><span class="line-number ">70</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">71</span><span class="line-counter cline-no">！</span><code><span>forge.aes.createEncryptionCipher = </span><span class="cstat-no" title="statement not covered">function(key, mode) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">72</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return _createCipher({</span><span></span></code></div>
<div class="source-line"><span class="line-number ">73</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key: key,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">74</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output: null,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">75</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    decrypt: false,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">76</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    mode: mode</span><span></span></code></div>
<div class="source-line"><span class="line-number ">77</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  });</span><span></span></code></div>
<div class="source-line"><span class="line-number ">78</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">79</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">80</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">81</span><span class="line-counter cline-yes">&nbsp</span><code> * Deprecated. Instead, use:</code></div>
<div class="source-line"><span class="line-number ">82</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">83</span><span class="line-counter cline-yes">&nbsp</span><code> * var decipher = forge.cipher.createDecipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">84</span><span class="line-counter cline-yes">&nbsp</span><code> * decipher.start({iv: iv});</code></div>
<div class="source-line"><span class="line-number ">85</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">86</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates an AES cipher object to decrypt data using the given symmetric key.</code></div>
<div class="source-line"><span class="line-number ">87</span><span class="line-counter cline-yes">&nbsp</span><code> * The output will be stored in the &#39;output&#39; member of the returned cipher.</code></div>
<div class="source-line"><span class="line-number ">88</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">89</span><span class="line-counter cline-yes">&nbsp</span><code> * The key and iv may be given as a string of bytes, an array of bytes,</code></div>
<div class="source-line"><span class="line-number ">90</span><span class="line-counter cline-yes">&nbsp</span><code> * a byte buffer, or an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">91</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">92</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the symmetric key to use.</code></div>
<div class="source-line"><span class="line-number ">93</span><span class="line-counter cline-yes">&nbsp</span><code> * @param iv the initialization vector to use.</code></div>
<div class="source-line"><span class="line-number ">94</span><span class="line-counter cline-yes">&nbsp</span><code> * @param output the buffer to write to, null to create one.</code></div>
<div class="source-line"><span class="line-number ">95</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mode the cipher mode to use (default: &#39;CBC&#39;).</code></div>
<div class="source-line"><span class="line-number ">96</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">97</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the cipher.</code></div>
<div class="source-line"><span class="line-number ">98</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">99</span><span class="line-counter cline-no">！</span><code><span>forge.aes.startDecrypting = </span><span class="cstat-no" title="statement not covered">function(key, iv, output, mode) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">100</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var cipher = _createCipher({</span><span></span></code></div>
<div class="source-line"><span class="line-number ">101</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key: key,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">102</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output: output,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">103</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    decrypt: true,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">104</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    mode: mode</span><span></span></code></div>
<div class="source-line"><span class="line-number ">105</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  });</span><span></span></code></div>
<div class="source-line"><span class="line-number ">106</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  cipher.start(iv);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">107</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">108</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">109</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">110</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">111</span><span class="line-counter cline-yes">&nbsp</span><code> * Deprecated. Instead, use:</code></div>
<div class="source-line"><span class="line-number ">112</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">113</span><span class="line-counter cline-yes">&nbsp</span><code> * var decipher = forge.cipher.createDecipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">114</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">115</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates an AES cipher object to decrypt data using the given symmetric key.</code></div>
<div class="source-line"><span class="line-number ">116</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">117</span><span class="line-counter cline-yes">&nbsp</span><code> * The key may be given as a string of bytes, an array of bytes, a</code></div>
<div class="source-line"><span class="line-number ">118</span><span class="line-counter cline-yes">&nbsp</span><code> * byte buffer, or an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">119</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">120</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the symmetric key to use.</code></div>
<div class="source-line"><span class="line-number ">121</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mode the cipher mode to use (default: &#39;CBC&#39;).</code></div>
<div class="source-line"><span class="line-number ">122</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">123</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the cipher.</code></div>
<div class="source-line"><span class="line-number ">124</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">125</span><span class="line-counter cline-no">！</span><code><span>forge.aes.createDecryptionCipher = </span><span class="cstat-no" title="statement not covered">function(key, mode) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">126</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return _createCipher({</span><span></span></code></div>
<div class="source-line"><span class="line-number ">127</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key: key,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">128</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output: null,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">129</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    decrypt: true,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">130</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    mode: mode</span><span></span></code></div>
<div class="source-line"><span class="line-number ">131</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  });</span><span></span></code></div>
<div class="source-line"><span class="line-number ">132</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">133</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">134</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">135</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates a new AES cipher algorithm object.</code></div>
<div class="source-line"><span class="line-number ">136</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">137</span><span class="line-counter cline-yes">&nbsp</span><code> * @param name the name of the algorithm.</code></div>
<div class="source-line"><span class="line-number ">138</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mode the mode factory function.</code></div>
<div class="source-line"><span class="line-number ">139</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">140</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the AES algorithm object.</code></div>
<div class="source-line"><span class="line-number ">141</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">142</span><span class="line-counter cline-yes">&nbsp</span><code>forge.aes.Algorithm = function(name, mode) {</code></div>
<div class="source-line"><span class="line-number ">143</span><span class="line-counter cline-yes">&nbsp</span><code>  if(!init) {</code></div>
<div class="source-line"><span class="line-number ">144</span><span class="line-counter cline-yes">&nbsp</span><code>    initialize();</code></div>
<div class="source-line"><span class="line-number ">145</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">146</span><span class="line-counter cline-yes">&nbsp</span><code>  var self = this;</code></div>
<div class="source-line"><span class="line-number ">147</span><span class="line-counter cline-yes">&nbsp</span><code>  self.name = name;</code></div>
<div class="source-line"><span class="line-number ">148</span><span class="line-counter cline-yes">&nbsp</span><code>  self.mode = new mode({</code></div>
<div class="source-line"><span class="line-number ">149</span><span class="line-counter cline-yes">&nbsp</span><code>    blockSize: 16,</code></div>
<div class="source-line"><span class="line-number ">150</span><span class="line-counter cline-yes">&nbsp</span><code>    cipher: {</code></div>
<div class="source-line"><span class="line-number ">151</span><span class="line-counter cline-yes">&nbsp</span><code>      encrypt: function(inBlock, outBlock) {</code></div>
<div class="source-line"><span class="line-number ">152</span><span class="line-counter cline-yes">&nbsp</span><code>        return _updateBlock(self._w, inBlock, outBlock, false);</code></div>
<div class="source-line"><span class="line-number ">153</span><span class="line-counter cline-yes">&nbsp</span><code>      },</code></div>
<div class="source-line"><span class="line-number ">154</span><span class="line-counter cline-no">！</span><code><span>      decrypt: </span><span class="cstat-no" title="statement not covered">function(inBlock, outBlock) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">155</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        return _updateBlock(self._w, inBlock, outBlock, true);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">156</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">157</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">158</span><span class="line-counter cline-yes">&nbsp</span><code>  });</code></div>
<div class="source-line"><span class="line-number ">159</span><span class="line-counter cline-yes">&nbsp</span><code>  self._init = false;</code></div>
<div class="source-line"><span class="line-number ">160</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">161</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">162</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">163</span><span class="line-counter cline-yes">&nbsp</span><code> * Initializes this AES algorithm by expanding its key.</code></div>
<div class="source-line"><span class="line-number ">164</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">165</span><span class="line-counter cline-yes">&nbsp</span><code> * @param options the options to use.</code></div>
<div class="source-line"><span class="line-number ">166</span><span class="line-counter cline-yes">&nbsp</span><code> *          key the key to use with this algorithm.</code></div>
<div class="source-line"><span class="line-number ">167</span><span class="line-counter cline-yes">&nbsp</span><code> *          decrypt true if the algorithm should be initialized for decryption,</code></div>
<div class="source-line"><span class="line-number ">168</span><span class="line-counter cline-yes">&nbsp</span><code> *            false for encryption.</code></div>
<div class="source-line"><span class="line-number ">169</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">170</span><span class="line-counter cline-yes">&nbsp</span><code>forge.aes.Algorithm.prototype.initialize = function(options) {</code></div>
<div class="source-line"><span class="line-number ">171</span><span class="line-counter cline-no">！</span><code><span>  if(this._init) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">172</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">173</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">174</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">175</span><span class="line-counter cline-yes">&nbsp</span><code>  var key = options.key;</code></div>
<div class="source-line"><span class="line-number ">176</span><span class="line-counter cline-yes">&nbsp</span><code>  var tmp;</code></div>
<div class="source-line"><span class="line-number ">177</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">178</span><span class="line-counter cline-yes">&nbsp</span><code>  /* Note: The key may be a string of bytes, an array of bytes, a byte</code></div>
<div class="source-line"><span class="line-number ">179</span><span class="line-counter cline-yes">&nbsp</span><code>    buffer, or an array of 32-bit integers. If the key is in bytes, then</code></div>
<div class="source-line"><span class="line-number ">180</span><span class="line-counter cline-yes">&nbsp</span><code>    it must be 16, 24, or 32 bytes in length. If it is in 32-bit</code></div>
<div class="source-line"><span class="line-number ">181</span><span class="line-counter cline-yes">&nbsp</span><code>    integers, it must be 4, 6, or 8 integers long. */</code></div>
<div class="source-line"><span class="line-number ">182</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">183</span><span class="line-counter cline-no">！</span><code><span>  if(typeof key === &#39;string&#39; </span><span class="cstat-no" title="statement not covered">&amp;&amp;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">184</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    (key.length === 16 || key.length === 24 || key.length === 32)</span><span>) {</span></code></div>
<div class="source-line"><span class="line-number ">185</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // convert key string into byte buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">186</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key = forge.util.createBuffer(key);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">187</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span> else if(forge.util.isArray(key) &amp;&amp;</span></code></div>
<div class="source-line"><span class="line-number ">188</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    (key.length === 16 || key.length === 24 || key.length === 32)</span><span>) {</span></code></div>
<div class="source-line"><span class="line-number ">189</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // convert key integer array into byte buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">190</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    tmp = key;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">191</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    key = forge.util.createBuffer();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">192</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; tmp.length; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">193</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      key.putByte(tmp[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">194</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">195</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">196</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">197</span><span class="line-counter cline-yes">&nbsp</span><code>  // convert key byte buffer into 32-bit integer array</code></div>
<div class="source-line"><span class="line-number ">198</span><span class="line-counter cline-yes">&nbsp</span><code>  if(!forge.util.isArray(key)) {</code></div>
<div class="source-line"><span class="line-number ">199</span><span class="line-counter cline-yes">&nbsp</span><code>    tmp = key;</code></div>
<div class="source-line"><span class="line-number ">200</span><span class="line-counter cline-yes">&nbsp</span><code>    key = [];</code></div>
<div class="source-line"><span class="line-number ">201</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">202</span><span class="line-counter cline-yes">&nbsp</span><code>    // key lengths of 16, 24, 32 bytes allowed</code></div>
<div class="source-line"><span class="line-number ">203</span><span class="line-counter cline-yes">&nbsp</span><code>    var len = tmp.length();</code></div>
<div class="source-line"><span class="line-number ">204</span><span class="line-counter cline-no">！</span><code><span>    if(len === 16 </span><span class="cstat-no" title="statement not covered">|| len === 24</span><span> || len === 32) {</span></code></div>
<div class="source-line"><span class="line-number ">205</span><span class="line-counter cline-yes">&nbsp</span><code>      len = len &gt;&gt;&gt; 2;</code></div>
<div class="source-line"><span class="line-number ">206</span><span class="line-counter cline-yes">&nbsp</span><code>      for(var i = 0; i &lt; len; ++i) {</code></div>
<div class="source-line"><span class="line-number ">207</span><span class="line-counter cline-yes">&nbsp</span><code>        key.push(tmp.getInt32());</code></div>
<div class="source-line"><span class="line-number ">208</span><span class="line-counter cline-yes">&nbsp</span><code>      }</code></div>
<div class="source-line"><span class="line-number ">209</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">210</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">211</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">212</span><span class="line-counter cline-yes">&nbsp</span><code>  // key must be an array of 32-bit integers by now</code></div>
<div class="source-line"><span class="line-number ">213</span><span class="line-counter cline-yes">&nbsp</span><code>  if(!forge.util.isArray(key) ||</code></div>
<div class="source-line"><span class="line-number ">214</span><span class="line-counter cline-no">！</span><code><span>    !(key.length === 4 </span><span class="cstat-no" title="statement not covered">|| key.length === 6</span><span> || key.length === 8)) {</span></code></div>
<div class="source-line"><span class="line-number ">215</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid key parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">216</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">217</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">218</span><span class="line-counter cline-yes">&nbsp</span><code>  // encryption operation is always used for these modes</code></div>
<div class="source-line"><span class="line-number ">219</span><span class="line-counter cline-yes">&nbsp</span><code>  var mode = this.mode.name;</code></div>
<div class="source-line"><span class="line-number ">220</span><span class="line-counter cline-yes">&nbsp</span><code>  var encryptOp = ([&#39;CFB&#39;, &#39;OFB&#39;, &#39;CTR&#39;, &#39;GCM&#39;].indexOf(mode) !== -1);</code></div>
<div class="source-line"><span class="line-number ">221</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">222</span><span class="line-counter cline-yes">&nbsp</span><code>  // do key expansion</code></div>
<div class="source-line"><span class="line-number ">223</span><span class="line-counter cline-no">！</span><code><span>  this._w = _expandKey(key, options.decrypt </span><span class="cstat-no" title="statement not covered">&amp;&amp; !encryptOp</span><span>);</span></code></div>
<div class="source-line"><span class="line-number ">224</span><span class="line-counter cline-yes">&nbsp</span><code>  this._init = true;</code></div>
<div class="source-line"><span class="line-number ">225</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">226</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">227</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">228</span><span class="line-counter cline-yes">&nbsp</span><code> * Expands a key. Typically only used for testing.</code></div>
<div class="source-line"><span class="line-number ">229</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">230</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the symmetric key to expand, as an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">231</span><span class="line-counter cline-yes">&nbsp</span><code> * @param decrypt true to expand for decryption, false for encryption.</code></div>
<div class="source-line"><span class="line-number ">232</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">233</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the expanded key.</code></div>
<div class="source-line"><span class="line-number ">234</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">235</span><span class="line-counter cline-no">！</span><code><span>forge.aes._expandKey = </span><span class="cstat-no" title="statement not covered">function(key, decrypt) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">236</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(!init) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">237</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    initialize();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">238</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">239</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return _expandKey(key, decrypt);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">240</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">241</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">242</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">243</span><span class="line-counter cline-yes">&nbsp</span><code> * Updates a single block. Typically only used for testing.</code></div>
<div class="source-line"><span class="line-number ">244</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">245</span><span class="line-counter cline-yes">&nbsp</span><code> * @param w the expanded key to use.</code></div>
<div class="source-line"><span class="line-number ">246</span><span class="line-counter cline-yes">&nbsp</span><code> * @param input an array of block-size 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">247</span><span class="line-counter cline-yes">&nbsp</span><code> * @param output an array of block-size 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">248</span><span class="line-counter cline-yes">&nbsp</span><code> * @param decrypt true to decrypt, false to encrypt.</code></div>
<div class="source-line"><span class="line-number ">249</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">250</span><span class="line-counter cline-yes">&nbsp</span><code>forge.aes._updateBlock = _updateBlock;</code></div>
<div class="source-line"><span class="line-number ">251</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">252</span><span class="line-counter cline-yes">&nbsp</span><code>/** Register AES algorithms **/</code></div>
<div class="source-line"><span class="line-number ">253</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">254</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-ECB&#39;, forge.cipher.modes.ecb);</code></div>
<div class="source-line"><span class="line-number ">255</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-CBC&#39;, forge.cipher.modes.cbc);</code></div>
<div class="source-line"><span class="line-number ">256</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-CFB&#39;, forge.cipher.modes.cfb);</code></div>
<div class="source-line"><span class="line-number ">257</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-OFB&#39;, forge.cipher.modes.ofb);</code></div>
<div class="source-line"><span class="line-number ">258</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-CTR&#39;, forge.cipher.modes.ctr);</code></div>
<div class="source-line"><span class="line-number ">259</span><span class="line-counter cline-yes">&nbsp</span><code>registerAlgorithm(&#39;AES-GCM&#39;, forge.cipher.modes.gcm);</code></div>
<div class="source-line"><span class="line-number ">260</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">261</span><span class="line-counter cline-yes">&nbsp</span><code>function registerAlgorithm(name, mode) {</code></div>
<div class="source-line"><span class="line-number ">262</span><span class="line-counter cline-yes">&nbsp</span><code>  var factory = function() {</code></div>
<div class="source-line"><span class="line-number ">263</span><span class="line-counter cline-yes">&nbsp</span><code>    return new forge.aes.Algorithm(name, mode);</code></div>
<div class="source-line"><span class="line-number ">264</span><span class="line-counter cline-yes">&nbsp</span><code>  };</code></div>
<div class="source-line"><span class="line-number ">265</span><span class="line-counter cline-yes">&nbsp</span><code>  forge.cipher.registerAlgorithm(name, factory);</code></div>
<div class="source-line"><span class="line-number ">266</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>
<div class="source-line"><span class="line-number ">267</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">268</span><span class="line-counter cline-yes">&nbsp</span><code>/** AES implementation **/</code></div>
<div class="source-line"><span class="line-number ">269</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">270</span><span class="line-counter cline-yes">&nbsp</span><code>var init = false; // not yet initialized</code></div>
<div class="source-line"><span class="line-number ">271</span><span class="line-counter cline-yes">&nbsp</span><code>var Nb = 4;       // number of words comprising the state (AES = 4)</code></div>
<div class="source-line"><span class="line-number ">272</span><span class="line-counter cline-yes">&nbsp</span><code>var sbox;         // non-linear substitution table used in key expansion</code></div>
<div class="source-line"><span class="line-number ">273</span><span class="line-counter cline-yes">&nbsp</span><code>var isbox;        // inversion of sbox</code></div>
<div class="source-line"><span class="line-number ">274</span><span class="line-counter cline-yes">&nbsp</span><code>var rcon;         // round constant word array</code></div>
<div class="source-line"><span class="line-number ">275</span><span class="line-counter cline-yes">&nbsp</span><code>var mix;          // mix-columns table</code></div>
<div class="source-line"><span class="line-number ">276</span><span class="line-counter cline-yes">&nbsp</span><code>var imix;         // inverse mix-columns table</code></div>
<div class="source-line"><span class="line-number ">277</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">278</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">279</span><span class="line-counter cline-yes">&nbsp</span><code> * Performs initialization, ie: precomputes tables to optimize for speed.</code></div>
<div class="source-line"><span class="line-number ">280</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">281</span><span class="line-counter cline-yes">&nbsp</span><code> * One way to understand how AES works is to imagine that &#39;addition&#39; and</code></div>
<div class="source-line"><span class="line-number ">282</span><span class="line-counter cline-yes">&nbsp</span><code> * &#39;multiplication&#39; are interfaces that require certain mathematical</code></div>
<div class="source-line"><span class="line-number ">283</span><span class="line-counter cline-yes">&nbsp</span><code> * properties to hold true (ie: they are associative) but they might have</code></div>
<div class="source-line"><span class="line-number ">284</span><span class="line-counter cline-yes">&nbsp</span><code> * different implementations and produce different kinds of results ...</code></div>
<div class="source-line"><span class="line-number ">285</span><span class="line-counter cline-yes">&nbsp</span><code> * provided that their mathematical properties remain true. AES defines</code></div>
<div class="source-line"><span class="line-number ">286</span><span class="line-counter cline-yes">&nbsp</span><code> * its own methods of addition and multiplication but keeps some important</code></div>
<div class="source-line"><span class="line-number ">287</span><span class="line-counter cline-yes">&nbsp</span><code> * properties the same, ie: associativity and distributivity. The</code></div>
<div class="source-line"><span class="line-number ">288</span><span class="line-counter cline-yes">&nbsp</span><code> * explanation below tries to shed some light on how AES defines addition</code></div>
<div class="source-line"><span class="line-number ">289</span><span class="line-counter cline-yes">&nbsp</span><code> * and multiplication of bytes and 32-bit words in order to perform its</code></div>
<div class="source-line"><span class="line-number ">290</span><span class="line-counter cline-yes">&nbsp</span><code> * encryption and decryption algorithms.</code></div>
<div class="source-line"><span class="line-number ">291</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">292</span><span class="line-counter cline-yes">&nbsp</span><code> * The basics:</code></div>
<div class="source-line"><span class="line-number ">293</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">294</span><span class="line-counter cline-yes">&nbsp</span><code> * The AES algorithm views bytes as binary representations of polynomials</code></div>
<div class="source-line"><span class="line-number ">295</span><span class="line-counter cline-yes">&nbsp</span><code> * that have either 1 or 0 as the coefficients. It defines the addition</code></div>
<div class="source-line"><span class="line-number ">296</span><span class="line-counter cline-yes">&nbsp</span><code> * or subtraction of two bytes as the XOR operation. It also defines the</code></div>
<div class="source-line"><span class="line-number ">297</span><span class="line-counter cline-yes">&nbsp</span><code> * multiplication of two bytes as a finite field referred to as GF(2^8)</code></div>
<div class="source-line"><span class="line-number ">298</span><span class="line-counter cline-yes">&nbsp</span><code> * (Note: &#39;GF&#39; means &quot;Galois Field&quot; which is a field that contains a finite</code></div>
<div class="source-line"><span class="line-number ">299</span><span class="line-counter cline-yes">&nbsp</span><code> * number of elements so GF(2^8) has 256 elements).</code></div>
<div class="source-line"><span class="line-number ">300</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">301</span><span class="line-counter cline-yes">&nbsp</span><code> * This means that any two bytes can be represented as binary polynomials;</code></div>
<div class="source-line"><span class="line-number ">302</span><span class="line-counter cline-yes">&nbsp</span><code> * when they multiplied together and modularly reduced by an irreducible</code></div>
<div class="source-line"><span class="line-number ">303</span><span class="line-counter cline-yes">&nbsp</span><code> * polynomial of the 8th degree, the results are the field GF(2^8). The</code></div>
<div class="source-line"><span class="line-number ">304</span><span class="line-counter cline-yes">&nbsp</span><code> * specific irreducible polynomial that AES uses in hexadecimal is 0x11b.</code></div>
<div class="source-line"><span class="line-number ">305</span><span class="line-counter cline-yes">&nbsp</span><code> * This multiplication is associative with 0x01 as the identity:</code></div>
<div class="source-line"><span class="line-number ">306</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">307</span><span class="line-counter cline-yes">&nbsp</span><code> * (b * 0x01 = GF(b, 0x01) = b).</code></div>
<div class="source-line"><span class="line-number ">308</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">309</span><span class="line-counter cline-yes">&nbsp</span><code> * The operation GF(b, 0x02) can be performed at the byte level by left</code></div>
<div class="source-line"><span class="line-number ">310</span><span class="line-counter cline-yes">&nbsp</span><code> * shifting b once and then XOR&#39;ing it (to perform the modular reduction)</code></div>
<div class="source-line"><span class="line-number ">311</span><span class="line-counter cline-yes">&nbsp</span><code> * with 0x11b if b is &gt;= 128. Repeated application of the multiplication</code></div>
<div class="source-line"><span class="line-number ">312</span><span class="line-counter cline-yes">&nbsp</span><code> * of 0x02 can be used to implement the multiplication of any two bytes.</code></div>
<div class="source-line"><span class="line-number ">313</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">314</span><span class="line-counter cline-yes">&nbsp</span><code> * For instance, multiplying 0x57 and 0x13, denoted as GF(0x57, 0x13), can</code></div>
<div class="source-line"><span class="line-number ">315</span><span class="line-counter cline-yes">&nbsp</span><code> * be performed by factoring 0x13 into 0x01, 0x02, and 0x10. Then these</code></div>
<div class="source-line"><span class="line-number ">316</span><span class="line-counter cline-yes">&nbsp</span><code> * factors can each be multiplied by 0x57 and then added together. To do</code></div>
<div class="source-line"><span class="line-number ">317</span><span class="line-counter cline-yes">&nbsp</span><code> * the multiplication, values for 0x57 multiplied by each of these 3 factors</code></div>
<div class="source-line"><span class="line-number ">318</span><span class="line-counter cline-yes">&nbsp</span><code> * can be precomputed and stored in a table. To add them, the values from</code></div>
<div class="source-line"><span class="line-number ">319</span><span class="line-counter cline-yes">&nbsp</span><code> * the table are XOR&#39;d together.</code></div>
<div class="source-line"><span class="line-number ">320</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">321</span><span class="line-counter cline-yes">&nbsp</span><code> * AES also defines addition and multiplication of words, that is 4-byte</code></div>
<div class="source-line"><span class="line-number ">322</span><span class="line-counter cline-yes">&nbsp</span><code> * numbers represented as polynomials of 3 degrees where the coefficients</code></div>
<div class="source-line"><span class="line-number ">323</span><span class="line-counter cline-yes">&nbsp</span><code> * are the values of the bytes.</code></div>
<div class="source-line"><span class="line-number ">324</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">325</span><span class="line-counter cline-yes">&nbsp</span><code> * The word [a0, a1, a2, a3] is a polynomial a3x^3 + a2x^2 + a1x + a0.</code></div>
<div class="source-line"><span class="line-number ">326</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">327</span><span class="line-counter cline-yes">&nbsp</span><code> * Addition is performed by XOR&#39;ing like powers of x. Multiplication</code></div>
<div class="source-line"><span class="line-number ">328</span><span class="line-counter cline-yes">&nbsp</span><code> * is performed in two steps, the first is an algebriac expansion as</code></div>
<div class="source-line"><span class="line-number ">329</span><span class="line-counter cline-yes">&nbsp</span><code> * you would do normally (where addition is XOR). But the result is</code></div>
<div class="source-line"><span class="line-number ">330</span><span class="line-counter cline-yes">&nbsp</span><code> * a polynomial larger than 3 degrees and thus it cannot fit in a word. So</code></div>
<div class="source-line"><span class="line-number ">331</span><span class="line-counter cline-yes">&nbsp</span><code> * next the result is modularly reduced by an AES-specific polynomial of</code></div>
<div class="source-line"><span class="line-number ">332</span><span class="line-counter cline-yes">&nbsp</span><code> * degree 4 which will always produce a polynomial of less than 4 degrees</code></div>
<div class="source-line"><span class="line-number ">333</span><span class="line-counter cline-yes">&nbsp</span><code> * such that it will fit in a word. In AES, this polynomial is x^4 + 1.</code></div>
<div class="source-line"><span class="line-number ">334</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">335</span><span class="line-counter cline-yes">&nbsp</span><code> * The modular product of two polynomials &#39;a&#39; and &#39;b&#39; is thus:</code></div>
<div class="source-line"><span class="line-number ">336</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">337</span><span class="line-counter cline-yes">&nbsp</span><code> * d(x) = d3x^3 + d2x^2 + d1x + d0</code></div>
<div class="source-line"><span class="line-number ">338</span><span class="line-counter cline-yes">&nbsp</span><code> * with</code></div>
<div class="source-line"><span class="line-number ">339</span><span class="line-counter cline-yes">&nbsp</span><code> * d0 = GF(a0, b0) ^ GF(a3, b1) ^ GF(a2, b2) ^ GF(a1, b3)</code></div>
<div class="source-line"><span class="line-number ">340</span><span class="line-counter cline-yes">&nbsp</span><code> * d1 = GF(a1, b0) ^ GF(a0, b1) ^ GF(a3, b2) ^ GF(a2, b3)</code></div>
<div class="source-line"><span class="line-number ">341</span><span class="line-counter cline-yes">&nbsp</span><code> * d2 = GF(a2, b0) ^ GF(a1, b1) ^ GF(a0, b2) ^ GF(a3, b3)</code></div>
<div class="source-line"><span class="line-number ">342</span><span class="line-counter cline-yes">&nbsp</span><code> * d3 = GF(a3, b0) ^ GF(a2, b1) ^ GF(a1, b2) ^ GF(a0, b3)</code></div>
<div class="source-line"><span class="line-number ">343</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">344</span><span class="line-counter cline-yes">&nbsp</span><code> * As a matrix:</code></div>
<div class="source-line"><span class="line-number ">345</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">346</span><span class="line-counter cline-yes">&nbsp</span><code> * [d0] = [a0 a3 a2 a1][b0]</code></div>
<div class="source-line"><span class="line-number ">347</span><span class="line-counter cline-yes">&nbsp</span><code> * [d1]   [a1 a0 a3 a2][b1]</code></div>
<div class="source-line"><span class="line-number ">348</span><span class="line-counter cline-yes">&nbsp</span><code> * [d2]   [a2 a1 a0 a3][b2]</code></div>
<div class="source-line"><span class="line-number ">349</span><span class="line-counter cline-yes">&nbsp</span><code> * [d3]   [a3 a2 a1 a0][b3]</code></div>
<div class="source-line"><span class="line-number ">350</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">351</span><span class="line-counter cline-yes">&nbsp</span><code> * Special polynomials defined by AES (0x02 == {02}):</code></div>
<div class="source-line"><span class="line-number ">352</span><span class="line-counter cline-yes">&nbsp</span><code> * a(x)    = {03}x^3 + {01}x^2 + {01}x + {02}</code></div>
<div class="source-line"><span class="line-number ">353</span><span class="line-counter cline-yes">&nbsp</span><code> * a^-1(x) = {0b}x^3 + {0d}x^2 + {09}x + {0e}.</code></div>
<div class="source-line"><span class="line-number ">354</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">355</span><span class="line-counter cline-yes">&nbsp</span><code> * These polynomials are used in the MixColumns() and InverseMixColumns()</code></div>
<div class="source-line"><span class="line-number ">356</span><span class="line-counter cline-yes">&nbsp</span><code> * operations, respectively, to cause each element in the state to affect</code></div>
<div class="source-line"><span class="line-number ">357</span><span class="line-counter cline-yes">&nbsp</span><code> * the output (referred to as diffusing).</code></div>
<div class="source-line"><span class="line-number ">358</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">359</span><span class="line-counter cline-yes">&nbsp</span><code> * RotWord() uses: a0 = a1 = a2 = {00} and a3 = {01}, which is the</code></div>
<div class="source-line"><span class="line-number ">360</span><span class="line-counter cline-yes">&nbsp</span><code> * polynomial x3.</code></div>
<div class="source-line"><span class="line-number ">361</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">362</span><span class="line-counter cline-yes">&nbsp</span><code> * The ShiftRows() method modifies the last 3 rows in the state (where</code></div>
<div class="source-line"><span class="line-number ">363</span><span class="line-counter cline-yes">&nbsp</span><code> * the state is 4 words with 4 bytes per word) by shifting bytes cyclically.</code></div>
<div class="source-line"><span class="line-number ">364</span><span class="line-counter cline-yes">&nbsp</span><code> * The 1st byte in the second row is moved to the end of the row. The 1st</code></div>
<div class="source-line"><span class="line-number ">365</span><span class="line-counter cline-yes">&nbsp</span><code> * and 2nd bytes in the third row are moved to the end of the row. The 1st,</code></div>
<div class="source-line"><span class="line-number ">366</span><span class="line-counter cline-yes">&nbsp</span><code> * 2nd, and 3rd bytes are moved in the fourth row.</code></div>
<div class="source-line"><span class="line-number ">367</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">368</span><span class="line-counter cline-yes">&nbsp</span><code> * More details on how AES arithmetic works:</code></div>
<div class="source-line"><span class="line-number ">369</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">370</span><span class="line-counter cline-yes">&nbsp</span><code> * In the polynomial representation of binary numbers, XOR performs addition</code></div>
<div class="source-line"><span class="line-number ">371</span><span class="line-counter cline-yes">&nbsp</span><code> * and subtraction and multiplication in GF(2^8) denoted as GF(a, b)</code></div>
<div class="source-line"><span class="line-number ">372</span><span class="line-counter cline-yes">&nbsp</span><code> * corresponds with the multiplication of polynomials modulo an irreducible</code></div>
<div class="source-line"><span class="line-number ">373</span><span class="line-counter cline-yes">&nbsp</span><code> * polynomial of degree 8. In other words, for AES, GF(a, b) will multiply</code></div>
<div class="source-line"><span class="line-number ">374</span><span class="line-counter cline-yes">&nbsp</span><code> * polynomial &#39;a&#39; with polynomial &#39;b&#39; and then do a modular reduction by</code></div>
<div class="source-line"><span class="line-number ">375</span><span class="line-counter cline-yes">&nbsp</span><code> * an AES-specific irreducible polynomial of degree 8.</code></div>
<div class="source-line"><span class="line-number ">376</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">377</span><span class="line-counter cline-yes">&nbsp</span><code> * A polynomial is irreducible if its only divisors are one and itself. For</code></div>
<div class="source-line"><span class="line-number ">378</span><span class="line-counter cline-yes">&nbsp</span><code> * the AES algorithm, this irreducible polynomial is:</code></div>
<div class="source-line"><span class="line-number ">379</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">380</span><span class="line-counter cline-yes">&nbsp</span><code> * m(x) = x^8 + x^4 + x^3 + x + 1,</code></div>
<div class="source-line"><span class="line-number ">381</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">382</span><span class="line-counter cline-yes">&nbsp</span><code> * or {01}{1b} in hexadecimal notation, where each coefficient is a bit:</code></div>
<div class="source-line"><span class="line-number ">383</span><span class="line-counter cline-yes">&nbsp</span><code> * 100011011 = 283 = 0x11b.</code></div>
<div class="source-line"><span class="line-number ">384</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">385</span><span class="line-counter cline-yes">&nbsp</span><code> * For example, GF(0x57, 0x83) = 0xc1 because</code></div>
<div class="source-line"><span class="line-number ">386</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">387</span><span class="line-counter cline-yes">&nbsp</span><code> * 0x57 = 87  = 01010111 = x^6 + x^4 + x^2 + x + 1</code></div>
<div class="source-line"><span class="line-number ">388</span><span class="line-counter cline-yes">&nbsp</span><code> * 0x85 = 131 = 10000101 = x^7 + x + 1</code></div>
<div class="source-line"><span class="line-number ">389</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">390</span><span class="line-counter cline-yes">&nbsp</span><code> * (x^6 + x^4 + x^2 + x + 1) * (x^7 + x + 1)</code></div>
<div class="source-line"><span class="line-number ">391</span><span class="line-counter cline-yes">&nbsp</span><code> * =  x^13 + x^11 + x^9 + x^8 + x^7 +</code></div>
<div class="source-line"><span class="line-number ">392</span><span class="line-counter cline-yes">&nbsp</span><code> *    x^7 + x^5 + x^3 + x^2 + x +</code></div>
<div class="source-line"><span class="line-number ">393</span><span class="line-counter cline-yes">&nbsp</span><code> *    x^6 + x^4 + x^2 + x + 1</code></div>
<div class="source-line"><span class="line-number ">394</span><span class="line-counter cline-yes">&nbsp</span><code> * =  x^13 + x^11 + x^9 + x^8 + x^6 + x^5 + x^4 + x^3 + 1 = y</code></div>
<div class="source-line"><span class="line-number ">395</span><span class="line-counter cline-yes">&nbsp</span><code> *    y modulo (x^8 + x^4 + x^3 + x + 1)</code></div>
<div class="source-line"><span class="line-number ">396</span><span class="line-counter cline-yes">&nbsp</span><code> * =  x^7 + x^6 + 1.</code></div>
<div class="source-line"><span class="line-number ">397</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">398</span><span class="line-counter cline-yes">&nbsp</span><code> * The modular reduction by m(x) guarantees the result will be a binary</code></div>
<div class="source-line"><span class="line-number ">399</span><span class="line-counter cline-yes">&nbsp</span><code> * polynomial of less than degree 8, so that it can fit in a byte.</code></div>
<div class="source-line"><span class="line-number ">400</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">401</span><span class="line-counter cline-yes">&nbsp</span><code> * The operation to multiply a binary polynomial b with x (the polynomial</code></div>
<div class="source-line"><span class="line-number ">402</span><span class="line-counter cline-yes">&nbsp</span><code> * x in binary representation is 00000010) is:</code></div>
<div class="source-line"><span class="line-number ">403</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">404</span><span class="line-counter cline-yes">&nbsp</span><code> * b_7x^8 + b_6x^7 + b_5x^6 + b_4x^5 + b_3x^4 + b_2x^3 + b_1x^2 + b_0x^1</code></div>
<div class="source-line"><span class="line-number ">405</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">406</span><span class="line-counter cline-yes">&nbsp</span><code> * To get GF(b, x) we must reduce that by m(x). If b_7 is 0 (that is the</code></div>
<div class="source-line"><span class="line-number ">407</span><span class="line-counter cline-yes">&nbsp</span><code> * most significant bit is 0 in b) then the result is already reduced. If</code></div>
<div class="source-line"><span class="line-number ">408</span><span class="line-counter cline-yes">&nbsp</span><code> * it is 1, then we can reduce it by subtracting m(x) via an XOR.</code></div>
<div class="source-line"><span class="line-number ">409</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">410</span><span class="line-counter cline-yes">&nbsp</span><code> * It follows that multiplication by x (00000010 or 0x02) can be implemented</code></div>
<div class="source-line"><span class="line-number ">411</span><span class="line-counter cline-yes">&nbsp</span><code> * by performing a left shift followed by a conditional bitwise XOR with</code></div>
<div class="source-line"><span class="line-number ">412</span><span class="line-counter cline-yes">&nbsp</span><code> * 0x1b. This operation on bytes is denoted by xtime(). Multiplication by</code></div>
<div class="source-line"><span class="line-number ">413</span><span class="line-counter cline-yes">&nbsp</span><code> * higher powers of x can be implemented by repeated application of xtime().</code></div>
<div class="source-line"><span class="line-number ">414</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">415</span><span class="line-counter cline-yes">&nbsp</span><code> * By adding intermediate results, multiplication by any constant can be</code></div>
<div class="source-line"><span class="line-number ">416</span><span class="line-counter cline-yes">&nbsp</span><code> * implemented. For instance:</code></div>
<div class="source-line"><span class="line-number ">417</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">418</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x13) = 0xfe because:</code></div>
<div class="source-line"><span class="line-number ">419</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">420</span><span class="line-counter cline-yes">&nbsp</span><code> * xtime(b) = (b &amp; 128) ? (b &lt;&lt; 1 ^ 0x11b) : (b &lt;&lt; 1)</code></div>
<div class="source-line"><span class="line-number ">421</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">422</span><span class="line-counter cline-yes">&nbsp</span><code> * Note: We XOR with 0x11b instead of 0x1b because in javascript our</code></div>
<div class="source-line"><span class="line-number ">423</span><span class="line-counter cline-yes">&nbsp</span><code> * datatype for b can be larger than 1 byte, so a left shift will not</code></div>
<div class="source-line"><span class="line-number ">424</span><span class="line-counter cline-yes">&nbsp</span><code> * automatically eliminate bits that overflow a byte ... by XOR&#39;ing the</code></div>
<div class="source-line"><span class="line-number ">425</span><span class="line-counter cline-yes">&nbsp</span><code> * overflow bit with 1 (the extra one from 0x11b) we zero it out.</code></div>
<div class="source-line"><span class="line-number ">426</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">427</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x02) = xtime(0x57) = 0xae</code></div>
<div class="source-line"><span class="line-number ">428</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x04) = xtime(0xae) = 0x47</code></div>
<div class="source-line"><span class="line-number ">429</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x08) = xtime(0x47) = 0x8e</code></div>
<div class="source-line"><span class="line-number ">430</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x10) = xtime(0x8e) = 0x07</code></div>
<div class="source-line"><span class="line-number ">431</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">432</span><span class="line-counter cline-yes">&nbsp</span><code> * GF(0x57, 0x13) = GF(0x57, (0x01 ^ 0x02 ^ 0x10))</code></div>
<div class="source-line"><span class="line-number ">433</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">434</span><span class="line-counter cline-yes">&nbsp</span><code> * And by the distributive property (since XOR is addition and GF() is</code></div>
<div class="source-line"><span class="line-number ">435</span><span class="line-counter cline-yes">&nbsp</span><code> * multiplication):</code></div>
<div class="source-line"><span class="line-number ">436</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">437</span><span class="line-counter cline-yes">&nbsp</span><code> * = GF(0x57, 0x01) ^ GF(0x57, 0x02) ^ GF(0x57, 0x10)</code></div>
<div class="source-line"><span class="line-number ">438</span><span class="line-counter cline-yes">&nbsp</span><code> * = 0x57 ^ 0xae ^ 0x07</code></div>
<div class="source-line"><span class="line-number ">439</span><span class="line-counter cline-yes">&nbsp</span><code> * = 0xfe.</code></div>
<div class="source-line"><span class="line-number ">440</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">441</span><span class="line-counter cline-yes">&nbsp</span><code>function initialize() {</code></div>
<div class="source-line"><span class="line-number ">442</span><span class="line-counter cline-yes">&nbsp</span><code>  init = true;</code></div>
<div class="source-line"><span class="line-number ">443</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">444</span><span class="line-counter cline-yes">&nbsp</span><code>  /* Populate the Rcon table. These are the values given by</code></div>
<div class="source-line"><span class="line-number ">445</span><span class="line-counter cline-yes">&nbsp</span><code>    [x^(i-1),{00},{00},{00}] where x^(i-1) are powers of x (and x = 0x02)</code></div>
<div class="source-line"><span class="line-number ">446</span><span class="line-counter cline-yes">&nbsp</span><code>    in the field of GF(2^8), where i starts at 1.</code></div>
<div class="source-line"><span class="line-number ">447</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">448</span><span class="line-counter cline-yes">&nbsp</span><code>    rcon[0] = [0x00, 0x00, 0x00, 0x00]</code></div>
<div class="source-line"><span class="line-number ">449</span><span class="line-counter cline-yes">&nbsp</span><code>    rcon[1] = [0x01, 0x00, 0x00, 0x00] 2^(1-1) = 2^0 = 1</code></div>
<div class="source-line"><span class="line-number ">450</span><span class="line-counter cline-yes">&nbsp</span><code>    rcon[2] = [0x02, 0x00, 0x00, 0x00] 2^(2-1) = 2^1 = 2</code></div>
<div class="source-line"><span class="line-number ">451</span><span class="line-counter cline-yes">&nbsp</span><code>    ...</code></div>
<div class="source-line"><span class="line-number ">452</span><span class="line-counter cline-yes">&nbsp</span><code>    rcon[9]  = [0x1B, 0x00, 0x00, 0x00] 2^(9-1)  = 2^8 = 0x1B</code></div>
<div class="source-line"><span class="line-number ">453</span><span class="line-counter cline-yes">&nbsp</span><code>    rcon[10] = [0x36, 0x00, 0x00, 0x00] 2^(10-1) = 2^9 = 0x36</code></div>
<div class="source-line"><span class="line-number ">454</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">455</span><span class="line-counter cline-yes">&nbsp</span><code>    We only store the first byte because it is the only one used.</code></div>
<div class="source-line"><span class="line-number ">456</span><span class="line-counter cline-yes">&nbsp</span><code>  */</code></div>
<div class="source-line"><span class="line-number ">457</span><span class="line-counter cline-yes">&nbsp</span><code>  rcon = [0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x40, 0x80, 0x1B, 0x36];</code></div>
<div class="source-line"><span class="line-number ">458</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">459</span><span class="line-counter cline-yes">&nbsp</span><code>  // compute xtime table which maps i onto GF(i, 0x02)</code></div>
<div class="source-line"><span class="line-number ">460</span><span class="line-counter cline-yes">&nbsp</span><code>  var xtime = new Array(256);</code></div>
<div class="source-line"><span class="line-number ">461</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; 128; ++i) {</code></div>
<div class="source-line"><span class="line-number ">462</span><span class="line-counter cline-yes">&nbsp</span><code>    xtime[i] = i &lt;&lt; 1;</code></div>
<div class="source-line"><span class="line-number ">463</span><span class="line-counter cline-yes">&nbsp</span><code>    xtime[i + 128] = (i + 128) &lt;&lt; 1 ^ 0x11B;</code></div>
<div class="source-line"><span class="line-number ">464</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">465</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">466</span><span class="line-counter cline-yes">&nbsp</span><code>  // compute all other tables</code></div>
<div class="source-line"><span class="line-number ">467</span><span class="line-counter cline-yes">&nbsp</span><code>  sbox = new Array(256);</code></div>
<div class="source-line"><span class="line-number ">468</span><span class="line-counter cline-yes">&nbsp</span><code>  isbox = new Array(256);</code></div>
<div class="source-line"><span class="line-number ">469</span><span class="line-counter cline-yes">&nbsp</span><code>  mix = new Array(4);</code></div>
<div class="source-line"><span class="line-number ">470</span><span class="line-counter cline-yes">&nbsp</span><code>  imix = new Array(4);</code></div>
<div class="source-line"><span class="line-number ">471</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; 4; ++i) {</code></div>
<div class="source-line"><span class="line-number ">472</span><span class="line-counter cline-yes">&nbsp</span><code>    mix[i] = new Array(256);</code></div>
<div class="source-line"><span class="line-number ">473</span><span class="line-counter cline-yes">&nbsp</span><code>    imix[i] = new Array(256);</code></div>
<div class="source-line"><span class="line-number ">474</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">475</span><span class="line-counter cline-yes">&nbsp</span><code>  var e = 0, ei = 0, e2, e4, e8, sx, sx2, me, ime;</code></div>
<div class="source-line"><span class="line-number ">476</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; 256; ++i) {</code></div>
<div class="source-line"><span class="line-number ">477</span><span class="line-counter cline-yes">&nbsp</span><code>    /* We need to generate the SubBytes() sbox and isbox tables so that</code></div>
<div class="source-line"><span class="line-number ">478</span><span class="line-counter cline-yes">&nbsp</span><code>      we can perform byte substitutions. This requires us to traverse</code></div>
<div class="source-line"><span class="line-number ">479</span><span class="line-counter cline-yes">&nbsp</span><code>      all of the elements in GF, find their multiplicative inverses,</code></div>
<div class="source-line"><span class="line-number ">480</span><span class="line-counter cline-yes">&nbsp</span><code>      and apply to each the following affine transformation:</code></div>
<div class="source-line"><span class="line-number ">481</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">482</span><span class="line-counter cline-yes">&nbsp</span><code>      bi&#39; = bi ^ b(i + 4) mod 8 ^ b(i + 5) mod 8 ^ b(i + 6) mod 8 ^</code></div>
<div class="source-line"><span class="line-number ">483</span><span class="line-counter cline-yes">&nbsp</span><code>            b(i + 7) mod 8 ^ ci</code></div>
<div class="source-line"><span class="line-number ">484</span><span class="line-counter cline-yes">&nbsp</span><code>      for 0 &lt;= i &lt; 8, where bi is the ith bit of the byte, and ci is the</code></div>
<div class="source-line"><span class="line-number ">485</span><span class="line-counter cline-yes">&nbsp</span><code>      ith bit of a byte c with the value {63} or {01100011}.</code></div>
<div class="source-line"><span class="line-number ">486</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">487</span><span class="line-counter cline-yes">&nbsp</span><code>      It is possible to traverse every possible value in a Galois field</code></div>
<div class="source-line"><span class="line-number ">488</span><span class="line-counter cline-yes">&nbsp</span><code>      using what is referred to as a &#39;generator&#39;. There are many</code></div>
<div class="source-line"><span class="line-number ">489</span><span class="line-counter cline-yes">&nbsp</span><code>      generators (128 out of 256): 3,5,6,9,11,82 to name a few. To fully</code></div>
<div class="source-line"><span class="line-number ">490</span><span class="line-counter cline-yes">&nbsp</span><code>      traverse GF we iterate 255 times, multiplying by our generator</code></div>
<div class="source-line"><span class="line-number ">491</span><span class="line-counter cline-yes">&nbsp</span><code>      each time.</code></div>
<div class="source-line"><span class="line-number ">492</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">493</span><span class="line-counter cline-yes">&nbsp</span><code>      On each iteration we can determine the multiplicative inverse for</code></div>
<div class="source-line"><span class="line-number ">494</span><span class="line-counter cline-yes">&nbsp</span><code>      the current element.</code></div>
<div class="source-line"><span class="line-number ">495</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">496</span><span class="line-counter cline-yes">&nbsp</span><code>      Suppose there is an element in GF &#39;e&#39;. For a given generator &#39;g&#39;,</code></div>
<div class="source-line"><span class="line-number ">497</span><span class="line-counter cline-yes">&nbsp</span><code>      e = g^x. The multiplicative inverse of e is g^(255 - x). It turns</code></div>
<div class="source-line"><span class="line-number ">498</span><span class="line-counter cline-yes">&nbsp</span><code>      out that if use the inverse of a generator as another generator</code></div>
<div class="source-line"><span class="line-number ">499</span><span class="line-counter cline-yes">&nbsp</span><code>      it will produce all of the corresponding multiplicative inverses</code></div>
<div class="source-line"><span class="line-number ">500</span><span class="line-counter cline-yes">&nbsp</span><code>      at the same time. For this reason, we choose 5 as our inverse</code></div>
<div class="source-line"><span class="line-number ">501</span><span class="line-counter cline-yes">&nbsp</span><code>      generator because it only requires 2 multiplies and 1 add and its</code></div>
<div class="source-line"><span class="line-number ">502</span><span class="line-counter cline-yes">&nbsp</span><code>      inverse, 82, requires relatively few operations as well.</code></div>
<div class="source-line"><span class="line-number ">503</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">504</span><span class="line-counter cline-yes">&nbsp</span><code>      In order to apply the affine transformation, the multiplicative</code></div>
<div class="source-line"><span class="line-number ">505</span><span class="line-counter cline-yes">&nbsp</span><code>      inverse &#39;ei&#39; of &#39;e&#39; can be repeatedly XOR&#39;d (4 times) with a</code></div>
<div class="source-line"><span class="line-number ">506</span><span class="line-counter cline-yes">&nbsp</span><code>      bit-cycling of &#39;ei&#39;. To do this &#39;ei&#39; is first stored in &#39;s&#39; and</code></div>
<div class="source-line"><span class="line-number ">507</span><span class="line-counter cline-yes">&nbsp</span><code>      &#39;x&#39;. Then &#39;s&#39; is left shifted and the high bit of &#39;s&#39; is made the</code></div>
<div class="source-line"><span class="line-number ">508</span><span class="line-counter cline-yes">&nbsp</span><code>      low bit. The resulting value is stored in &#39;s&#39;. Then &#39;x&#39; is XOR&#39;d</code></div>
<div class="source-line"><span class="line-number ">509</span><span class="line-counter cline-yes">&nbsp</span><code>      with &#39;s&#39; and stored in &#39;x&#39;. On each subsequent iteration the same</code></div>
<div class="source-line"><span class="line-number ">510</span><span class="line-counter cline-yes">&nbsp</span><code>      operation is performed. When 4 iterations are complete, &#39;x&#39; is</code></div>
<div class="source-line"><span class="line-number ">511</span><span class="line-counter cline-yes">&nbsp</span><code>      XOR&#39;d with &#39;c&#39; (0x63) and the transformed value is stored in &#39;x&#39;.</code></div>
<div class="source-line"><span class="line-number ">512</span><span class="line-counter cline-yes">&nbsp</span><code>      For example:</code></div>
<div class="source-line"><span class="line-number ">513</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">514</span><span class="line-counter cline-yes">&nbsp</span><code>      s = 01000001</code></div>
<div class="source-line"><span class="line-number ">515</span><span class="line-counter cline-yes">&nbsp</span><code>      x = 01000001</code></div>
<div class="source-line"><span class="line-number ">516</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">517</span><span class="line-counter cline-yes">&nbsp</span><code>      iteration 1: s = 10000010, x ^= s</code></div>
<div class="source-line"><span class="line-number ">518</span><span class="line-counter cline-yes">&nbsp</span><code>      iteration 2: s = 00000101, x ^= s</code></div>
<div class="source-line"><span class="line-number ">519</span><span class="line-counter cline-yes">&nbsp</span><code>      iteration 3: s = 00001010, x ^= s</code></div>
<div class="source-line"><span class="line-number ">520</span><span class="line-counter cline-yes">&nbsp</span><code>      iteration 4: s = 00010100, x ^= s</code></div>
<div class="source-line"><span class="line-number ">521</span><span class="line-counter cline-yes">&nbsp</span><code>      x ^= 0x63</code></div>
<div class="source-line"><span class="line-number ">522</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">523</span><span class="line-counter cline-yes">&nbsp</span><code>      This can be done with a loop where s = (s &lt;&lt; 1) | (s &gt;&gt; 7). However,</code></div>
<div class="source-line"><span class="line-number ">524</span><span class="line-counter cline-yes">&nbsp</span><code>      it can also be done by using a single 16-bit (in this case 32-bit)</code></div>
<div class="source-line"><span class="line-number ">525</span><span class="line-counter cline-yes">&nbsp</span><code>      number &#39;sx&#39;. Since XOR is an associative operation, we can set &#39;sx&#39;</code></div>
<div class="source-line"><span class="line-number ">526</span><span class="line-counter cline-yes">&nbsp</span><code>      to &#39;ei&#39; and then XOR it with &#39;sx&#39; left-shifted 1,2,3, and 4 times.</code></div>
<div class="source-line"><span class="line-number ">527</span><span class="line-counter cline-yes">&nbsp</span><code>      The most significant bits will flow into the high 8 bit positions</code></div>
<div class="source-line"><span class="line-number ">528</span><span class="line-counter cline-yes">&nbsp</span><code>      and be correctly XOR&#39;d with one another. All that remains will be</code></div>
<div class="source-line"><span class="line-number ">529</span><span class="line-counter cline-yes">&nbsp</span><code>      to cycle the high 8 bits by XOR&#39;ing them all with the lower 8 bits</code></div>
<div class="source-line"><span class="line-number ">530</span><span class="line-counter cline-yes">&nbsp</span><code>      afterwards.</code></div>
<div class="source-line"><span class="line-number ">531</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">532</span><span class="line-counter cline-yes">&nbsp</span><code>      At the same time we&#39;re populating sbox and isbox we can precompute</code></div>
<div class="source-line"><span class="line-number ">533</span><span class="line-counter cline-yes">&nbsp</span><code>      the multiplication we&#39;ll need to do to do MixColumns() later.</code></div>
<div class="source-line"><span class="line-number ">534</span><span class="line-counter cline-yes">&nbsp</span><code>    */</code></div>
<div class="source-line"><span class="line-number ">535</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">536</span><span class="line-counter cline-yes">&nbsp</span><code>    // apply affine transformation</code></div>
<div class="source-line"><span class="line-number ">537</span><span class="line-counter cline-yes">&nbsp</span><code>    sx = ei ^ (ei &lt;&lt; 1) ^ (ei &lt;&lt; 2) ^ (ei &lt;&lt; 3) ^ (ei &lt;&lt; 4);</code></div>
<div class="source-line"><span class="line-number ">538</span><span class="line-counter cline-yes">&nbsp</span><code>    sx = (sx &gt;&gt; 8) ^ (sx &amp; 255) ^ 0x63;</code></div>
<div class="source-line"><span class="line-number ">539</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">540</span><span class="line-counter cline-yes">&nbsp</span><code>    // update tables</code></div>
<div class="source-line"><span class="line-number ">541</span><span class="line-counter cline-yes">&nbsp</span><code>    sbox[e] = sx;</code></div>
<div class="source-line"><span class="line-number ">542</span><span class="line-counter cline-yes">&nbsp</span><code>    isbox[sx] = e;</code></div>
<div class="source-line"><span class="line-number ">543</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">544</span><span class="line-counter cline-yes">&nbsp</span><code>    /* Mixing columns is done using matrix multiplication. The columns</code></div>
<div class="source-line"><span class="line-number ">545</span><span class="line-counter cline-yes">&nbsp</span><code>      that are to be mixed are each a single word in the current state.</code></div>
<div class="source-line"><span class="line-number ">546</span><span class="line-counter cline-yes">&nbsp</span><code>      The state has Nb columns (4 columns). Therefore each column is a</code></div>
<div class="source-line"><span class="line-number ">547</span><span class="line-counter cline-yes">&nbsp</span><code>      4 byte word. So to mix the columns in a single column &#39;c&#39; where</code></div>
<div class="source-line"><span class="line-number ">548</span><span class="line-counter cline-yes">&nbsp</span><code>      its rows are r0, r1, r2, and r3, we use the following matrix</code></div>
<div class="source-line"><span class="line-number ">549</span><span class="line-counter cline-yes">&nbsp</span><code>      multiplication:</code></div>
<div class="source-line"><span class="line-number ">550</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">551</span><span class="line-counter cline-yes">&nbsp</span><code>      [2 3 1 1]*[r0,c]=[r&#39;0,c]</code></div>
<div class="source-line"><span class="line-number ">552</span><span class="line-counter cline-yes">&nbsp</span><code>      [1 2 3 1] [r1,c] [r&#39;1,c]</code></div>
<div class="source-line"><span class="line-number ">553</span><span class="line-counter cline-yes">&nbsp</span><code>      [1 1 2 3] [r2,c] [r&#39;2,c]</code></div>
<div class="source-line"><span class="line-number ">554</span><span class="line-counter cline-yes">&nbsp</span><code>      [3 1 1 2] [r3,c] [r&#39;3,c]</code></div>
<div class="source-line"><span class="line-number ">555</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">556</span><span class="line-counter cline-yes">&nbsp</span><code>      r0, r1, r2, and r3 are each 1 byte of one of the words in the</code></div>
<div class="source-line"><span class="line-number ">557</span><span class="line-counter cline-yes">&nbsp</span><code>      state (a column). To do matrix multiplication for each mixed</code></div>
<div class="source-line"><span class="line-number ">558</span><span class="line-counter cline-yes">&nbsp</span><code>      column c&#39; we multiply the corresponding row from the left matrix</code></div>
<div class="source-line"><span class="line-number ">559</span><span class="line-counter cline-yes">&nbsp</span><code>      with the corresponding column from the right matrix. In total, we</code></div>
<div class="source-line"><span class="line-number ">560</span><span class="line-counter cline-yes">&nbsp</span><code>      get 4 equations:</code></div>
<div class="source-line"><span class="line-number ">561</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">562</span><span class="line-counter cline-yes">&nbsp</span><code>      r0,c&#39; = 2*r0,c + 3*r1,c + 1*r2,c + 1*r3,c</code></div>
<div class="source-line"><span class="line-number ">563</span><span class="line-counter cline-yes">&nbsp</span><code>      r1,c&#39; = 1*r0,c + 2*r1,c + 3*r2,c + 1*r3,c</code></div>
<div class="source-line"><span class="line-number ">564</span><span class="line-counter cline-yes">&nbsp</span><code>      r2,c&#39; = 1*r0,c + 1*r1,c + 2*r2,c + 3*r3,c</code></div>
<div class="source-line"><span class="line-number ">565</span><span class="line-counter cline-yes">&nbsp</span><code>      r3,c&#39; = 3*r0,c + 1*r1,c + 1*r2,c + 2*r3,c</code></div>
<div class="source-line"><span class="line-number ">566</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">567</span><span class="line-counter cline-yes">&nbsp</span><code>      As usual, the multiplication is as previously defined and the</code></div>
<div class="source-line"><span class="line-number ">568</span><span class="line-counter cline-yes">&nbsp</span><code>      addition is XOR. In order to optimize mixing columns we can store</code></div>
<div class="source-line"><span class="line-number ">569</span><span class="line-counter cline-yes">&nbsp</span><code>      the multiplication results in tables. If you think of the whole</code></div>
<div class="source-line"><span class="line-number ">570</span><span class="line-counter cline-yes">&nbsp</span><code>      column as a word (it might help to visualize by mentally rotating</code></div>
<div class="source-line"><span class="line-number ">571</span><span class="line-counter cline-yes">&nbsp</span><code>      the equations above by counterclockwise 90 degrees) then you can</code></div>
<div class="source-line"><span class="line-number ">572</span><span class="line-counter cline-yes">&nbsp</span><code>      see that it would be useful to map the multiplications performed on</code></div>
<div class="source-line"><span class="line-number ">573</span><span class="line-counter cline-yes">&nbsp</span><code>      each byte (r0, r1, r2, r3) onto a word as well. For instance, we</code></div>
<div class="source-line"><span class="line-number ">574</span><span class="line-counter cline-yes">&nbsp</span><code>      could map 2*r0,1*r0,1*r0,3*r0 onto a word by storing 2*r0 in the</code></div>
<div class="source-line"><span class="line-number ">575</span><span class="line-counter cline-yes">&nbsp</span><code>      highest 8 bits and 3*r0 in the lowest 8 bits (with the other two</code></div>
<div class="source-line"><span class="line-number ">576</span><span class="line-counter cline-yes">&nbsp</span><code>      respectively in the middle). This means that a table can be</code></div>
<div class="source-line"><span class="line-number ">577</span><span class="line-counter cline-yes">&nbsp</span><code>      constructed that uses r0 as an index to the word. We can do the</code></div>
<div class="source-line"><span class="line-number ">578</span><span class="line-counter cline-yes">&nbsp</span><code>      same with r1, r2, and r3, creating a total of 4 tables.</code></div>
<div class="source-line"><span class="line-number ">579</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">580</span><span class="line-counter cline-yes">&nbsp</span><code>      To construct a full c&#39;, we can just look up each byte of c in</code></div>
<div class="source-line"><span class="line-number ">581</span><span class="line-counter cline-yes">&nbsp</span><code>      their respective tables and XOR the results together.</code></div>
<div class="source-line"><span class="line-number ">582</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">583</span><span class="line-counter cline-yes">&nbsp</span><code>      Also, to build each table we only have to calculate the word</code></div>
<div class="source-line"><span class="line-number ">584</span><span class="line-counter cline-yes">&nbsp</span><code>      for 2,1,1,3 for every byte ... which we can do on each iteration</code></div>
<div class="source-line"><span class="line-number ">585</span><span class="line-counter cline-yes">&nbsp</span><code>      of this loop since we will iterate over every byte. After we have</code></div>
<div class="source-line"><span class="line-number ">586</span><span class="line-counter cline-yes">&nbsp</span><code>      calculated 2,1,1,3 we can get the results for the other tables</code></div>
<div class="source-line"><span class="line-number ">587</span><span class="line-counter cline-yes">&nbsp</span><code>      by cycling the byte at the end to the beginning. For instance</code></div>
<div class="source-line"><span class="line-number ">588</span><span class="line-counter cline-yes">&nbsp</span><code>      we can take the result of table 2,1,1,3 and produce table 3,2,1,1</code></div>
<div class="source-line"><span class="line-number ">589</span><span class="line-counter cline-yes">&nbsp</span><code>      by moving the right most byte to the left most position just like</code></div>
<div class="source-line"><span class="line-number ">590</span><span class="line-counter cline-yes">&nbsp</span><code>      how you can imagine the 3 moved out of 2,1,1,3 and to the front</code></div>
<div class="source-line"><span class="line-number ">591</span><span class="line-counter cline-yes">&nbsp</span><code>      to produce 3,2,1,1.</code></div>
<div class="source-line"><span class="line-number ">592</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">593</span><span class="line-counter cline-yes">&nbsp</span><code>      There is another optimization in that the same multiples of</code></div>
<div class="source-line"><span class="line-number ">594</span><span class="line-counter cline-yes">&nbsp</span><code>      the current element we need in order to advance our generator</code></div>
<div class="source-line"><span class="line-number ">595</span><span class="line-counter cline-yes">&nbsp</span><code>      to the next iteration can be reused in performing the 2,1,1,3</code></div>
<div class="source-line"><span class="line-number ">596</span><span class="line-counter cline-yes">&nbsp</span><code>      calculation. We also calculate the inverse mix column tables,</code></div>
<div class="source-line"><span class="line-number ">597</span><span class="line-counter cline-yes">&nbsp</span><code>      with e,9,d,b being the inverse of 2,1,1,3.</code></div>
<div class="source-line"><span class="line-number ">598</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">599</span><span class="line-counter cline-yes">&nbsp</span><code>      When we&#39;re done, and we need to actually mix columns, the first</code></div>
<div class="source-line"><span class="line-number ">600</span><span class="line-counter cline-yes">&nbsp</span><code>      byte of each state word should be put through mix[0] (2,1,1,3),</code></div>
<div class="source-line"><span class="line-number ">601</span><span class="line-counter cline-yes">&nbsp</span><code>      the second through mix[1] (3,2,1,1) and so forth. Then they should</code></div>
<div class="source-line"><span class="line-number ">602</span><span class="line-counter cline-yes">&nbsp</span><code>      be XOR&#39;d together to produce the fully mixed column.</code></div>
<div class="source-line"><span class="line-number ">603</span><span class="line-counter cline-yes">&nbsp</span><code>    */</code></div>
<div class="source-line"><span class="line-number ">604</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">605</span><span class="line-counter cline-yes">&nbsp</span><code>    // calculate mix and imix table values</code></div>
<div class="source-line"><span class="line-number ">606</span><span class="line-counter cline-yes">&nbsp</span><code>    sx2 = xtime[sx];</code></div>
<div class="source-line"><span class="line-number ">607</span><span class="line-counter cline-yes">&nbsp</span><code>    e2 = xtime[e];</code></div>
<div class="source-line"><span class="line-number ">608</span><span class="line-counter cline-yes">&nbsp</span><code>    e4 = xtime[e2];</code></div>
<div class="source-line"><span class="line-number ">609</span><span class="line-counter cline-yes">&nbsp</span><code>    e8 = xtime[e4];</code></div>
<div class="source-line"><span class="line-number ">610</span><span class="line-counter cline-yes">&nbsp</span><code>    me =</code></div>
<div class="source-line"><span class="line-number ">611</span><span class="line-counter cline-yes">&nbsp</span><code>      (sx2 &lt;&lt; 24) ^  // 2</code></div>
<div class="source-line"><span class="line-number ">612</span><span class="line-counter cline-yes">&nbsp</span><code>      (sx &lt;&lt; 16) ^   // 1</code></div>
<div class="source-line"><span class="line-number ">613</span><span class="line-counter cline-yes">&nbsp</span><code>      (sx &lt;&lt; 8) ^    // 1</code></div>
<div class="source-line"><span class="line-number ">614</span><span class="line-counter cline-yes">&nbsp</span><code>      (sx ^ sx2);    // 3</code></div>
<div class="source-line"><span class="line-number ">615</span><span class="line-counter cline-yes">&nbsp</span><code>    ime =</code></div>
<div class="source-line"><span class="line-number ">616</span><span class="line-counter cline-yes">&nbsp</span><code>      (e2 ^ e4 ^ e8) &lt;&lt; 24 ^  // E (14)</code></div>
<div class="source-line"><span class="line-number ">617</span><span class="line-counter cline-yes">&nbsp</span><code>      (e ^ e8) &lt;&lt; 16 ^        // 9</code></div>
<div class="source-line"><span class="line-number ">618</span><span class="line-counter cline-yes">&nbsp</span><code>      (e ^ e4 ^ e8) &lt;&lt; 8 ^    // D (13)</code></div>
<div class="source-line"><span class="line-number ">619</span><span class="line-counter cline-yes">&nbsp</span><code>      (e ^ e2 ^ e8);          // B (11)</code></div>
<div class="source-line"><span class="line-number ">620</span><span class="line-counter cline-yes">&nbsp</span><code>    // produce each of the mix tables by rotating the 2,1,1,3 value</code></div>
<div class="source-line"><span class="line-number ">621</span><span class="line-counter cline-yes">&nbsp</span><code>    for(var n = 0; n &lt; 4; ++n) {</code></div>
<div class="source-line"><span class="line-number ">622</span><span class="line-counter cline-yes">&nbsp</span><code>      mix[n][e] = me;</code></div>
<div class="source-line"><span class="line-number ">623</span><span class="line-counter cline-yes">&nbsp</span><code>      imix[n][sx] = ime;</code></div>
<div class="source-line"><span class="line-number ">624</span><span class="line-counter cline-yes">&nbsp</span><code>      // cycle the right most byte to the left most position</code></div>
<div class="source-line"><span class="line-number ">625</span><span class="line-counter cline-yes">&nbsp</span><code>      // ie: 2,1,1,3 becomes 3,2,1,1</code></div>
<div class="source-line"><span class="line-number ">626</span><span class="line-counter cline-yes">&nbsp</span><code>      me = me &lt;&lt; 24 | me &gt;&gt;&gt; 8;</code></div>
<div class="source-line"><span class="line-number ">627</span><span class="line-counter cline-yes">&nbsp</span><code>      ime = ime &lt;&lt; 24 | ime &gt;&gt;&gt; 8;</code></div>
<div class="source-line"><span class="line-number ">628</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">629</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">630</span><span class="line-counter cline-yes">&nbsp</span><code>    // get next element and inverse</code></div>
<div class="source-line"><span class="line-number ">631</span><span class="line-counter cline-yes">&nbsp</span><code>    if(e === 0) {</code></div>
<div class="source-line"><span class="line-number ">632</span><span class="line-counter cline-yes">&nbsp</span><code>      // 1 is the inverse of 1</code></div>
<div class="source-line"><span class="line-number ">633</span><span class="line-counter cline-yes">&nbsp</span><code>      e = ei = 1;</code></div>
<div class="source-line"><span class="line-number ">634</span><span class="line-counter cline-yes">&nbsp</span><code>    } else {</code></div>
<div class="source-line"><span class="line-number ">635</span><span class="line-counter cline-yes">&nbsp</span><code>      // e = 2e + 2*2*2*(10e)) = multiply e by 82 (chosen generator)</code></div>
<div class="source-line"><span class="line-number ">636</span><span class="line-counter cline-yes">&nbsp</span><code>      // ei = ei + 2*2*ei = multiply ei by 5 (inverse generator)</code></div>
<div class="source-line"><span class="line-number ">637</span><span class="line-counter cline-yes">&nbsp</span><code>      e = e2 ^ xtime[xtime[xtime[e2 ^ e8]]];</code></div>
<div class="source-line"><span class="line-number ">638</span><span class="line-counter cline-yes">&nbsp</span><code>      ei ^= xtime[xtime[ei]];</code></div>
<div class="source-line"><span class="line-number ">639</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">640</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">641</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>
<div class="source-line"><span class="line-number ">642</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">643</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">644</span><span class="line-counter cline-yes">&nbsp</span><code> * Generates a key schedule using the AES key expansion algorithm.</code></div>
<div class="source-line"><span class="line-number ">645</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">646</span><span class="line-counter cline-yes">&nbsp</span><code> * The AES algorithm takes the Cipher Key, K, and performs a Key Expansion</code></div>
<div class="source-line"><span class="line-number ">647</span><span class="line-counter cline-yes">&nbsp</span><code> * routine to generate a key schedule. The Key Expansion generates a total</code></div>
<div class="source-line"><span class="line-number ">648</span><span class="line-counter cline-yes">&nbsp</span><code> * of Nb*(Nr + 1) words: the algorithm requires an initial set of Nb words,</code></div>
<div class="source-line"><span class="line-number ">649</span><span class="line-counter cline-yes">&nbsp</span><code> * and each of the Nr rounds requires Nb words of key data. The resulting</code></div>
<div class="source-line"><span class="line-number ">650</span><span class="line-counter cline-yes">&nbsp</span><code> * key schedule consists of a linear array of 4-byte words, denoted [wi ],</code></div>
<div class="source-line"><span class="line-number ">651</span><span class="line-counter cline-yes">&nbsp</span><code> * with i in the range 0 &lt;= i &lt; Nb(Nr + 1).</code></div>
<div class="source-line"><span class="line-number ">652</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">653</span><span class="line-counter cline-yes">&nbsp</span><code> * KeyExpansion(byte key[4*Nk], word w[Nb*(Nr+1)], Nk)</code></div>
<div class="source-line"><span class="line-number ">654</span><span class="line-counter cline-yes">&nbsp</span><code> * AES-128 (Nb=4, Nk=4, Nr=10)</code></div>
<div class="source-line"><span class="line-number ">655</span><span class="line-counter cline-yes">&nbsp</span><code> * AES-192 (Nb=4, Nk=6, Nr=12)</code></div>
<div class="source-line"><span class="line-number ">656</span><span class="line-counter cline-yes">&nbsp</span><code> * AES-256 (Nb=4, Nk=8, Nr=14)</code></div>
<div class="source-line"><span class="line-number ">657</span><span class="line-counter cline-yes">&nbsp</span><code> * Note: Nr=Nk+6.</code></div>
<div class="source-line"><span class="line-number ">658</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">659</span><span class="line-counter cline-yes">&nbsp</span><code> * Nb is the number of columns (32-bit words) comprising the State (or</code></div>
<div class="source-line"><span class="line-number ">660</span><span class="line-counter cline-yes">&nbsp</span><code> * number of bytes in a block). For AES, Nb=4.</code></div>
<div class="source-line"><span class="line-number ">661</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">662</span><span class="line-counter cline-yes">&nbsp</span><code> * @param key the key to schedule (as an array of 32-bit words).</code></div>
<div class="source-line"><span class="line-number ">663</span><span class="line-counter cline-yes">&nbsp</span><code> * @param decrypt true to modify the key schedule to decrypt, false not to.</code></div>
<div class="source-line"><span class="line-number ">664</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">665</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the generated key schedule.</code></div>
<div class="source-line"><span class="line-number ">666</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">667</span><span class="line-counter cline-yes">&nbsp</span><code>function _expandKey(key, decrypt) {</code></div>
<div class="source-line"><span class="line-number ">668</span><span class="line-counter cline-yes">&nbsp</span><code>  // copy the key&#39;s words to initialize the key schedule</code></div>
<div class="source-line"><span class="line-number ">669</span><span class="line-counter cline-yes">&nbsp</span><code>  var w = key.slice(0);</code></div>
<div class="source-line"><span class="line-number ">670</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">671</span><span class="line-counter cline-yes">&nbsp</span><code>  /* RotWord() will rotate a word, moving the first byte to the last</code></div>
<div class="source-line"><span class="line-number ">672</span><span class="line-counter cline-yes">&nbsp</span><code>    byte&#39;s position (shifting the other bytes left).</code></div>
<div class="source-line"><span class="line-number ">673</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">674</span><span class="line-counter cline-yes">&nbsp</span><code>    We will be getting the value of Rcon at i / Nk. &#39;i&#39; will iterate</code></div>
<div class="source-line"><span class="line-number ">675</span><span class="line-counter cline-yes">&nbsp</span><code>    from Nk to (Nb * Nr+1). Nk = 4 (4 byte key), Nb = 4 (4 words in</code></div>
<div class="source-line"><span class="line-number ">676</span><span class="line-counter cline-yes">&nbsp</span><code>    a block), Nr = Nk + 6 (10). Therefore &#39;i&#39; will iterate from</code></div>
<div class="source-line"><span class="line-number ">677</span><span class="line-counter cline-yes">&nbsp</span><code>    4 to 44 (exclusive). Each time we iterate 4 times, i / Nk will</code></div>
<div class="source-line"><span class="line-number ">678</span><span class="line-counter cline-yes">&nbsp</span><code>    increase by 1. We use a counter iNk to keep track of this.</code></div>
<div class="source-line"><span class="line-number ">679</span><span class="line-counter cline-yes">&nbsp</span><code>   */</code></div>
<div class="source-line"><span class="line-number ">680</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">681</span><span class="line-counter cline-yes">&nbsp</span><code>  // go through the rounds expanding the key</code></div>
<div class="source-line"><span class="line-number ">682</span><span class="line-counter cline-yes">&nbsp</span><code>  var temp, iNk = 1;</code></div>
<div class="source-line"><span class="line-number ">683</span><span class="line-counter cline-yes">&nbsp</span><code>  var Nk = w.length;</code></div>
<div class="source-line"><span class="line-number ">684</span><span class="line-counter cline-yes">&nbsp</span><code>  var Nr1 = Nk + 6 + 1;</code></div>
<div class="source-line"><span class="line-number ">685</span><span class="line-counter cline-yes">&nbsp</span><code>  var end = Nb * Nr1;</code></div>
<div class="source-line"><span class="line-number ">686</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = Nk; i &lt; end; ++i) {</code></div>
<div class="source-line"><span class="line-number ">687</span><span class="line-counter cline-yes">&nbsp</span><code>    temp = w[i - 1];</code></div>
<div class="source-line"><span class="line-number ">688</span><span class="line-counter cline-yes">&nbsp</span><code>    if(i % Nk === 0) {</code></div>
<div class="source-line"><span class="line-number ">689</span><span class="line-counter cline-yes">&nbsp</span><code>      // temp = SubWord(RotWord(temp)) ^ Rcon[i / Nk]</code></div>
<div class="source-line"><span class="line-number ">690</span><span class="line-counter cline-yes">&nbsp</span><code>      temp =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">691</span><span class="line-counter cline-yes">&nbsp</span><code>        sbox[temp &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 24 ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">692</span><span class="line-counter cline-yes">&nbsp</span><code>        sbox[temp &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 16 ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">693</span><span class="line-counter cline-yes">&nbsp</span><code>        sbox[temp &amp; 255] &lt;&lt; 8 ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">694</span><span class="line-counter cline-yes">&nbsp</span><code>        sbox[temp &gt;&gt;&gt; 24] ^ (rcon[iNk] &lt;&lt; 24);</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">695</span><span class="line-counter cline-yes">&nbsp</span><code>      iNk++;</code></div>
<div class="source-line"><span class="line-number ">696</span><span class="line-counter cline-no">！</span><code><span>    } else if(Nk &gt; 6 </span><span class="cstat-no" title="statement not covered">&amp;&amp; (i % Nk === 4)</span><span>) {</span></code></div>
<div class="source-line"><span class="line-number ">697</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // temp = SubWord(temp)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">698</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      temp =</span><span></span></code></div>
<div class="source-line"><span class="line-number ">699</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        sbox[temp &gt;&gt;&gt; 24] &lt;&lt; 24 ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">700</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        sbox[temp &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 16 ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">701</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        sbox[temp &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 8 ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">702</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        sbox[temp &amp; 255];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">703</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">704</span><span class="line-counter cline-yes">&nbsp</span><code>    w[i] = w[i - Nk] ^ temp;</code></div>
<div class="source-line"><span class="line-number ">705</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">706</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">707</span><span class="line-counter cline-yes">&nbsp</span><code>  /* When we are updating a cipher block we always use the code path for</code></div>
<div class="source-line"><span class="line-number ">708</span><span class="line-counter cline-yes">&nbsp</span><code>     encryption whether we are decrypting or not (to shorten code and</code></div>
<div class="source-line"><span class="line-number ">709</span><span class="line-counter cline-yes">&nbsp</span><code>     simplify the generation of look up tables). However, because there</code></div>
<div class="source-line"><span class="line-number ">710</span><span class="line-counter cline-yes">&nbsp</span><code>     are differences in the decryption algorithm, other than just swapping</code></div>
<div class="source-line"><span class="line-number ">711</span><span class="line-counter cline-yes">&nbsp</span><code>     in different look up tables, we must transform our key schedule to</code></div>
<div class="source-line"><span class="line-number ">712</span><span class="line-counter cline-yes">&nbsp</span><code>     account for these changes:</code></div>
<div class="source-line"><span class="line-number ">713</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">714</span><span class="line-counter cline-yes">&nbsp</span><code>     1. The decryption algorithm gets its key rounds in reverse order.</code></div>
<div class="source-line"><span class="line-number ">715</span><span class="line-counter cline-yes">&nbsp</span><code>     2. The decryption algorithm adds the round key before mixing columns</code></div>
<div class="source-line"><span class="line-number ">716</span><span class="line-counter cline-yes">&nbsp</span><code>       instead of afterwards.</code></div>
<div class="source-line"><span class="line-number ">717</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">718</span><span class="line-counter cline-yes">&nbsp</span><code>     We don&#39;t need to modify our key schedule to handle the first case,</code></div>
<div class="source-line"><span class="line-number ">719</span><span class="line-counter cline-yes">&nbsp</span><code>     we can just traverse the key schedule in reverse order when decrypting.</code></div>
<div class="source-line"><span class="line-number ">720</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">721</span><span class="line-counter cline-yes">&nbsp</span><code>     The second case requires a little work.</code></div>
<div class="source-line"><span class="line-number ">722</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">723</span><span class="line-counter cline-yes">&nbsp</span><code>     The tables we built for performing rounds will take an input and then</code></div>
<div class="source-line"><span class="line-number ">724</span><span class="line-counter cline-yes">&nbsp</span><code>     perform SubBytes() and MixColumns() or, for the decrypt version,</code></div>
<div class="source-line"><span class="line-number ">725</span><span class="line-counter cline-yes">&nbsp</span><code>     InvSubBytes() and InvMixColumns(). But the decrypt algorithm requires</code></div>
<div class="source-line"><span class="line-number ">726</span><span class="line-counter cline-yes">&nbsp</span><code>     us to AddRoundKey() before InvMixColumns(). This means we&#39;ll need to</code></div>
<div class="source-line"><span class="line-number ">727</span><span class="line-counter cline-yes">&nbsp</span><code>     apply some transformations to the round key to inverse-mix its columns</code></div>
<div class="source-line"><span class="line-number ">728</span><span class="line-counter cline-yes">&nbsp</span><code>     so they&#39;ll be correct for moving AddRoundKey() to after the state has</code></div>
<div class="source-line"><span class="line-number ">729</span><span class="line-counter cline-yes">&nbsp</span><code>     had its columns inverse-mixed.</code></div>
<div class="source-line"><span class="line-number ">730</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">731</span><span class="line-counter cline-yes">&nbsp</span><code>     To inverse-mix the columns of the state when we&#39;re decrypting we use a</code></div>
<div class="source-line"><span class="line-number ">732</span><span class="line-counter cline-yes">&nbsp</span><code>     lookup table that will apply InvSubBytes() and InvMixColumns() at the</code></div>
<div class="source-line"><span class="line-number ">733</span><span class="line-counter cline-yes">&nbsp</span><code>     same time. However, the round key&#39;s bytes are not inverse-substituted</code></div>
<div class="source-line"><span class="line-number ">734</span><span class="line-counter cline-yes">&nbsp</span><code>     in the decryption algorithm. To get around this problem, we can first</code></div>
<div class="source-line"><span class="line-number ">735</span><span class="line-counter cline-yes">&nbsp</span><code>     substitute the bytes in the round key so that when we apply the</code></div>
<div class="source-line"><span class="line-number ">736</span><span class="line-counter cline-yes">&nbsp</span><code>     transformation via the InvSubBytes()+InvMixColumns() table, it will</code></div>
<div class="source-line"><span class="line-number ">737</span><span class="line-counter cline-yes">&nbsp</span><code>     undo our substitution leaving us with the original value that we</code></div>
<div class="source-line"><span class="line-number ">738</span><span class="line-counter cline-yes">&nbsp</span><code>     want -- and then inverse-mix that value.</code></div>
<div class="source-line"><span class="line-number ">739</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">740</span><span class="line-counter cline-yes">&nbsp</span><code>     This change will correctly alter our key schedule so that we can XOR</code></div>
<div class="source-line"><span class="line-number ">741</span><span class="line-counter cline-yes">&nbsp</span><code>     each round key with our already transformed decryption state. This</code></div>
<div class="source-line"><span class="line-number ">742</span><span class="line-counter cline-yes">&nbsp</span><code>     allows us to use the same code path as the encryption algorithm.</code></div>
<div class="source-line"><span class="line-number ">743</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">744</span><span class="line-counter cline-yes">&nbsp</span><code>     We make one more change to the decryption key. Since the decryption</code></div>
<div class="source-line"><span class="line-number ">745</span><span class="line-counter cline-yes">&nbsp</span><code>     algorithm runs in reverse from the encryption algorithm, we reverse</code></div>
<div class="source-line"><span class="line-number ">746</span><span class="line-counter cline-yes">&nbsp</span><code>     the order of the round keys to avoid having to iterate over the key</code></div>
<div class="source-line"><span class="line-number ">747</span><span class="line-counter cline-yes">&nbsp</span><code>     schedule backwards when running the encryption algorithm later in</code></div>
<div class="source-line"><span class="line-number ">748</span><span class="line-counter cline-yes">&nbsp</span><code>     decryption mode. In addition to reversing the order of the round keys,</code></div>
<div class="source-line"><span class="line-number ">749</span><span class="line-counter cline-yes">&nbsp</span><code>     we also swap each round key&#39;s 2nd and 4th rows. See the comments</code></div>
<div class="source-line"><span class="line-number ">750</span><span class="line-counter cline-yes">&nbsp</span><code>     section where rounds are performed for more details about why this is</code></div>
<div class="source-line"><span class="line-number ">751</span><span class="line-counter cline-yes">&nbsp</span><code>     done. These changes are done inline with the other substitution</code></div>
<div class="source-line"><span class="line-number ">752</span><span class="line-counter cline-yes">&nbsp</span><code>     described above.</code></div>
<div class="source-line"><span class="line-number ">753</span><span class="line-counter cline-yes">&nbsp</span><code>  */</code></div>
<div class="source-line"><span class="line-number ">754</span><span class="line-counter cline-no">！</span><code><span>  if(decrypt) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">755</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var tmp;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">756</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var m0 = imix[0];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">757</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var m1 = imix[1];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">758</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var m2 = imix[2];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">759</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var m3 = imix[3];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">760</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var wnew = w.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">761</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    end = w.length;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">762</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0, wi = end - Nb; i &lt; end; i += Nb, wi -= Nb) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">763</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // do not sub the first or last round key (round keys are Nb</span><span></span></code></div>
<div class="source-line"><span class="line-number ">764</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // words) as no column mixing is performed before they are added,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">765</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // but do change the key order</span><span></span></code></div>
<div class="source-line"><span class="line-number ">766</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      if(i === 0 || i === (end - Nb)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">767</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        wnew[i] = w[wi];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">768</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        wnew[i + 1] = w[wi + 3];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">769</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        wnew[i + 2] = w[wi + 2];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">770</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        wnew[i + 3] = w[wi + 1];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">771</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">772</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // substitute each round key byte because the inverse-mix</span><span></span></code></div>
<div class="source-line"><span class="line-number ">773</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // table will inverse-substitute it (effectively cancel the</span><span></span></code></div>
<div class="source-line"><span class="line-number ">774</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // substitution because round key bytes aren&#39;t sub&#39;d in</span><span></span></code></div>
<div class="source-line"><span class="line-number ">775</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // decryption mode) and swap indexes 3 and 1</span><span></span></code></div>
<div class="source-line"><span class="line-number ">776</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        for(var n = 0; n &lt; Nb; ++n) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">777</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">          tmp = w[wi + n];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">778</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">          wnew[i + (3&amp;-n)] =</span><span></span></code></div>
<div class="source-line"><span class="line-number ">779</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">            m0[sbox[tmp &gt;&gt;&gt; 24]] ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">780</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">            m1[sbox[tmp &gt;&gt;&gt; 16 &amp; 255]] ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">781</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">            m2[sbox[tmp &gt;&gt;&gt; 8 &amp; 255]] ^</span><span></span></code></div>
<div class="source-line"><span class="line-number ">782</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">            m3[sbox[tmp &amp; 255]];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">783</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">784</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">785</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">786</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    w = wnew;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">787</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">788</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">789</span><span class="line-counter cline-yes">&nbsp</span><code>  return w;</code></div>
<div class="source-line"><span class="line-number ">790</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>
<div class="source-line"><span class="line-number ">791</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">792</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">793</span><span class="line-counter cline-yes">&nbsp</span><code> * Updates a single block (16 bytes) using AES. The update will either</code></div>
<div class="source-line"><span class="line-number ">794</span><span class="line-counter cline-yes">&nbsp</span><code> * encrypt or decrypt the block.</code></div>
<div class="source-line"><span class="line-number ">795</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">796</span><span class="line-counter cline-yes">&nbsp</span><code> * @param w the key schedule.</code></div>
<div class="source-line"><span class="line-number ">797</span><span class="line-counter cline-yes">&nbsp</span><code> * @param input the input block (an array of 32-bit words).</code></div>
<div class="source-line"><span class="line-number ">798</span><span class="line-counter cline-yes">&nbsp</span><code> * @param output the updated output block.</code></div>
<div class="source-line"><span class="line-number ">799</span><span class="line-counter cline-yes">&nbsp</span><code> * @param decrypt true to decrypt the block, false to encrypt it.</code></div>
<div class="source-line"><span class="line-number ">800</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">801</span><span class="line-counter cline-yes">&nbsp</span><code>function _updateBlock(w, input, output, decrypt) {</code></div>
<div class="source-line"><span class="line-number ">802</span><span class="line-counter cline-yes">&nbsp</span><code>  /*</code></div>
<div class="source-line"><span class="line-number ">803</span><span class="line-counter cline-yes">&nbsp</span><code>  Cipher(byte in[4*Nb], byte out[4*Nb], word w[Nb*(Nr+1)])</code></div>
<div class="source-line"><span class="line-number ">804</span><span class="line-counter cline-yes">&nbsp</span><code>  begin</code></div>
<div class="source-line"><span class="line-number ">805</span><span class="line-counter cline-yes">&nbsp</span><code>    byte state[4,Nb]</code></div>
<div class="source-line"><span class="line-number ">806</span><span class="line-counter cline-yes">&nbsp</span><code>    state = in</code></div>
<div class="source-line"><span class="line-number ">807</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[0, Nb-1])</code></div>
<div class="source-line"><span class="line-number ">808</span><span class="line-counter cline-yes">&nbsp</span><code>    for round = 1 step 1 to Nr-1</code></div>
<div class="source-line"><span class="line-number ">809</span><span class="line-counter cline-yes">&nbsp</span><code>      SubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">810</span><span class="line-counter cline-yes">&nbsp</span><code>      ShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">811</span><span class="line-counter cline-yes">&nbsp</span><code>      MixColumns(state)</code></div>
<div class="source-line"><span class="line-number ">812</span><span class="line-counter cline-yes">&nbsp</span><code>      AddRoundKey(state, w[round*Nb, (round+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">813</span><span class="line-counter cline-yes">&nbsp</span><code>    end for</code></div>
<div class="source-line"><span class="line-number ">814</span><span class="line-counter cline-yes">&nbsp</span><code>    SubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">815</span><span class="line-counter cline-yes">&nbsp</span><code>    ShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">816</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[Nr*Nb, (Nr+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">817</span><span class="line-counter cline-yes">&nbsp</span><code>    out = state</code></div>
<div class="source-line"><span class="line-number ">818</span><span class="line-counter cline-yes">&nbsp</span><code>  end</code></div>
<div class="source-line"><span class="line-number ">819</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">820</span><span class="line-counter cline-yes">&nbsp</span><code>  InvCipher(byte in[4*Nb], byte out[4*Nb], word w[Nb*(Nr+1)])</code></div>
<div class="source-line"><span class="line-number ">821</span><span class="line-counter cline-yes">&nbsp</span><code>  begin</code></div>
<div class="source-line"><span class="line-number ">822</span><span class="line-counter cline-yes">&nbsp</span><code>    byte state[4,Nb]</code></div>
<div class="source-line"><span class="line-number ">823</span><span class="line-counter cline-yes">&nbsp</span><code>    state = in</code></div>
<div class="source-line"><span class="line-number ">824</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[Nr*Nb, (Nr+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">825</span><span class="line-counter cline-yes">&nbsp</span><code>    for round = Nr-1 step -1 downto 1</code></div>
<div class="source-line"><span class="line-number ">826</span><span class="line-counter cline-yes">&nbsp</span><code>      InvShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">827</span><span class="line-counter cline-yes">&nbsp</span><code>      InvSubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">828</span><span class="line-counter cline-yes">&nbsp</span><code>      AddRoundKey(state, w[round*Nb, (round+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">829</span><span class="line-counter cline-yes">&nbsp</span><code>      InvMixColumns(state)</code></div>
<div class="source-line"><span class="line-number ">830</span><span class="line-counter cline-yes">&nbsp</span><code>    end for</code></div>
<div class="source-line"><span class="line-number ">831</span><span class="line-counter cline-yes">&nbsp</span><code>    InvShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">832</span><span class="line-counter cline-yes">&nbsp</span><code>    InvSubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">833</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[0, Nb-1])</code></div>
<div class="source-line"><span class="line-number ">834</span><span class="line-counter cline-yes">&nbsp</span><code>    out = state</code></div>
<div class="source-line"><span class="line-number ">835</span><span class="line-counter cline-yes">&nbsp</span><code>  end</code></div>
<div class="source-line"><span class="line-number ">836</span><span class="line-counter cline-yes">&nbsp</span><code>  */</code></div>
<div class="source-line"><span class="line-number ">837</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">838</span><span class="line-counter cline-yes">&nbsp</span><code>  // Encrypt: AddRoundKey(state, w[0, Nb-1])</code></div>
<div class="source-line"><span class="line-number ">839</span><span class="line-counter cline-yes">&nbsp</span><code>  // Decrypt: AddRoundKey(state, w[Nr*Nb, (Nr+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">840</span><span class="line-counter cline-yes">&nbsp</span><code>  var Nr = w.length / 4 - 1;</code></div>
<div class="source-line"><span class="line-number ">841</span><span class="line-counter cline-yes">&nbsp</span><code>  var m0, m1, m2, m3, sub;</code></div>
<div class="source-line"><span class="line-number ">842</span><span class="line-counter cline-no">！</span><code><span>  if(decrypt) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">843</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    m0 = imix[0];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">844</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    m1 = imix[1];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">845</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    m2 = imix[2];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">846</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    m3 = imix[3];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">847</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    sub = isbox;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">848</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span> else {</span></code></div>
<div class="source-line"><span class="line-number ">849</span><span class="line-counter cline-yes">&nbsp</span><code>    m0 = mix[0];</code></div>
<div class="source-line"><span class="line-number ">850</span><span class="line-counter cline-yes">&nbsp</span><code>    m1 = mix[1];</code></div>
<div class="source-line"><span class="line-number ">851</span><span class="line-counter cline-yes">&nbsp</span><code>    m2 = mix[2];</code></div>
<div class="source-line"><span class="line-number ">852</span><span class="line-counter cline-yes">&nbsp</span><code>    m3 = mix[3];</code></div>
<div class="source-line"><span class="line-number ">853</span><span class="line-counter cline-yes">&nbsp</span><code>    sub = sbox;</code></div>
<div class="source-line"><span class="line-number ">854</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">855</span><span class="line-counter cline-yes">&nbsp</span><code>  var a, b, c, d, a2, b2, c2;</code></div>
<div class="source-line"><span class="line-number ">856</span><span class="line-counter cline-yes">&nbsp</span><code>  a = input[0] ^ w[0];</code></div>
<div class="source-line"><span class="line-number ">857</span><span class="line-counter cline-no">！</span><code><span>  b = input[decrypt </span><span class="cstat-no" title="statement not covered">? 3</span><span> : 1] ^ w[1];</span></code></div>
<div class="source-line"><span class="line-number ">858</span><span class="line-counter cline-yes">&nbsp</span><code>  c = input[2] ^ w[2];</code></div>
<div class="source-line"><span class="line-number ">859</span><span class="line-counter cline-no">！</span><code><span>  d = input[decrypt </span><span class="cstat-no" title="statement not covered">? 1</span><span> : 3] ^ w[3];</span></code></div>
<div class="source-line"><span class="line-number ">860</span><span class="line-counter cline-yes">&nbsp</span><code>  var i = 3;</code></div>
<div class="source-line"><span class="line-number ">861</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">862</span><span class="line-counter cline-yes">&nbsp</span><code>  /* In order to share code we follow the encryption algorithm when both</code></div>
<div class="source-line"><span class="line-number ">863</span><span class="line-counter cline-yes">&nbsp</span><code>    encrypting and decrypting. To account for the changes required in the</code></div>
<div class="source-line"><span class="line-number ">864</span><span class="line-counter cline-yes">&nbsp</span><code>    decryption algorithm, we use different lookup tables when decrypting</code></div>
<div class="source-line"><span class="line-number ">865</span><span class="line-counter cline-yes">&nbsp</span><code>    and use a modified key schedule to account for the difference in the</code></div>
<div class="source-line"><span class="line-number ">866</span><span class="line-counter cline-yes">&nbsp</span><code>    order of transformations applied when performing rounds. We also get</code></div>
<div class="source-line"><span class="line-number ">867</span><span class="line-counter cline-yes">&nbsp</span><code>    key rounds in reverse order (relative to encryption). */</code></div>
<div class="source-line"><span class="line-number ">868</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var round = 1; round &lt; Nr; ++round) {</code></div>
<div class="source-line"><span class="line-number ">869</span><span class="line-counter cline-yes">&nbsp</span><code>    /* As described above, we&#39;ll be using table lookups to perform the</code></div>
<div class="source-line"><span class="line-number ">870</span><span class="line-counter cline-yes">&nbsp</span><code>      column mixing. Each column is stored as a word in the state (the</code></div>
<div class="source-line"><span class="line-number ">871</span><span class="line-counter cline-yes">&nbsp</span><code>      array &#39;input&#39; has one column as a word at each index). In order to</code></div>
<div class="source-line"><span class="line-number ">872</span><span class="line-counter cline-yes">&nbsp</span><code>      mix a column, we perform these transformations on each row in c,</code></div>
<div class="source-line"><span class="line-number ">873</span><span class="line-counter cline-yes">&nbsp</span><code>      which is 1 byte in each word. The new column for c0 is c&#39;0:</code></div>
<div class="source-line"><span class="line-number ">874</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">875</span><span class="line-counter cline-yes">&nbsp</span><code>               m0      m1      m2      m3</code></div>
<div class="source-line"><span class="line-number ">876</span><span class="line-counter cline-yes">&nbsp</span><code>      r0,c&#39;0 = 2*r0,c0 + 3*r1,c0 + 1*r2,c0 + 1*r3,c0</code></div>
<div class="source-line"><span class="line-number ">877</span><span class="line-counter cline-yes">&nbsp</span><code>      r1,c&#39;0 = 1*r0,c0 + 2*r1,c0 + 3*r2,c0 + 1*r3,c0</code></div>
<div class="source-line"><span class="line-number ">878</span><span class="line-counter cline-yes">&nbsp</span><code>      r2,c&#39;0 = 1*r0,c0 + 1*r1,c0 + 2*r2,c0 + 3*r3,c0</code></div>
<div class="source-line"><span class="line-number ">879</span><span class="line-counter cline-yes">&nbsp</span><code>      r3,c&#39;0 = 3*r0,c0 + 1*r1,c0 + 1*r2,c0 + 2*r3,c0</code></div>
<div class="source-line"><span class="line-number ">880</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">881</span><span class="line-counter cline-yes">&nbsp</span><code>      So using mix tables where c0 is a word with r0 being its upper</code></div>
<div class="source-line"><span class="line-number ">882</span><span class="line-counter cline-yes">&nbsp</span><code>      8 bits and r3 being its lower 8 bits:</code></div>
<div class="source-line"><span class="line-number ">883</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">884</span><span class="line-counter cline-yes">&nbsp</span><code>      m0[c0 &gt;&gt; 24] will yield this word: [2*r0,1*r0,1*r0,3*r0]</code></div>
<div class="source-line"><span class="line-number ">885</span><span class="line-counter cline-yes">&nbsp</span><code>      ...</code></div>
<div class="source-line"><span class="line-number ">886</span><span class="line-counter cline-yes">&nbsp</span><code>      m3[c0 &amp; 255] will yield this word: [1*r3,1*r3,3*r3,2*r3]</code></div>
<div class="source-line"><span class="line-number ">887</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">888</span><span class="line-counter cline-yes">&nbsp</span><code>      Therefore to mix the columns in each word in the state we</code></div>
<div class="source-line"><span class="line-number ">889</span><span class="line-counter cline-yes">&nbsp</span><code>      do the following (&amp; 255 omitted for brevity):</code></div>
<div class="source-line"><span class="line-number ">890</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0,r0 = m0[c0 &gt;&gt; 24] ^ m1[c1 &gt;&gt; 16] ^ m2[c2 &gt;&gt; 8] ^ m3[c3]</code></div>
<div class="source-line"><span class="line-number ">891</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0,r1 = m0[c0 &gt;&gt; 24] ^ m1[c1 &gt;&gt; 16] ^ m2[c2 &gt;&gt; 8] ^ m3[c3]</code></div>
<div class="source-line"><span class="line-number ">892</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0,r2 = m0[c0 &gt;&gt; 24] ^ m1[c1 &gt;&gt; 16] ^ m2[c2 &gt;&gt; 8] ^ m3[c3]</code></div>
<div class="source-line"><span class="line-number ">893</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0,r3 = m0[c0 &gt;&gt; 24] ^ m1[c1 &gt;&gt; 16] ^ m2[c2 &gt;&gt; 8] ^ m3[c3]</code></div>
<div class="source-line"><span class="line-number ">894</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">895</span><span class="line-counter cline-yes">&nbsp</span><code>      However, before mixing, the algorithm requires us to perform</code></div>
<div class="source-line"><span class="line-number ">896</span><span class="line-counter cline-yes">&nbsp</span><code>      ShiftRows(). The ShiftRows() transformation cyclically shifts the</code></div>
<div class="source-line"><span class="line-number ">897</span><span class="line-counter cline-yes">&nbsp</span><code>      last 3 rows of the state over different offsets. The first row</code></div>
<div class="source-line"><span class="line-number ">898</span><span class="line-counter cline-yes">&nbsp</span><code>      (r = 0) is not shifted.</code></div>
<div class="source-line"><span class="line-number ">899</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">900</span><span class="line-counter cline-yes">&nbsp</span><code>      s&#39;_r,c = s_r,(c + shift(r, Nb) mod Nb</code></div>
<div class="source-line"><span class="line-number ">901</span><span class="line-counter cline-yes">&nbsp</span><code>      for 0 &lt; r &lt; 4 and 0 &lt;= c &lt; Nb and</code></div>
<div class="source-line"><span class="line-number ">902</span><span class="line-counter cline-yes">&nbsp</span><code>      shift(1, 4) = 1</code></div>
<div class="source-line"><span class="line-number ">903</span><span class="line-counter cline-yes">&nbsp</span><code>      shift(2, 4) = 2</code></div>
<div class="source-line"><span class="line-number ">904</span><span class="line-counter cline-yes">&nbsp</span><code>      shift(3, 4) = 3.</code></div>
<div class="source-line"><span class="line-number ">905</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">906</span><span class="line-counter cline-yes">&nbsp</span><code>      This causes the first byte in r = 1 to be moved to the end of</code></div>
<div class="source-line"><span class="line-number ">907</span><span class="line-counter cline-yes">&nbsp</span><code>      the row, the first 2 bytes in r = 2 to be moved to the end of</code></div>
<div class="source-line"><span class="line-number ">908</span><span class="line-counter cline-yes">&nbsp</span><code>      the row, the first 3 bytes in r = 3 to be moved to the end of</code></div>
<div class="source-line"><span class="line-number ">909</span><span class="line-counter cline-yes">&nbsp</span><code>      the row:</code></div>
<div class="source-line"><span class="line-number ">910</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">911</span><span class="line-counter cline-yes">&nbsp</span><code>      r1: [c0 c1 c2 c3] =&gt; [c1 c2 c3 c0]</code></div>
<div class="source-line"><span class="line-number ">912</span><span class="line-counter cline-yes">&nbsp</span><code>      r2: [c0 c1 c2 c3]    [c2 c3 c0 c1]</code></div>
<div class="source-line"><span class="line-number ">913</span><span class="line-counter cline-yes">&nbsp</span><code>      r3: [c0 c1 c2 c3]    [c3 c0 c1 c2]</code></div>
<div class="source-line"><span class="line-number ">914</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">915</span><span class="line-counter cline-yes">&nbsp</span><code>      We can make these substitutions inline with our column mixing to</code></div>
<div class="source-line"><span class="line-number ">916</span><span class="line-counter cline-yes">&nbsp</span><code>      generate an updated set of equations to produce each word in the</code></div>
<div class="source-line"><span class="line-number ">917</span><span class="line-counter cline-yes">&nbsp</span><code>      state (note the columns have changed positions):</code></div>
<div class="source-line"><span class="line-number ">918</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">919</span><span class="line-counter cline-yes">&nbsp</span><code>      c0 c1 c2 c3 =&gt; c0 c1 c2 c3</code></div>
<div class="source-line"><span class="line-number ">920</span><span class="line-counter cline-yes">&nbsp</span><code>      c0 c1 c2 c3    c1 c2 c3 c0  (cycled 1 byte)</code></div>
<div class="source-line"><span class="line-number ">921</span><span class="line-counter cline-yes">&nbsp</span><code>      c0 c1 c2 c3    c2 c3 c0 c1  (cycled 2 bytes)</code></div>
<div class="source-line"><span class="line-number ">922</span><span class="line-counter cline-yes">&nbsp</span><code>      c0 c1 c2 c3    c3 c0 c1 c2  (cycled 3 bytes)</code></div>
<div class="source-line"><span class="line-number ">923</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">924</span><span class="line-counter cline-yes">&nbsp</span><code>      Therefore:</code></div>
<div class="source-line"><span class="line-number ">925</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">926</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0 = 2*r0,c0 + 3*r1,c1 + 1*r2,c2 + 1*r3,c3</code></div>
<div class="source-line"><span class="line-number ">927</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0 = 1*r0,c0 + 2*r1,c1 + 3*r2,c2 + 1*r3,c3</code></div>
<div class="source-line"><span class="line-number ">928</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0 = 1*r0,c0 + 1*r1,c1 + 2*r2,c2 + 3*r3,c3</code></div>
<div class="source-line"><span class="line-number ">929</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;0 = 3*r0,c0 + 1*r1,c1 + 1*r2,c2 + 2*r3,c3</code></div>
<div class="source-line"><span class="line-number ">930</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">931</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;1 = 2*r0,c1 + 3*r1,c2 + 1*r2,c3 + 1*r3,c0</code></div>
<div class="source-line"><span class="line-number ">932</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;1 = 1*r0,c1 + 2*r1,c2 + 3*r2,c3 + 1*r3,c0</code></div>
<div class="source-line"><span class="line-number ">933</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;1 = 1*r0,c1 + 1*r1,c2 + 2*r2,c3 + 3*r3,c0</code></div>
<div class="source-line"><span class="line-number ">934</span><span class="line-counter cline-yes">&nbsp</span><code>      c&#39;1 = 3*r0,c1 + 1*r1,c2 + 1*r2,c3 + 2*r3,c0</code></div>
<div class="source-line"><span class="line-number ">935</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">936</span><span class="line-counter cline-yes">&nbsp</span><code>      ... and so forth for c&#39;2 and c&#39;3. The important distinction is</code></div>
<div class="source-line"><span class="line-number ">937</span><span class="line-counter cline-yes">&nbsp</span><code>      that the columns are cycling, with c0 being used with the m0</code></div>
<div class="source-line"><span class="line-number ">938</span><span class="line-counter cline-yes">&nbsp</span><code>      map when calculating c0, but c1 being used with the m0 map when</code></div>
<div class="source-line"><span class="line-number ">939</span><span class="line-counter cline-yes">&nbsp</span><code>      calculating c1 ... and so forth.</code></div>
<div class="source-line"><span class="line-number ">940</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">941</span><span class="line-counter cline-yes">&nbsp</span><code>      When performing the inverse we transform the mirror image and</code></div>
<div class="source-line"><span class="line-number ">942</span><span class="line-counter cline-yes">&nbsp</span><code>      skip the bottom row, instead of the top one, and move upwards:</code></div>
<div class="source-line"><span class="line-number ">943</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">944</span><span class="line-counter cline-yes">&nbsp</span><code>      c3 c2 c1 c0 =&gt; c0 c3 c2 c1  (cycled 3 bytes) *same as encryption</code></div>
<div class="source-line"><span class="line-number ">945</span><span class="line-counter cline-yes">&nbsp</span><code>      c3 c2 c1 c0    c1 c0 c3 c2  (cycled 2 bytes)</code></div>
<div class="source-line"><span class="line-number ">946</span><span class="line-counter cline-yes">&nbsp</span><code>      c3 c2 c1 c0    c2 c1 c0 c3  (cycled 1 byte)  *same as encryption</code></div>
<div class="source-line"><span class="line-number ">947</span><span class="line-counter cline-yes">&nbsp</span><code>      c3 c2 c1 c0    c3 c2 c1 c0</code></div>
<div class="source-line"><span class="line-number ">948</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">949</span><span class="line-counter cline-yes">&nbsp</span><code>      If you compare the resulting matrices for ShiftRows()+MixColumns()</code></div>
<div class="source-line"><span class="line-number ">950</span><span class="line-counter cline-yes">&nbsp</span><code>      and for InvShiftRows()+InvMixColumns() the 2nd and 4th columns are</code></div>
<div class="source-line"><span class="line-number ">951</span><span class="line-counter cline-yes">&nbsp</span><code>      different (in encrypt mode vs. decrypt mode). So in order to use</code></div>
<div class="source-line"><span class="line-number ">952</span><span class="line-counter cline-yes">&nbsp</span><code>      the same code to handle both encryption and decryption, we will</code></div>
<div class="source-line"><span class="line-number ">953</span><span class="line-counter cline-yes">&nbsp</span><code>      need to do some mapping.</code></div>
<div class="source-line"><span class="line-number ">954</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">955</span><span class="line-counter cline-yes">&nbsp</span><code>      If in encryption mode we let a=c0, b=c1, c=c2, d=c3, and r&lt;N&gt; be</code></div>
<div class="source-line"><span class="line-number ">956</span><span class="line-counter cline-yes">&nbsp</span><code>      a row number in the state, then the resulting matrix in encryption</code></div>
<div class="source-line"><span class="line-number ">957</span><span class="line-counter cline-yes">&nbsp</span><code>      mode for applying the above transformations would be:</code></div>
<div class="source-line"><span class="line-number ">958</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">959</span><span class="line-counter cline-yes">&nbsp</span><code>      r1: a b c d</code></div>
<div class="source-line"><span class="line-number ">960</span><span class="line-counter cline-yes">&nbsp</span><code>      r2: b c d a</code></div>
<div class="source-line"><span class="line-number ">961</span><span class="line-counter cline-yes">&nbsp</span><code>      r3: c d a b</code></div>
<div class="source-line"><span class="line-number ">962</span><span class="line-counter cline-yes">&nbsp</span><code>      r4: d a b c</code></div>
<div class="source-line"><span class="line-number ">963</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">964</span><span class="line-counter cline-yes">&nbsp</span><code>      If we did the same in decryption mode we would get:</code></div>
<div class="source-line"><span class="line-number ">965</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">966</span><span class="line-counter cline-yes">&nbsp</span><code>      r1: a d c b</code></div>
<div class="source-line"><span class="line-number ">967</span><span class="line-counter cline-yes">&nbsp</span><code>      r2: b a d c</code></div>
<div class="source-line"><span class="line-number ">968</span><span class="line-counter cline-yes">&nbsp</span><code>      r3: c b a d</code></div>
<div class="source-line"><span class="line-number ">969</span><span class="line-counter cline-yes">&nbsp</span><code>      r4: d c b a</code></div>
<div class="source-line"><span class="line-number ">970</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">971</span><span class="line-counter cline-yes">&nbsp</span><code>      If instead we swap d and b (set b=c3 and d=c1), then we get:</code></div>
<div class="source-line"><span class="line-number ">972</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">973</span><span class="line-counter cline-yes">&nbsp</span><code>      r1: a b c d</code></div>
<div class="source-line"><span class="line-number ">974</span><span class="line-counter cline-yes">&nbsp</span><code>      r2: d a b c</code></div>
<div class="source-line"><span class="line-number ">975</span><span class="line-counter cline-yes">&nbsp</span><code>      r3: c d a b</code></div>
<div class="source-line"><span class="line-number ">976</span><span class="line-counter cline-yes">&nbsp</span><code>      r4: b c d a</code></div>
<div class="source-line"><span class="line-number ">977</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">978</span><span class="line-counter cline-yes">&nbsp</span><code>      Now the 1st and 3rd rows are the same as the encryption matrix. All</code></div>
<div class="source-line"><span class="line-number ">979</span><span class="line-counter cline-yes">&nbsp</span><code>      we need to do then to make the mapping exactly the same is to swap</code></div>
<div class="source-line"><span class="line-number ">980</span><span class="line-counter cline-yes">&nbsp</span><code>      the 2nd and 4th rows when in decryption mode. To do this without</code></div>
<div class="source-line"><span class="line-number ">981</span><span class="line-counter cline-yes">&nbsp</span><code>      having to do it on each iteration, we swapped the 2nd and 4th rows</code></div>
<div class="source-line"><span class="line-number ">982</span><span class="line-counter cline-yes">&nbsp</span><code>      in the decryption key schedule. We also have to do the swap above</code></div>
<div class="source-line"><span class="line-number ">983</span><span class="line-counter cline-yes">&nbsp</span><code>      when we first pull in the input and when we set the final output. */</code></div>
<div class="source-line"><span class="line-number ">984</span><span class="line-counter cline-yes">&nbsp</span><code>    a2 =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">985</span><span class="line-counter cline-yes">&nbsp</span><code>      m0[a &gt;&gt;&gt; 24] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">986</span><span class="line-counter cline-yes">&nbsp</span><code>      m1[b &gt;&gt;&gt; 16 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">987</span><span class="line-counter cline-yes">&nbsp</span><code>      m2[c &gt;&gt;&gt; 8 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">988</span><span class="line-counter cline-yes">&nbsp</span><code>      m3[d &amp; 255] ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">989</span><span class="line-counter cline-yes">&nbsp</span><code>    b2 =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">990</span><span class="line-counter cline-yes">&nbsp</span><code>      m0[b &gt;&gt;&gt; 24] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">991</span><span class="line-counter cline-yes">&nbsp</span><code>      m1[c &gt;&gt;&gt; 16 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">992</span><span class="line-counter cline-yes">&nbsp</span><code>      m2[d &gt;&gt;&gt; 8 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">993</span><span class="line-counter cline-yes">&nbsp</span><code>      m3[a &amp; 255] ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">994</span><span class="line-counter cline-yes">&nbsp</span><code>    c2 =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">995</span><span class="line-counter cline-yes">&nbsp</span><code>      m0[c &gt;&gt;&gt; 24] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">996</span><span class="line-counter cline-yes">&nbsp</span><code>      m1[d &gt;&gt;&gt; 16 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">997</span><span class="line-counter cline-yes">&nbsp</span><code>      m2[a &gt;&gt;&gt; 8 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">998</span><span class="line-counter cline-yes">&nbsp</span><code>      m3[b &amp; 255] ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">999</span><span class="line-counter cline-yes">&nbsp</span><code>    d =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">1000</span><span class="line-counter cline-yes">&nbsp</span><code>      m0[d &gt;&gt;&gt; 24] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1001</span><span class="line-counter cline-yes">&nbsp</span><code>      m1[a &gt;&gt;&gt; 16 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1002</span><span class="line-counter cline-yes">&nbsp</span><code>      m2[b &gt;&gt;&gt; 8 &amp; 255] ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1003</span><span class="line-counter cline-yes">&nbsp</span><code>      m3[c &amp; 255] ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">1004</span><span class="line-counter cline-yes">&nbsp</span><code>    a = a2;</code></div>
<div class="source-line"><span class="line-number ">1005</span><span class="line-counter cline-yes">&nbsp</span><code>    b = b2;</code></div>
<div class="source-line"><span class="line-number ">1006</span><span class="line-counter cline-yes">&nbsp</span><code>    c = c2;</code></div>
<div class="source-line"><span class="line-number ">1007</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">1008</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">1009</span><span class="line-counter cline-yes">&nbsp</span><code>  /*</code></div>
<div class="source-line"><span class="line-number ">1010</span><span class="line-counter cline-yes">&nbsp</span><code>    Encrypt:</code></div>
<div class="source-line"><span class="line-number ">1011</span><span class="line-counter cline-yes">&nbsp</span><code>    SubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">1012</span><span class="line-counter cline-yes">&nbsp</span><code>    ShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">1013</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[Nr*Nb, (Nr+1)*Nb-1])</code></div>
<div class="source-line"><span class="line-number ">1014</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">1015</span><span class="line-counter cline-yes">&nbsp</span><code>    Decrypt:</code></div>
<div class="source-line"><span class="line-number ">1016</span><span class="line-counter cline-yes">&nbsp</span><code>    InvShiftRows(state)</code></div>
<div class="source-line"><span class="line-number ">1017</span><span class="line-counter cline-yes">&nbsp</span><code>    InvSubBytes(state)</code></div>
<div class="source-line"><span class="line-number ">1018</span><span class="line-counter cline-yes">&nbsp</span><code>    AddRoundKey(state, w[0, Nb-1])</code></div>
<div class="source-line"><span class="line-number ">1019</span><span class="line-counter cline-yes">&nbsp</span><code>   */</code></div>
<div class="source-line"><span class="line-number ">1020</span><span class="line-counter cline-yes">&nbsp</span><code>  // Note: rows are shifted inline</code></div>
<div class="source-line"><span class="line-number ">1021</span><span class="line-counter cline-yes">&nbsp</span><code>  output[0] =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">1022</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[a &gt;&gt;&gt; 24] &lt;&lt; 24) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1023</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[b &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 16) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1024</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[c &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 8) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1025</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[d &amp; 255]) ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">1026</span><span class="line-counter cline-no">！</span><code><span>  output[decrypt </span><span class="cstat-no" title="statement not covered">? 3</span><span> : 1] =</span></code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">1027</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[b &gt;&gt;&gt; 24] &lt;&lt; 24) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1028</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[c &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 16) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1029</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[d &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 8) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1030</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[a &amp; 255]) ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">1031</span><span class="line-counter cline-yes">&nbsp</span><code>  output[2] =</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">1032</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[c &gt;&gt;&gt; 24] &lt;&lt; 24) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1033</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[d &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 16) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1034</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[a &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 8) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1035</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[b &amp; 255]) ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">1036</span><span class="line-counter cline-no">！</span><code><span>  output[decrypt </span><span class="cstat-no" title="statement not covered">? 1</span><span> : 3] =</span></code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">1037</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[d &gt;&gt;&gt; 24] &lt;&lt; 24) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1038</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[a &gt;&gt;&gt; 16 &amp; 255] &lt;&lt; 16) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1039</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[b &gt;&gt;&gt; 8 &amp; 255] &lt;&lt; 8) ^</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">1040</span><span class="line-counter cline-yes">&nbsp</span><code>    (sub[c &amp; 255]) ^ w[++i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-ECB">
                        <summary>💥&nbsp;<i>ECB</i> Secret-dependent memory access</summary>
                <div class="issue-description">[ECB] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">1041</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>
<div class="source-line"><span class="line-number ">1042</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">1043</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">1044</span><span class="line-counter cline-yes">&nbsp</span><code> * Deprecated. Instead, use:</code></div>
<div class="source-line"><span class="line-number ">1045</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">1046</span><span class="line-counter cline-yes">&nbsp</span><code> * forge.cipher.createCipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">1047</span><span class="line-counter cline-yes">&nbsp</span><code> * forge.cipher.createDecipher(&#39;AES-&lt;mode&gt;&#39;, key);</code></div>
<div class="source-line"><span class="line-number ">1048</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">1049</span><span class="line-counter cline-yes">&nbsp</span><code> * Creates a deprecated AES cipher object. This object&#39;s mode will default to</code></div>
<div class="source-line"><span class="line-number ">1050</span><span class="line-counter cline-yes">&nbsp</span><code> * CBC (cipher-block-chaining).</code></div>
<div class="source-line"><span class="line-number ">1051</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">1052</span><span class="line-counter cline-yes">&nbsp</span><code> * The key and iv may be given as a string of bytes, an array of bytes, a</code></div>
<div class="source-line"><span class="line-number ">1053</span><span class="line-counter cline-yes">&nbsp</span><code> * byte buffer, or an array of 32-bit words.</code></div>
<div class="source-line"><span class="line-number ">1054</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">1055</span><span class="line-counter cline-yes">&nbsp</span><code> * @param options the options to use.</code></div>
<div class="source-line"><span class="line-number ">1056</span><span class="line-counter cline-yes">&nbsp</span><code> *          key the symmetric key to use.</code></div>
<div class="source-line"><span class="line-number ">1057</span><span class="line-counter cline-yes">&nbsp</span><code> *          output the buffer to write to.</code></div>
<div class="source-line"><span class="line-number ">1058</span><span class="line-counter cline-yes">&nbsp</span><code> *          decrypt true for decryption, false for encryption.</code></div>
<div class="source-line"><span class="line-number ">1059</span><span class="line-counter cline-yes">&nbsp</span><code> *          mode the cipher mode to use (default: &#39;CBC&#39;).</code></div>
<div class="source-line"><span class="line-number ">1060</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">1061</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the cipher.</code></div>
<div class="source-line"><span class="line-number ">1062</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">1063</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">function _createCipher(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1064</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1065</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var mode = (options.mode || &#39;CBC&#39;).toUpperCase();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1066</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var algorithm = &#39;AES-&#39; + mode;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1067</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">1068</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1069</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(options.decrypt) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1070</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    cipher = forge.cipher.createDecipher(algorithm, options.key);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1071</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1072</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    cipher = forge.cipher.createCipher(algorithm, options.key);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1073</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1074</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">1075</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // backwards compatible start API</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1076</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var start = cipher.start;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1077</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  cipher.start = function(iv, options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1078</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // backwards compatibility: support second arg as output buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1079</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var output = null;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1080</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(options instanceof forge.util.ByteBuffer) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1081</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output = options;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1082</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      options = {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1083</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1084</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1085</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    options.output = output;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1086</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    options.iv = iv;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1087</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    start.call(cipher, options);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1088</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  };</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1089</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">1090</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">1091</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span></span></code></div>

    </div>
    <script>

        const ISSUE_TYPE_CLASSES_OR_NAME = {
			'severity-critical': 'issue-critical',
			'severity-major': 'issue-major',
			'severity-minor': 'issue-minor',
			'issue-type-memory-access': 'issue-memory-access',
			'issue-type-branch': 'issue-branch',
		};
            ISSUE_TYPE_CLASSES_OR_NAME['target-RSASIGN'] = 'target-RSASIGN';
            ISSUE_TYPE_CLASSES_OR_NAME['target-DECODE'] = 'target-DECODE';
            ISSUE_TYPE_CLASSES_OR_NAME['target-ECB'] = 'target-ECB';
            ISSUE_TYPE_CLASSES_OR_NAME['target-RSASIGN'] = 'target-RSASIGN';
            ISSUE_TYPE_CLASSES_OR_NAME['target-GCM'] = 'target-GCM';
            ISSUE_TYPE_CLASSES_OR_NAME['target-ECB'] = 'target-ECB';
            ISSUE_TYPE_CLASSES_OR_NAME['target-GCM'] = 'target-GCM';

		const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const buttons = document.querySelectorAll('input[type="button"]');

		function change() {
            var elem = document.getElementById('button1');
            const fold = ' Fold leak details ';
            const deploy = ' Deploy leak details ';
            if (elem.innerHTML === deploy) {
                elem.innerHTML = fold;
            } else if (elem.innerHTML === fold) {
                elem.innerHTML = deploy;
            } else {
                console.log(elem.innerHTML);
            }

            const issueSummaries = document.querySelectorAll('details.issue-inline-message' + ' summary');
            const issueSummariesOpen = document.querySelectorAll('details.issue-inline-message[open]' + ' summary');
            const issueSummariesArray = Array.from(issueSummaries);
            const issueSummariesOpenArray = Array.from(issueSummariesOpen);

            if (elem.innerHTML === fold) {
                let issueSummariesClose = [];
                for (let i = 0; i < issueSummariesArray.length; i++) {
                    const issue = issueSummariesArray[i];
                    if (!(issueSummariesOpenArray.includes(issue))) {
                        issueSummariesClose.push(issue);
                    }
                }
                for (let k = 0; k < issueSummariesClose.length; k++) {
		            issueSummariesClose[k].click();
		            for (let i = 0; i < 5 ; i++) {
		                checkboxes[i].checked = true;
            	    }
            	}
            } else if (elem.innerHTML === deploy) {
                for (let k = 0; k < issueSummariesOpen.length; k++) {
	                issueSummariesOpenArray[k].click()
	                for (let i = 0; i < 5 ; i++) { // 5 first checkboxes are Severity and Issue type one, others are for target-name
		                checkboxes[i].checked = false;
            	   }
                }
            } else {
                console.log("error");
            }
        }

        change();

        var lastClick = ["0"];
		for (let i = 0; i < checkboxes.length; i++) {
		    checkboxes[i].addEventListener('change', () => {
// 		        console.log(ISSUE_TYPE_CLASSES_OR_NAME[checkboxes[i].name]);
		        const issueSelector = '.' + ISSUE_TYPE_CLASSES_OR_NAME[checkboxes[i].name];
		        const issueSummaries = document.querySelectorAll('details' + issueSelector + ' > summary');
		        for (let i = 0; i < issueSummaries.length; i++) {
			        issueSummaries[i].click();
			    }
	        });
	   }
       
    </script>
  </body>
</html>