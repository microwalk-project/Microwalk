<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>CQR visualizer</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
	<meta http-equiv="content-security-policy" content="script-src 'unsafe-inline'">
	<style>
		html, body, div, span, applet, object, iframe,
		h1, h2, h3, h4, h5, h6, p, blockquote, pre,
		a, abbr, acronym, address, big, cite, code,
		del, dfn, em, img, ins, kbd, q, s, samp,
		small, strike, strong, sub, sup, tt, var,
		b, u, i, center,
		dl, dt, dd, ol, ul, li,
		fieldset, form, label, legend,
		table, caption, tbody, tfoot, thead, tr, th, td,
		article, aside, canvas, details, embed,
		figure, figcaption, footer, header, hgroup,
		menu, nav, output, ruby, section, summary,
		time, mark, audio, video {
			margin: 0;
			padding: 0;
			border: 0;
			font-size: 100%;
			font: inherit;
			vertical-align: baseline;
		}
		/* HTML5 display-role reset for older browsers */
		article, aside, details, figcaption, figure,
		footer, header, hgroup, menu, nav, section {
			display: block;
		}
		header {
            position : static;
        }
		body {
			line-height: 1;
		}
		ol, ul {
			list-style: none;
		}
		blockquote, q {
			quotes: none;
		}
		blockquote:before, blockquote:after,
		q:before, q:after {
			content: '';
			content: none;
		}
		table {
			border-collapse: collapse;
			border-spacing: 0;
		}

		:root {
			--accent-color: #DC8ADD78;
            --height: 12px;
		}
		body {
			font-family: monospace;
		}
		header {
    		background-color: var(--accent-color);
    		color: black;
    		margin-bottom: 1em;
    		padding: 1em 3em;
    		font-size: 20px;
    	}
    	code {
    		white-space: break-spaces;
    	}

        .header-text {
            font-size: 0.6em;
        }

    	.line-number {
    		text-align: right;
    		display: inline-block;
    		min-width: 4em;
    		margin-right: 8px;
    		border-right: 4px solid var(--accent-color);
    		padding-right: 8px;
    	}
    	.line-number, code {
    		padding-top: 2px;
    		padding-bottom: 2px;
    	}
    	.issue-line .line-number {
    		background-color: #ff00008f;
    	}
    	.issue-inline-message {
    		background-color: #e8e3e8;
			margin: 5px 0;
    		padding: 1em 5em;
    		border-top: 1px solid #4E464E;
    		border-bottom: 1px solid #4E464E;
    	}
    	.issue-inline-message > details {
    		font-weight: bold;
    		margin-bottom: 1em;
    	}
    	.issue-inline-message.issue-critical > summary {
    		color: #C81E1E;
    	}
    	.issue-inline-message.issue-major > summary {
    		color: #AD5100;
    	}
    	.issue-inline-message.issue-minor > summary {
    		color: #615900;
    	}
    	p {
    		font-size: 0.em;
    		margin-top: 0.5em;
    	}
    	h1 {
    	    font-size: 2em;
            margin-bottom: 0.2em;

    	}
    	.In-the-target {
    	    font-size: 0.7em;
    	}
    	details {
            border-radius: 4px;
            padding: 0.5em 0.5em 0;
        }
        summary {
            font-weight: bold;
            margin: -0.5em -0.5em 0;
            padding: 0.5em;
        }
        details.header-issue-counter[open] {
            padding: 0.5em;
        }
        details.issue-inline-message[open] {
            background-color: #c5299e24;
            padding: 1em 5em;
            /*margin-bottom: 1em;*/
        }
        details.header-issue-counter[open] summary {
            border-bottom: 1px solid black;
            margin-bottom: 0.5em;
        }
        details.issue-inline-message[open] summary {
            /*background-color: #c5299e24;*/
    		margin-bottom: 1em;
        }
        i {
            color: black;
        }
        input[type="checkbox"] {
			accent-color: black;
		}
		button {
		    border: 0;
            line-height: 2.5;
            padding: 0 20px;
            font-size: 1rem;
            text-align: center;
            color: #fff;
            text-shadow: 1px 1px 1px #000;
            border-radius: 10px;
            background-color: rgba(220, 0, 0, 1);
            background-image: linear-gradient(to top left, rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2) 30%, rgba(0, 0, 0, 0));
            box-shadow: inset 2px 2px 3px rgba(255, 255, 255, 0.6), inset -2px -2px 3px rgba(0, 0, 0, 0.6);
		}
		.deploy-button:hover {
            background-color: rgba(255, 0, 0, 1);
        }

        .deploy-button:active {
            box-shadow: inset -2px -2px 3px rgba(255, 255, 255, 0.6), inset 2px 2px 3px rgba(0, 0, 0, 0.6);
        }

        .cstat-no {
          background: #F6C6CE;
        }
        .line-number2 {
    		text-align: right;
    		display: inline-block;
    		min-width: 4em;
    		padding-right: 8px;
            border-right: 4px solid var(--accent-color);
    	}
    	.line-number2, code {
    		padding-top: 2px;
    		padding-bottom: 2px;
    	}
    	.source-line {
        }
        .line-counter {
    		text-align: center;
    		display: inline-block;

            height: var(--height);
    		min-width: 4em;
    		margin-right: 8px;
    		border-right: 4px
    		padding-right: 8px;
    	}

        .cline-yes {
          background: rgb(230,245,208);
          padding-top: 2px;
          padding-bottom: 2px;
        }

        .cline-no {
          background: #FCE1E5;
          padding-top: 2px;
          padding-bottom: 2px;
        }

        .header-option{
          line-height: 1;
        }

        .filter-inputs {
            display: flex;
            align-items: center;
            margin-bottom: 0.5em;
        }
        
        .button-container {
            flex: 0 0 auto;
            margin-right: 20px; 
            display: flex;
            align-items: center;
        }
        
        .options-container {
            display: flex;
            flex-direction: column;
        }
        
        .severity-options, .issue-type-options {
            margin-top: 1px;
        }

    </style>
  </head>
  <body>
  <div class="grid-container">
    <div class="head">
    <header>
<h1>node-forge/lib/cipherModes.js</h1>
        <div class="filter-inputs">
            <div class="button-container">
                <button onclick="change()" title="Click here to expand or collapse all leak details!" class="deploy-button" Id="button1"> Deploy leak details </button>
            </div>
            <div class="options-container">
                <div class="severity-options">
                    <span class="header-option">Severity:</span>
                    <label><input type="checkbox" name="severity-critical" > Critical</label>
                    <label><input type="checkbox" name="severity-major" > Major</label>
                    <label><input type="checkbox" name="severity-minor" > Minor</label>
                </div>
                <div class="issue-type-options">
                    <span>Issue type:</span>
                    <label><input type="checkbox" name="issue-type-memory-access" > Memory access</label>
                    <label><input type="checkbox" name="issue-type-branch" > Branch</label>
                </div>
            </div>
        </div>
        <p class="header-text">Total number of problem found: 13 out of 180</p>
        <p class="header-text">Number of critical in file: 8   ≅ 62%</p>
        <p class="header-text">Number of memory access error in file: 13   ≅ 100%</p>
        <p class="header-text">Coverage proportion (on the number of character): 15668 / 27918   ≅ 56%</p>
        <p class="header-text">Coverage proportion (on the number of line): 588 / 999   ≅ 59%</p><details open class="header-issue-counter"><summary class="In-the-target"><name="target-GCM" Id="GCM" <h2>In the target-GCM</h2></summary>
            <p class="header-text">Number of problem found: 13</p>
            <p class="header-text">Number of critical: 8   ≅ 62%</p>
            <p class="header-text">Number of memory access error: 13   ≅ 100%</p></details>
    </header>
    </div><div class="source-line"><span class="line-number ">1</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">2</span><span class="line-counter cline-yes">&nbsp</span><code> * Supported cipher modes.</code></div>
<div class="source-line"><span class="line-number ">3</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">4</span><span class="line-counter cline-yes">&nbsp</span><code> * @author Dave Longley</code></div>
<div class="source-line"><span class="line-number ">5</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">6</span><span class="line-counter cline-yes">&nbsp</span><code> * Copyright (c) 2010-2014 Digital Bazaar, Inc.</code></div>
<div class="source-line"><span class="line-number ">7</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">8</span><span class="line-counter cline-yes">&nbsp</span><code>var forge = require(&#39;./forge&#39;);</code></div>
<div class="source-line"><span class="line-number ">9</span><span class="line-counter cline-yes">&nbsp</span><code>require(&#39;./util&#39;);</code></div>
<div class="source-line"><span class="line-number ">10</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">11</span><span class="line-counter cline-no">！</span><code><span>forge.cipher = forge.cipher </span><span class="cstat-no" title="statement not covered">|| {}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">12</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">13</span><span class="line-counter cline-yes">&nbsp</span><code>// supported cipher modes</code></div>
<div class="source-line"><span class="line-number ">14</span><span class="line-counter cline-yes">&nbsp</span><code>var modes = module.exports = forge.cipher.modes = forge.cipher.modes || {};</code></div>
<div class="source-line"><span class="line-number ">15</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">16</span><span class="line-counter cline-yes">&nbsp</span><code>/** Electronic codebook (ECB) (Don&#39;t use this; it&#39;s not secure) **/</code></div>
<div class="source-line"><span class="line-number ">17</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">18</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ecb = function(options) {</code></div>
<div class="source-line"><span class="line-number ">19</span><span class="line-counter cline-no">！</span><code><span>  options = options </span><span class="cstat-no" title="statement not covered">|| {}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">20</span><span class="line-counter cline-yes">&nbsp</span><code>  this.name = &#39;ECB&#39;;</code></div>
<div class="source-line"><span class="line-number ">21</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher = options.cipher;</code></div>
<div class="source-line"><span class="line-number ">22</span><span class="line-counter cline-no">！</span><code><span>  this.blockSize = options.blockSize </span><span class="cstat-no" title="statement not covered">|| 16</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">23</span><span class="line-counter cline-yes">&nbsp</span><code>  this._ints = this.blockSize / 4;</code></div>
<div class="source-line"><span class="line-number ">24</span><span class="line-counter cline-yes">&nbsp</span><code>  this._inBlock = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">25</span><span class="line-counter cline-yes">&nbsp</span><code>  this._outBlock = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">26</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">27</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">28</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ecb.prototype.start = function(options) {};</code></div>
<div class="source-line"><span class="line-number ">29</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">30</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ecb.prototype.encrypt = function(input, output, finish) {</code></div>
<div class="source-line"><span class="line-number ">31</span><span class="line-counter cline-yes">&nbsp</span><code>  // not enough input to encrypt</code></div>
<div class="source-line"><span class="line-number ">32</span><span class="line-counter cline-no">！</span><code><span>  if(input.length() &lt; this.blockSize &amp;&amp; !(finish </span><span class="cstat-no" title="statement not covered">&amp;&amp; input.length() &gt; 0</span><span>)) {</span></code></div>
<div class="source-line"><span class="line-number ">33</span><span class="line-counter cline-yes">&nbsp</span><code>    return true;</code></div>
<div class="source-line"><span class="line-number ">34</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">35</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">36</span><span class="line-counter cline-yes">&nbsp</span><code>  // get next block</code></div>
<div class="source-line"><span class="line-number ">37</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; this._ints; ++i) {</code></div>
<div class="source-line"><span class="line-number ">38</span><span class="line-counter cline-yes">&nbsp</span><code>    this._inBlock[i] = input.getInt32();</code></div>
<div class="source-line"><span class="line-number ">39</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">40</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">41</span><span class="line-counter cline-yes">&nbsp</span><code>  // encrypt block</code></div>
<div class="source-line"><span class="line-number ">42</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher.encrypt(this._inBlock, this._outBlock);</code></div>
<div class="source-line"><span class="line-number ">43</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">44</span><span class="line-counter cline-yes">&nbsp</span><code>  // write output</code></div>
<div class="source-line"><span class="line-number ">45</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; this._ints; ++i) {</code></div>
<div class="source-line"><span class="line-number ">46</span><span class="line-counter cline-yes">&nbsp</span><code>    output.putInt32(this._outBlock[i]);</code></div>
<div class="source-line"><span class="line-number ">47</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">48</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">49</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">50</span><span class="line-counter cline-no">！</span><code><span>modes.ecb.prototype.decrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">51</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to decrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">52</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(input.length() &lt; this.blockSize &amp;&amp; !(finish &amp;&amp; input.length() &gt; 0)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">53</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">54</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">55</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">56</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // get next block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">57</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">58</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._inBlock[i] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">59</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">60</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">61</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // decrypt block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">62</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.decrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">63</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">64</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // write output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">65</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">66</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putInt32(this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">67</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">68</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">69</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">70</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ecb.prototype.pad = function(input, options) {</code></div>
<div class="source-line"><span class="line-number ">71</span><span class="line-counter cline-yes">&nbsp</span><code>  // add PKCS#7 padding to block (each pad byte is the</code></div>
<div class="source-line"><span class="line-number ">72</span><span class="line-counter cline-yes">&nbsp</span><code>  // value of the number of pad bytes)</code></div>
<div class="source-line"><span class="line-number ">73</span><span class="line-counter cline-no">！</span><code><span>  var padding = (input.length() === this.blockSize </span><span class="cstat-no" title="statement not covered">?</span><span></span></code></div>
<div class="source-line"><span class="line-number ">74</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this.blockSize</span><span> : (this.blockSize - input.length()));</span></code></div>
<div class="source-line"><span class="line-number ">75</span><span class="line-counter cline-yes">&nbsp</span><code>  input.fillWithByte(padding, padding);</code></div>
<div class="source-line"><span class="line-number ">76</span><span class="line-counter cline-yes">&nbsp</span><code>  return true;</code></div>
<div class="source-line"><span class="line-number ">77</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">78</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">79</span><span class="line-counter cline-no">！</span><code><span>modes.ecb.prototype.unpad = </span><span class="cstat-no" title="statement not covered">function(output, options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">80</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // check for error: input data not a multiple of blockSize</span><span></span></code></div>
<div class="source-line"><span class="line-number ">81</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(options.overflow &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">82</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return false;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">83</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">84</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">85</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // ensure padding byte count is valid</span><span></span></code></div>
<div class="source-line"><span class="line-number ">86</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var len = output.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">87</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var count = output.at(len - 1);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">88</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(count &gt; (this.blockSize &lt;&lt; 2)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">89</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return false;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">90</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">91</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">92</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // trim off padding bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">93</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  output.truncate(count);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">94</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">95</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">96</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">97</span><span class="line-counter cline-yes">&nbsp</span><code>/** Cipher-block Chaining (CBC) **/</code></div>
<div class="source-line"><span class="line-number ">98</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">99</span><span class="line-counter cline-no">！</span><code><span>modes.cbc = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">100</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">101</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.name = &#39;CBC&#39;;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">102</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher = options.cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">103</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.blockSize = options.blockSize || 16;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">104</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._ints = this.blockSize / 4;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">105</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">106</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._outBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">107</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">108</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">109</span><span class="line-counter cline-no">！</span><code><span>modes.cbc.prototype.start = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">110</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // Note: legacy support for using IV residue (has security flaws)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">111</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // if IV is null, reuse block from previous processing</span><span></span></code></div>
<div class="source-line"><span class="line-number ">112</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(options.iv === null) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">113</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // must have a previous block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">114</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(!this._prev) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">115</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">116</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">117</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._iv = this._prev.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">118</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else if(!(&#39;iv&#39; in options)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">119</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">120</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">121</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // save IV as &quot;previous&quot; block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">122</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._iv = transformIV(options.iv, this.blockSize);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">123</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._prev = this._iv.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">124</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">125</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">126</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">127</span><span class="line-counter cline-no">！</span><code><span>modes.cbc.prototype.encrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">128</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to encrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">129</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(input.length() &lt; this.blockSize &amp;&amp; !(finish &amp;&amp; input.length() &gt; 0)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">130</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">131</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">132</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">133</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // get next block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">134</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // CBC XOR&#39;s IV (or previous block) with plaintext</span><span></span></code></div>
<div class="source-line"><span class="line-number ">135</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">136</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._inBlock[i] = this._prev[i] ^ input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">137</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">138</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">139</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">140</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">141</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">142</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // write output, save previous block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">143</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">144</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putInt32(this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">145</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">146</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._prev = this._outBlock;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">147</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">148</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">149</span><span class="line-counter cline-no">！</span><code><span>modes.cbc.prototype.decrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">150</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to decrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">151</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(input.length() &lt; this.blockSize &amp;&amp; !(finish &amp;&amp; input.length() &gt; 0)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">152</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">153</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">154</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">155</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // get next block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">156</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">157</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._inBlock[i] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">158</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">159</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">160</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // decrypt block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">161</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.decrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">162</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">163</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // write output, save previous ciphered block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">164</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // CBC XOR&#39;s IV (or previous block) with ciphertext</span><span></span></code></div>
<div class="source-line"><span class="line-number ">165</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">166</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putInt32(this._prev[i] ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">167</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">168</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._prev = this._inBlock.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">169</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">170</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">171</span><span class="line-counter cline-no">！</span><code><span>modes.cbc.prototype.pad = </span><span class="cstat-no" title="statement not covered">function(input, options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">172</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // add PKCS#7 padding to block (each pad byte is the</span><span></span></code></div>
<div class="source-line"><span class="line-number ">173</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // value of the number of pad bytes)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">174</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var padding = (input.length() === this.blockSize ?</span><span></span></code></div>
<div class="source-line"><span class="line-number ">175</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this.blockSize : (this.blockSize - input.length()));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">176</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  input.fillWithByte(padding, padding);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">177</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">178</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">179</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">180</span><span class="line-counter cline-no">！</span><code><span>modes.cbc.prototype.unpad = </span><span class="cstat-no" title="statement not covered">function(output, options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">181</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // check for error: input data not a multiple of blockSize</span><span></span></code></div>
<div class="source-line"><span class="line-number ">182</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(options.overflow &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">183</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return false;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">184</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">185</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">186</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // ensure padding byte count is valid</span><span></span></code></div>
<div class="source-line"><span class="line-number ">187</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var len = output.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">188</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var count = output.at(len - 1);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">189</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(count &gt; (this.blockSize &lt;&lt; 2)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">190</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return false;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">191</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">192</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">193</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // trim off padding bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">194</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  output.truncate(count);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">195</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">196</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">197</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">198</span><span class="line-counter cline-yes">&nbsp</span><code>/** Cipher feedback (CFB) **/</code></div>
<div class="source-line"><span class="line-number ">199</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">200</span><span class="line-counter cline-no">！</span><code><span>modes.cfb = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">201</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">202</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.name = &#39;CFB&#39;;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">203</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher = options.cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">204</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.blockSize = options.blockSize || 16;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">205</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._ints = this.blockSize / 4;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">206</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = null;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">207</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._outBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">208</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">209</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput = forge.util.createBuffer();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">210</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">211</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">212</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">213</span><span class="line-counter cline-no">！</span><code><span>modes.cfb.prototype.start = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">214</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(!(&#39;iv&#39; in options)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">215</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">216</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">217</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // use IV as first input</span><span></span></code></div>
<div class="source-line"><span class="line-number ">218</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._iv = transformIV(options.iv, this.blockSize);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">219</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = this._iv.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">220</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">221</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">222</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">223</span><span class="line-counter cline-no">！</span><code><span>modes.cfb.prototype.encrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">224</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to encrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">225</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var inputLength = input.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">226</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(inputLength === 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">227</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">228</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">229</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">230</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">231</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">232</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">233</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle full block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">234</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes === 0 &amp;&amp; inputLength &gt;= this.blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">235</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output, write input as output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">236</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">237</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = input.getInt32() ^ this._outBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">238</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putInt32(this._inBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">239</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">240</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">241</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">242</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">243</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle partial block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">244</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var partialBytes = (this.blockSize - inputLength) % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">245</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">246</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    partialBytes = this.blockSize - partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">247</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">248</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">249</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // XOR input with output, write input as partial output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">250</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput.clear();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">251</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">252</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBlock[i] = input.getInt32() ^ this._outBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">253</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.putInt32(this._partialBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">254</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">255</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">256</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">257</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block still incomplete, restore input buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">258</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    input.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">259</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">260</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block complete, update input block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">261</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">262</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = this._partialBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">263</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">264</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">265</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">266</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // skip any previous partial bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">267</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">268</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.getBytes(this._partialBytes);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">269</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">270</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">271</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0 &amp;&amp; !finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">272</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">273</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      partialBytes - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">274</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBytes = partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">275</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">276</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">277</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">278</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">279</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    inputLength - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">280</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">281</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">282</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">283</span><span class="line-counter cline-no">！</span><code><span>modes.cfb.prototype.decrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">284</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to decrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">285</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var inputLength = input.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">286</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(inputLength === 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">287</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">288</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">289</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">290</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block (CFB always uses encryption mode)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">291</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">292</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">293</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle full block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">294</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes === 0 &amp;&amp; inputLength &gt;= this.blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">295</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output, write input as output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">296</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">297</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">298</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putInt32(this._inBlock[i] ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">299</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">300</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">301</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">302</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">303</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle partial block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">304</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var partialBytes = (this.blockSize - inputLength) % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">305</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">306</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    partialBytes = this.blockSize - partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">307</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">308</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">309</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // XOR input with output, write input as partial output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">310</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput.clear();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">311</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">312</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBlock[i] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">313</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.putInt32(this._partialBlock[i] ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">314</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">315</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">316</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">317</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block still incomplete, restore input buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">318</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    input.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">319</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">320</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block complete, update input block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">321</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">322</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = this._partialBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">323</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">324</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">325</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">326</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // skip any previous partial bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">327</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">328</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.getBytes(this._partialBytes);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">329</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">330</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">331</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0 &amp;&amp; !finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">332</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">333</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      partialBytes - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">334</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBytes = partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">335</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">336</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">337</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">338</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">339</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    inputLength - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">340</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">341</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">342</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">343</span><span class="line-counter cline-yes">&nbsp</span><code>/** Output feedback (OFB) **/</code></div>
<div class="source-line"><span class="line-number ">344</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">345</span><span class="line-counter cline-no">！</span><code><span>modes.ofb = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">346</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">347</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.name = &#39;OFB&#39;;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">348</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher = options.cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">349</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.blockSize = options.blockSize || 16;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">350</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._ints = this.blockSize / 4;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">351</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = null;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">352</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._outBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">353</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput = forge.util.createBuffer();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">354</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">355</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">356</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">357</span><span class="line-counter cline-no">！</span><code><span>modes.ofb.prototype.start = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">358</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(!(&#39;iv&#39; in options)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">359</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">360</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">361</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // use IV as first input</span><span></span></code></div>
<div class="source-line"><span class="line-number ">362</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._iv = transformIV(options.iv, this.blockSize);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">363</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = this._iv.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">364</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">365</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">366</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">367</span><span class="line-counter cline-no">！</span><code><span>modes.ofb.prototype.encrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">368</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to encrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">369</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var inputLength = input.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">370</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(input.length() === 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">371</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">372</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">373</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">374</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block (OFB always uses encryption mode)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">375</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">376</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">377</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle full block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">378</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes === 0 &amp;&amp; inputLength &gt;= this.blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">379</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output and update next input</span><span></span></code></div>
<div class="source-line"><span class="line-number ">380</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">381</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putInt32(input.getInt32() ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">382</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = this._outBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">383</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">384</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">385</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">386</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">387</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle partial block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">388</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var partialBytes = (this.blockSize - inputLength) % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">389</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">390</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    partialBytes = this.blockSize - partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">391</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">392</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">393</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // XOR input with output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">394</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput.clear();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">395</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">396</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.putInt32(input.getInt32() ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">397</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">398</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">399</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">400</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block still incomplete, restore input buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">401</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    input.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">402</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">403</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // block complete, update input block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">404</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">405</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._inBlock[i] = this._outBlock[i];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">406</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">407</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">408</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">409</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // skip any previous partial bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">410</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">411</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.getBytes(this._partialBytes);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">412</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">413</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">414</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(partialBytes &gt; 0 &amp;&amp; !finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">415</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">416</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      partialBytes - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">417</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBytes = partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">418</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">419</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">420</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">421</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">422</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    inputLength - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">423</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">424</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">425</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">426</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ofb.prototype.decrypt = modes.ofb.prototype.encrypt;</code></div>
<div class="source-line"><span class="line-number ">427</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">428</span><span class="line-counter cline-yes">&nbsp</span><code>/** Counter (CTR) **/</code></div>
<div class="source-line"><span class="line-number ">429</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">430</span><span class="line-counter cline-no">！</span><code><span>modes.ctr = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">431</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  options = options || {};</span><span></span></code></div>
<div class="source-line"><span class="line-number ">432</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.name = &#39;CTR&#39;;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">433</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher = options.cipher;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">434</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.blockSize = options.blockSize || 16;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">435</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._ints = this.blockSize / 4;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">436</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = null;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">437</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._outBlock = new Array(this._ints);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">438</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialOutput = forge.util.createBuffer();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">439</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">440</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">441</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">442</span><span class="line-counter cline-no">！</span><code><span>modes.ctr.prototype.start = </span><span class="cstat-no" title="statement not covered">function(options) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">443</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(!(&#39;iv&#39; in options)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">444</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">445</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">446</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // use IV as first input</span><span></span></code></div>
<div class="source-line"><span class="line-number ">447</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._iv = transformIV(options.iv, this.blockSize);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">448</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._inBlock = this._iv.slice(0);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">449</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">450</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">451</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">452</span><span class="line-counter cline-no">！</span><code><span>modes.ctr.prototype.encrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">453</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to encrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">454</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var inputLength = input.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">455</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(inputLength === 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">456</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">457</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">458</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">459</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block (CTR always uses encryption mode)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">460</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">461</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">462</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // handle full block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">463</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(this._partialBytes === 0 &amp;&amp; inputLength &gt;= this.blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">464</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">465</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">466</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putInt32(input.getInt32() ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">467</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">468</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">469</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // handle partial block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">470</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var partialBytes = (this.blockSize - inputLength) % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">471</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">472</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      partialBytes = this.blockSize - partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">473</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">474</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">475</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">476</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.clear();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">477</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">478</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialOutput.putInt32(input.getInt32() ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">479</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">480</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">481</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">482</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // block still incomplete, restore input buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">483</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      input.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">484</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">485</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">486</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // skip any previous partial bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">487</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(this._partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">488</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialOutput.getBytes(this._partialBytes);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">489</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">490</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">491</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &gt; 0 &amp;&amp; !finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">492</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">493</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        partialBytes - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">494</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialBytes = partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">495</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">496</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">497</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">498</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">499</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      inputLength - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">500</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">501</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">502</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">503</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // block complete, increment counter (input block)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">504</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  inc32(this._inBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">505</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">506</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">507</span><span class="line-counter cline-yes">&nbsp</span><code>modes.ctr.prototype.decrypt = modes.ctr.prototype.encrypt;</code></div>
<div class="source-line"><span class="line-number ">508</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">509</span><span class="line-counter cline-yes">&nbsp</span><code>/** Galois/Counter Mode (GCM) **/</code></div>
<div class="source-line"><span class="line-number ">510</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">511</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm = function(options) {</code></div>
<div class="source-line"><span class="line-number ">512</span><span class="line-counter cline-no">！</span><code><span>  options = options </span><span class="cstat-no" title="statement not covered">|| {}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">513</span><span class="line-counter cline-yes">&nbsp</span><code>  this.name = &#39;GCM&#39;;</code></div>
<div class="source-line"><span class="line-number ">514</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher = options.cipher;</code></div>
<div class="source-line"><span class="line-number ">515</span><span class="line-counter cline-no">！</span><code><span>  this.blockSize = options.blockSize </span><span class="cstat-no" title="statement not covered">|| 16</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">516</span><span class="line-counter cline-yes">&nbsp</span><code>  this._ints = this.blockSize / 4;</code></div>
<div class="source-line"><span class="line-number ">517</span><span class="line-counter cline-yes">&nbsp</span><code>  this._inBlock = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">518</span><span class="line-counter cline-yes">&nbsp</span><code>  this._outBlock = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">519</span><span class="line-counter cline-yes">&nbsp</span><code>  this._partialOutput = forge.util.createBuffer();</code></div>
<div class="source-line"><span class="line-number ">520</span><span class="line-counter cline-yes">&nbsp</span><code>  this._partialBytes = 0;</code></div>
<div class="source-line"><span class="line-number ">521</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">522</span><span class="line-counter cline-yes">&nbsp</span><code>  // R is actually this value concatenated with 120 more zero bits, but</code></div>
<div class="source-line"><span class="line-number ">523</span><span class="line-counter cline-yes">&nbsp</span><code>  // we only XOR against R so the other zeros have no effect -- we just</code></div>
<div class="source-line"><span class="line-number ">524</span><span class="line-counter cline-yes">&nbsp</span><code>  // apply this value to the first integer in a block</code></div>
<div class="source-line"><span class="line-number ">525</span><span class="line-counter cline-yes">&nbsp</span><code>  this._R = 0xE1000000;</code></div>
<div class="source-line"><span class="line-number ">526</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">527</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">528</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.start = function(options) {</code></div>
<div class="source-line"><span class="line-number ">529</span><span class="line-counter cline-no">！</span><code><span>  if(!(&#39;iv&#39; in options)) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">530</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(&#39;Invalid IV parameter.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">531</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">532</span><span class="line-counter cline-yes">&nbsp</span><code>  // ensure IV is a byte buffer</code></div>
<div class="source-line"><span class="line-number ">533</span><span class="line-counter cline-yes">&nbsp</span><code>  var iv = forge.util.createBuffer(options.iv);</code></div>
<div class="source-line"><span class="line-number ">534</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">535</span><span class="line-counter cline-yes">&nbsp</span><code>  // no ciphered data processed yet</code></div>
<div class="source-line"><span class="line-number ">536</span><span class="line-counter cline-yes">&nbsp</span><code>  this._cipherLength = 0;</code></div>
<div class="source-line"><span class="line-number ">537</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">538</span><span class="line-counter cline-yes">&nbsp</span><code>  // default additional data is none</code></div>
<div class="source-line"><span class="line-number ">539</span><span class="line-counter cline-yes">&nbsp</span><code>  var additionalData;</code></div>
<div class="source-line"><span class="line-number ">540</span><span class="line-counter cline-no">！</span><code><span>  if(&#39;additionalData&#39; in options) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">541</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    additionalData = forge.util.createBuffer(options.additionalData);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">542</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span> else {</span></code></div>
<div class="source-line"><span class="line-number ">543</span><span class="line-counter cline-yes">&nbsp</span><code>    additionalData = forge.util.createBuffer();</code></div>
<div class="source-line"><span class="line-number ">544</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">545</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">546</span><span class="line-counter cline-yes">&nbsp</span><code>  // default tag length is 128 bits</code></div>
<div class="source-line"><span class="line-number ">547</span><span class="line-counter cline-no">！</span><code><span>  if(&#39;tagLength&#39; in options) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">548</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._tagLength = options.tagLength;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">549</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span> else {</span></code></div>
<div class="source-line"><span class="line-number ">550</span><span class="line-counter cline-yes">&nbsp</span><code>    this._tagLength = 128;</code></div>
<div class="source-line"><span class="line-number ">551</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">552</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">553</span><span class="line-counter cline-yes">&nbsp</span><code>  // if tag is given, ensure tag matches tag length</code></div>
<div class="source-line"><span class="line-number ">554</span><span class="line-counter cline-yes">&nbsp</span><code>  this._tag = null;</code></div>
<div class="source-line"><span class="line-number ">555</span><span class="line-counter cline-no">！</span><code><span>  if(options.decrypt) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">556</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // save tag to check later</span><span></span></code></div>
<div class="source-line"><span class="line-number ">557</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._tag = forge.util.createBuffer(options.tag).getBytes();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">558</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(this._tag.length !== (this._tagLength / 8)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">559</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      throw new Error(&#39;Authentication tag does not match tag length.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">560</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">561</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">562</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">563</span><span class="line-counter cline-yes">&nbsp</span><code>  // create tmp storage for hash calculation</code></div>
<div class="source-line"><span class="line-number ">564</span><span class="line-counter cline-yes">&nbsp</span><code>  this._hashBlock = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">565</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">566</span><span class="line-counter cline-yes">&nbsp</span><code>  // no tag generated yet</code></div>
<div class="source-line"><span class="line-number ">567</span><span class="line-counter cline-yes">&nbsp</span><code>  this.tag = null;</code></div>
<div class="source-line"><span class="line-number ">568</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">569</span><span class="line-counter cline-yes">&nbsp</span><code>  // generate hash subkey</code></div>
<div class="source-line"><span class="line-number ">570</span><span class="line-counter cline-yes">&nbsp</span><code>  // (apply block cipher to &quot;zero&quot; block)</code></div>
<div class="source-line"><span class="line-number ">571</span><span class="line-counter cline-yes">&nbsp</span><code>  this._hashSubkey = new Array(this._ints);</code></div>
<div class="source-line"><span class="line-number ">572</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher.encrypt([0, 0, 0, 0], this._hashSubkey);</code></div>
<div class="source-line"><span class="line-number ">573</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">574</span><span class="line-counter cline-yes">&nbsp</span><code>  // generate table M</code></div>
<div class="source-line"><span class="line-number ">575</span><span class="line-counter cline-yes">&nbsp</span><code>  // use 4-bit tables (32 component decomposition of a 16 byte value)</code></div>
<div class="source-line"><span class="line-number ">576</span><span class="line-counter cline-yes">&nbsp</span><code>  // 8-bit tables take more space and are known to have security</code></div>
<div class="source-line"><span class="line-number ">577</span><span class="line-counter cline-yes">&nbsp</span><code>  // vulnerabilities (in native implementations)</code></div>
<div class="source-line"><span class="line-number ">578</span><span class="line-counter cline-yes">&nbsp</span><code>  this.componentBits = 4;</code></div>
<div class="source-line"><span class="line-number ">579</span><span class="line-counter cline-yes">&nbsp</span><code>  this._m = this.generateHashTable(this._hashSubkey, this.componentBits);</code></div>
<div class="source-line"><span class="line-number ">580</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">581</span><span class="line-counter cline-yes">&nbsp</span><code>  // Note: support IV length different from 96 bits? (only supporting</code></div>
<div class="source-line"><span class="line-number ">582</span><span class="line-counter cline-yes">&nbsp</span><code>  // 96 bits is recommended by NIST SP-800-38D)</code></div>
<div class="source-line"><span class="line-number ">583</span><span class="line-counter cline-yes">&nbsp</span><code>  // generate J_0</code></div>
<div class="source-line"><span class="line-number ">584</span><span class="line-counter cline-yes">&nbsp</span><code>  var ivLength = iv.length();</code></div>
<div class="source-line"><span class="line-number ">585</span><span class="line-counter cline-yes">&nbsp</span><code>  if(ivLength === 12) {</code></div>
<div class="source-line"><span class="line-number ">586</span><span class="line-counter cline-yes">&nbsp</span><code>    // 96-bit IV</code></div>
<div class="source-line"><span class="line-number ">587</span><span class="line-counter cline-yes">&nbsp</span><code>    this._j0 = [iv.getInt32(), iv.getInt32(), iv.getInt32(), 1];</code></div>
<div class="source-line"><span class="line-number ">588</span><span class="line-counter cline-no">！</span><code><span>  }</span><span class="cstat-no" title="statement not covered"> else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">589</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // IV is NOT 96-bits</span><span></span></code></div>
<div class="source-line"><span class="line-number ">590</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._j0 = [0, 0, 0, 0];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">591</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    while(iv.length() &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">592</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._j0 = this.ghash(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">593</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        this._hashSubkey, this._j0,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">594</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        [iv.getInt32(), iv.getInt32(), iv.getInt32(), iv.getInt32()]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">595</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">596</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._j0 = this.ghash(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">597</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._hashSubkey, this._j0, [0, 0].concat(from64To32(ivLength * 8)));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">598</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">599</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">600</span><span class="line-counter cline-yes">&nbsp</span><code>  // generate ICB (initial counter block)</code></div>
<div class="source-line"><span class="line-number ">601</span><span class="line-counter cline-yes">&nbsp</span><code>  this._inBlock = this._j0.slice(0);</code></div>
<div class="source-line"><span class="line-number ">602</span><span class="line-counter cline-yes">&nbsp</span><code>  inc32(this._inBlock);</code></div>
<div class="source-line"><span class="line-number ">603</span><span class="line-counter cline-yes">&nbsp</span><code>  this._partialBytes = 0;</code></div>
<div class="source-line"><span class="line-number ">604</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">605</span><span class="line-counter cline-yes">&nbsp</span><code>  // consume authentication data</code></div>
<div class="source-line"><span class="line-number ">606</span><span class="line-counter cline-yes">&nbsp</span><code>  additionalData = forge.util.createBuffer(additionalData);</code></div>
<div class="source-line"><span class="line-number ">607</span><span class="line-counter cline-yes">&nbsp</span><code>  // save additional data length as a BE 64-bit number</code></div>
<div class="source-line"><span class="line-number ">608</span><span class="line-counter cline-yes">&nbsp</span><code>  this._aDataLength = from64To32(additionalData.length() * 8);</code></div>
<div class="source-line"><span class="line-number ">609</span><span class="line-counter cline-yes">&nbsp</span><code>  // pad additional data to 128 bit (16 byte) block size</code></div>
<div class="source-line"><span class="line-number ">610</span><span class="line-counter cline-yes">&nbsp</span><code>  var overflow = additionalData.length() % this.blockSize;</code></div>
<div class="source-line"><span class="line-number ">611</span><span class="line-counter cline-no">！</span><code><span>  if(overflow) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">612</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    additionalData.fillWithByte(0, this.blockSize - overflow);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">613</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">614</span><span class="line-counter cline-yes">&nbsp</span><code>  this._s = [0, 0, 0, 0];</code></div>
<div class="source-line"><span class="line-number ">615</span><span class="line-counter cline-no">！</span><code><span>  while(additionalData.length() &gt; 0) </span><span class="cstat-no" title="statement not covered">{</span><span></span></code></div>
<div class="source-line"><span class="line-number ">616</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._s = this.ghash(this._hashSubkey, this._s, [</span><span></span></code></div>
<div class="source-line"><span class="line-number ">617</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      additionalData.getInt32(),</span><span></span></code></div>
<div class="source-line"><span class="line-number ">618</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      additionalData.getInt32(),</span><span></span></code></div>
<div class="source-line"><span class="line-number ">619</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      additionalData.getInt32(),</span><span></span></code></div>
<div class="source-line"><span class="line-number ">620</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      additionalData.getInt32()</span><span></span></code></div>
<div class="source-line"><span class="line-number ">621</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    ]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">622</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">623</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">624</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">625</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.encrypt = function(input, output, finish) {</code></div>
<div class="source-line"><span class="line-number ">626</span><span class="line-counter cline-yes">&nbsp</span><code>  // not enough input to encrypt</code></div>
<div class="source-line"><span class="line-number ">627</span><span class="line-counter cline-yes">&nbsp</span><code>  var inputLength = input.length();</code></div>
<div class="source-line"><span class="line-number ">628</span><span class="line-counter cline-yes">&nbsp</span><code>  if(inputLength === 0) {</code></div>
<div class="source-line"><span class="line-number ">629</span><span class="line-counter cline-yes">&nbsp</span><code>    return true;</code></div>
<div class="source-line"><span class="line-number ">630</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">631</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">632</span><span class="line-counter cline-yes">&nbsp</span><code>  // encrypt block</code></div>
<div class="source-line"><span class="line-number ">633</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher.encrypt(this._inBlock, this._outBlock);</code></div>
<div class="source-line"><span class="line-number ">634</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">635</span><span class="line-counter cline-yes">&nbsp</span><code>  // handle full block</code></div>
<div class="source-line"><span class="line-number ">636</span><span class="line-counter cline-yes">&nbsp</span><code>  if(this._partialBytes === 0 &amp;&amp; inputLength &gt;= this.blockSize) {</code></div>
<div class="source-line"><span class="line-number ">637</span><span class="line-counter cline-yes">&nbsp</span><code>    // XOR input with output</code></div>
<div class="source-line"><span class="line-number ">638</span><span class="line-counter cline-yes">&nbsp</span><code>    for(var i = 0; i &lt; this._ints; ++i) {</code></div>
<div class="source-line"><span class="line-number ">639</span><span class="line-counter cline-yes">&nbsp</span><code>      output.putInt32(this._outBlock[i] ^= input.getInt32());</code></div>
<div class="source-line"><span class="line-number ">640</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">641</span><span class="line-counter cline-yes">&nbsp</span><code>    this._cipherLength += this.blockSize;</code></div>
<div class="source-line"><span class="line-number ">642</span><span class="line-counter cline-no">！</span><code><span>  }</span><span class="cstat-no" title="statement not covered"> else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">643</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // handle partial block</span><span></span></code></div>
<div class="source-line"><span class="line-number ">644</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var partialBytes = (this.blockSize - inputLength) % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">645</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">646</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      partialBytes = this.blockSize - partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">647</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">648</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">649</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // XOR input with output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">650</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialOutput.clear();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">651</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">652</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialOutput.putInt32(input.getInt32() ^ this._outBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">653</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">654</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">655</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &lt;= 0 || finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">656</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // handle overflow prior to hashing</span><span></span></code></div>
<div class="source-line"><span class="line-number ">657</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      if(finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">658</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // get block overflow</span><span></span></code></div>
<div class="source-line"><span class="line-number ">659</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        var overflow = inputLength % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">660</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        this._cipherLength += overflow;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">661</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        // truncate for hash function</span><span></span></code></div>
<div class="source-line"><span class="line-number ">662</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        this._partialOutput.truncate(this.blockSize - overflow);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">663</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">664</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        this._cipherLength += this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">665</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">666</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">667</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // get output block for hashing</span><span></span></code></div>
<div class="source-line"><span class="line-number ">668</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">669</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        this._outBlock[i] = this._partialOutput.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">670</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">671</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialOutput.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">672</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">673</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">674</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // skip any previous partial bytes</span><span></span></code></div>
<div class="source-line"><span class="line-number ">675</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(this._partialBytes &gt; 0) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">676</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialOutput.getBytes(this._partialBytes);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">677</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">678</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">679</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    if(partialBytes &gt; 0 &amp;&amp; !finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">680</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // block still incomplete, restore input buffer, get partial output,</span><span></span></code></div>
<div class="source-line"><span class="line-number ">681</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      // and return early</span><span></span></code></div>
<div class="source-line"><span class="line-number ">682</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      input.read -= this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">683</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">684</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">        partialBytes - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">685</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      this._partialBytes = partialBytes;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">686</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">687</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">688</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">689</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putBytes(this._partialOutput.getBytes(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">690</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      inputLength - this._partialBytes));</span><span></span></code></div>
<div class="source-line"><span class="line-number ">691</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._partialBytes = 0;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">692</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">693</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">694</span><span class="line-counter cline-yes">&nbsp</span><code>  // update hash block S</code></div>
<div class="source-line"><span class="line-number ">695</span><span class="line-counter cline-yes">&nbsp</span><code>  this._s = this.ghash(this._hashSubkey, this._s, this._outBlock);</code></div>
<div class="source-line"><span class="line-number ">696</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">697</span><span class="line-counter cline-yes">&nbsp</span><code>  // increment counter (input block)</code></div>
<div class="source-line"><span class="line-number ">698</span><span class="line-counter cline-yes">&nbsp</span><code>  inc32(this._inBlock);</code></div>
<div class="source-line"><span class="line-number ">699</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">700</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">701</span><span class="line-counter cline-no">！</span><code><span>modes.gcm.prototype.decrypt = </span><span class="cstat-no" title="statement not covered">function(input, output, finish) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">702</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // not enough input to decrypt</span><span></span></code></div>
<div class="source-line"><span class="line-number ">703</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  var inputLength = input.length();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">704</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(inputLength &lt; this.blockSize &amp;&amp; !(finish &amp;&amp; inputLength &gt; 0)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">705</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    return true;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">706</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">707</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">708</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // encrypt block (GCM always uses encryption mode)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">709</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this.cipher.encrypt(this._inBlock, this._outBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">710</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">711</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // increment counter (input block)</span><span></span></code></div>
<div class="source-line"><span class="line-number ">712</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  inc32(this._inBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">713</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">714</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // update hash block S</span><span></span></code></div>
<div class="source-line"><span class="line-number ">715</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._hashBlock[0] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">716</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._hashBlock[1] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">717</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._hashBlock[2] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">718</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._hashBlock[3] = input.getInt32();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">719</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  this._s = this.ghash(this._hashSubkey, this._s, this._hashBlock);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">720</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">721</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // XOR hash input with output</span><span></span></code></div>
<div class="source-line"><span class="line-number ">722</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  for(var i = 0; i &lt; this._ints; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">723</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.putInt32(this._outBlock[i] ^ this._hashBlock[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">724</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">725</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">726</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  // increment cipher data length</span><span></span></code></div>
<div class="source-line"><span class="line-number ">727</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(inputLength &lt; this.blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">728</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._cipherLength += inputLength % this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">729</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  } else {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">730</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    this._cipherLength += this.blockSize;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">731</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">732</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span>;</span></code></div>
<div class="source-line"><span class="line-number ">733</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">734</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.afterFinish = function(output, options) {</code></div>
<div class="source-line"><span class="line-number ">735</span><span class="line-counter cline-yes">&nbsp</span><code>  var rval = true;</code></div>
<div class="source-line"><span class="line-number ">736</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">737</span><span class="line-counter cline-yes">&nbsp</span><code>  // handle overflow</code></div>
<div class="source-line"><span class="line-number ">738</span><span class="line-counter cline-no">！</span><code><span>  if(options.decrypt </span><span class="cstat-no" title="statement not covered">&amp;&amp; options.overflow</span><span>) {</span></code></div>
<div class="source-line"><span class="line-number ">739</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    output.truncate(this.blockSize - options.overflow);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">740</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">741</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">742</span><span class="line-counter cline-yes">&nbsp</span><code>  // handle authentication tag</code></div>
<div class="source-line"><span class="line-number ">743</span><span class="line-counter cline-yes">&nbsp</span><code>  this.tag = forge.util.createBuffer();</code></div>
<div class="source-line"><span class="line-number ">744</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">745</span><span class="line-counter cline-yes">&nbsp</span><code>  // concatenate additional data length with cipher length</code></div>
<div class="source-line"><span class="line-number ">746</span><span class="line-counter cline-yes">&nbsp</span><code>  var lengths = this._aDataLength.concat(from64To32(this._cipherLength * 8));</code></div>
<div class="source-line"><span class="line-number ">747</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">748</span><span class="line-counter cline-yes">&nbsp</span><code>  // include lengths in hash</code></div>
<div class="source-line"><span class="line-number ">749</span><span class="line-counter cline-yes">&nbsp</span><code>  this._s = this.ghash(this._hashSubkey, this._s, lengths);</code></div>
<div class="source-line"><span class="line-number ">750</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">751</span><span class="line-counter cline-yes">&nbsp</span><code>  // do GCTR(J_0, S)</code></div>
<div class="source-line"><span class="line-number ">752</span><span class="line-counter cline-yes">&nbsp</span><code>  var tag = [];</code></div>
<div class="source-line"><span class="line-number ">753</span><span class="line-counter cline-yes">&nbsp</span><code>  this.cipher.encrypt(this._j0, tag);</code></div>
<div class="source-line"><span class="line-number ">754</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; this._ints; ++i) {</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">755</span><span class="line-counter cline-yes">&nbsp</span><code>    this.tag.putInt32(this._s[i] ^ tag[i]);</code></div>
</mark><details class="issue-inline-message issue-major issue-memory-access target-GCM">
                        <summary>🚨&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 66.67% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">756</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">757</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">758</span><span class="line-counter cline-yes">&nbsp</span><code>  // trim tag to length</code></div>
<div class="source-line"><span class="line-number ">759</span><span class="line-counter cline-yes">&nbsp</span><code>  this.tag.truncate(this.tag.length() % (this._tagLength / 8));</code></div>
<div class="source-line"><span class="line-number ">760</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">761</span><span class="line-counter cline-yes">&nbsp</span><code>  // check authentication tag</code></div>
<div class="source-line"><span class="line-number ">762</span><span class="line-counter cline-no">！</span><code><span>  if(options.decrypt </span><span class="cstat-no" title="statement not covered">&amp;&amp; this.tag.bytes() !== this._tag</span><span>) {</span></code></div>
<div class="source-line"><span class="line-number ">763</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    rval = false;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">764</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">765</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">766</span><span class="line-counter cline-yes">&nbsp</span><code>  return rval;</code></div>
<div class="source-line"><span class="line-number ">767</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">768</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">769</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">770</span><span class="line-counter cline-yes">&nbsp</span><code> * See NIST SP-800-38D 6.3 (Algorithm 1). This function performs Galois</code></div>
<div class="source-line"><span class="line-number ">771</span><span class="line-counter cline-yes">&nbsp</span><code> * field multiplication. The field, GF(2^128), is defined by the polynomial:</code></div>
<div class="source-line"><span class="line-number ">772</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">773</span><span class="line-counter cline-yes">&nbsp</span><code> * x^128 + x^7 + x^2 + x + 1</code></div>
<div class="source-line"><span class="line-number ">774</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">775</span><span class="line-counter cline-yes">&nbsp</span><code> * Which is represented in little-endian binary form as: 11100001 (0xe1). When</code></div>
<div class="source-line"><span class="line-number ">776</span><span class="line-counter cline-yes">&nbsp</span><code> * the value of a coefficient is 1, a bit is set. The value R, is the</code></div>
<div class="source-line"><span class="line-number ">777</span><span class="line-counter cline-yes">&nbsp</span><code> * concatenation of this value and 120 zero bits, yielding a 128-bit value</code></div>
<div class="source-line"><span class="line-number ">778</span><span class="line-counter cline-yes">&nbsp</span><code> * which matches the block size.</code></div>
<div class="source-line"><span class="line-number ">779</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">780</span><span class="line-counter cline-yes">&nbsp</span><code> * This function will multiply two elements (vectors of bytes), X and Y, in</code></div>
<div class="source-line"><span class="line-number ">781</span><span class="line-counter cline-yes">&nbsp</span><code> * the field GF(2^128). The result is initialized to zero. For each bit of</code></div>
<div class="source-line"><span class="line-number ">782</span><span class="line-counter cline-yes">&nbsp</span><code> * X (out of 128), x_i, if x_i is set, then the result is multiplied (XOR&#39;d)</code></div>
<div class="source-line"><span class="line-number ">783</span><span class="line-counter cline-yes">&nbsp</span><code> * by the current value of Y. For each bit, the value of Y will be raised by</code></div>
<div class="source-line"><span class="line-number ">784</span><span class="line-counter cline-yes">&nbsp</span><code> * a power of x (multiplied by the polynomial x). This can be achieved by</code></div>
<div class="source-line"><span class="line-number ">785</span><span class="line-counter cline-yes">&nbsp</span><code> * shifting Y once to the right. If the current value of Y, prior to being</code></div>
<div class="source-line"><span class="line-number ">786</span><span class="line-counter cline-yes">&nbsp</span><code> * multiplied by x, has 0 as its LSB, then it is a 127th degree polynomial.</code></div>
<div class="source-line"><span class="line-number ">787</span><span class="line-counter cline-yes">&nbsp</span><code> * Otherwise, we must divide by R after shifting to find the remainder.</code></div>
<div class="source-line"><span class="line-number ">788</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">789</span><span class="line-counter cline-yes">&nbsp</span><code> * @param x the first block to multiply by the second.</code></div>
<div class="source-line"><span class="line-number ">790</span><span class="line-counter cline-yes">&nbsp</span><code> * @param y the second block to multiply by the first.</code></div>
<div class="source-line"><span class="line-number ">791</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">792</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the block result of the multiplication.</code></div>
<div class="source-line"><span class="line-number ">793</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">794</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.multiply = function(x, y) {</code></div>
<div class="source-line"><span class="line-number ">795</span><span class="line-counter cline-yes">&nbsp</span><code>  var z_i = [0, 0, 0, 0];</code></div>
<div class="source-line"><span class="line-number ">796</span><span class="line-counter cline-yes">&nbsp</span><code>  var v_i = y.slice(0);</code></div>
<div class="source-line"><span class="line-number ">797</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">798</span><span class="line-counter cline-yes">&nbsp</span><code>  // calculate Z_128 (block has 128 bits)</code></div>
<div class="source-line"><span class="line-number ">799</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; 128; ++i) {</code></div>
<div class="source-line"><span class="line-number ">800</span><span class="line-counter cline-yes">&nbsp</span><code>    // if x_i is 0, Z_{i+1} = Z_i (unchanged)</code></div>
<div class="source-line"><span class="line-number ">801</span><span class="line-counter cline-yes">&nbsp</span><code>    // else Z_{i+1} = Z_i ^ V_i</code></div>
<div class="source-line"><span class="line-number ">802</span><span class="line-counter cline-yes">&nbsp</span><code>    // get x_i by finding 32-bit int position, then left shift 1 by remainder</code></div>
<div class="source-line"><span class="line-number ">803</span><span class="line-counter cline-yes">&nbsp</span><code>    var x_i = x[(i / 32) | 0] &amp; (1 &lt;&lt; (31 - i % 32));</code></div>
<div class="source-line"><span class="line-number ">804</span><span class="line-counter cline-yes">&nbsp</span><code>    if(x_i) {</code></div>
<div class="source-line"><span class="line-number ">805</span><span class="line-counter cline-yes">&nbsp</span><code>      z_i[0] ^= v_i[0];</code></div>
<div class="source-line"><span class="line-number ">806</span><span class="line-counter cline-yes">&nbsp</span><code>      z_i[1] ^= v_i[1];</code></div>
<div class="source-line"><span class="line-number ">807</span><span class="line-counter cline-yes">&nbsp</span><code>      z_i[2] ^= v_i[2];</code></div>
<div class="source-line"><span class="line-number ">808</span><span class="line-counter cline-yes">&nbsp</span><code>      z_i[3] ^= v_i[3];</code></div>
<div class="source-line"><span class="line-number ">809</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">810</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">811</span><span class="line-counter cline-yes">&nbsp</span><code>    // if LSB(V_i) is 1, V_i = V_i &gt;&gt; 1</code></div>
<div class="source-line"><span class="line-number ">812</span><span class="line-counter cline-yes">&nbsp</span><code>    // else V_i = (V_i &gt;&gt; 1) ^ R</code></div>
<div class="source-line"><span class="line-number ">813</span><span class="line-counter cline-yes">&nbsp</span><code>    this.pow(v_i, v_i);</code></div>
<div class="source-line"><span class="line-number ">814</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">815</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">816</span><span class="line-counter cline-yes">&nbsp</span><code>  return z_i;</code></div>
<div class="source-line"><span class="line-number ">817</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">818</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">819</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.pow = function(x, out) {</code></div>
<div class="source-line"><span class="line-number ">820</span><span class="line-counter cline-yes">&nbsp</span><code>  // if LSB(x) is 1, x = x &gt;&gt;&gt; 1</code></div>
<div class="source-line"><span class="line-number ">821</span><span class="line-counter cline-yes">&nbsp</span><code>  // else x = (x &gt;&gt;&gt; 1) ^ R</code></div>
<div class="source-line"><span class="line-number ">822</span><span class="line-counter cline-yes">&nbsp</span><code>  var lsb = x[3] &amp; 1;</code></div>
<div class="source-line"><span class="line-number ">823</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">824</span><span class="line-counter cline-yes">&nbsp</span><code>  // always do x &gt;&gt;&gt; 1:</code></div>
<div class="source-line"><span class="line-number ">825</span><span class="line-counter cline-yes">&nbsp</span><code>  // starting with the rightmost integer, shift each integer to the right</code></div>
<div class="source-line"><span class="line-number ">826</span><span class="line-counter cline-yes">&nbsp</span><code>  // one bit, pulling in the bit from the integer to the left as its top</code></div>
<div class="source-line"><span class="line-number ">827</span><span class="line-counter cline-yes">&nbsp</span><code>  // most bit (do this for the last 3 integers)</code></div>
<div class="source-line"><span class="line-number ">828</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 3; i &gt; 0; --i) {</code></div>
<div class="source-line"><span class="line-number ">829</span><span class="line-counter cline-yes">&nbsp</span><code>    out[i] = (x[i] &gt;&gt;&gt; 1) | ((x[i - 1] &amp; 1) &lt;&lt; 31);</code></div>
<div class="source-line"><span class="line-number ">830</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">831</span><span class="line-counter cline-yes">&nbsp</span><code>  // shift the first integer normally</code></div>
<div class="source-line"><span class="line-number ">832</span><span class="line-counter cline-yes">&nbsp</span><code>  out[0] = x[0] &gt;&gt;&gt; 1;</code></div>
<div class="source-line"><span class="line-number ">833</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">834</span><span class="line-counter cline-yes">&nbsp</span><code>  // if lsb was not set, then polynomial had a degree of 127 and doesn&#39;t</code></div>
<div class="source-line"><span class="line-number ">835</span><span class="line-counter cline-yes">&nbsp</span><code>  // need to divided; otherwise, XOR with R to find the remainder; we only</code></div>
<div class="source-line"><span class="line-number ">836</span><span class="line-counter cline-yes">&nbsp</span><code>  // need to XOR the first integer since R technically ends w/120 zero bits</code></div>
<div class="source-line"><span class="line-number ">837</span><span class="line-counter cline-yes">&nbsp</span><code>  if(lsb) {</code></div>
<div class="source-line"><span class="line-number ">838</span><span class="line-counter cline-yes">&nbsp</span><code>    out[0] ^= this._R;</code></div>
<div class="source-line"><span class="line-number ">839</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">840</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">841</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">842</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.tableMultiply = function(x) {</code></div>
<div class="source-line"><span class="line-number ">843</span><span class="line-counter cline-yes">&nbsp</span><code>  // assumes 4-bit tables are used</code></div>
<div class="source-line"><span class="line-number ">844</span><span class="line-counter cline-yes">&nbsp</span><code>  var z = [0, 0, 0, 0];</code></div>
<div class="source-line"><span class="line-number ">845</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; 32; ++i) {</code></div>
<div class="source-line"><span class="line-number ">846</span><span class="line-counter cline-yes">&nbsp</span><code>    var idx = (i / 8) | 0;</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">847</span><span class="line-counter cline-yes">&nbsp</span><code>    var x_i = (x[idx] &gt;&gt;&gt; ((7 - (i % 8)) * 4)) &amp; 0xF;</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 96.30% +/- 8.67%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">848</span><span class="line-counter cline-yes">&nbsp</span><code>    var ah = this._m[i][x_i];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">849</span><span class="line-counter cline-yes">&nbsp</span><code>    z[0] ^= ah[0];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">850</span><span class="line-counter cline-yes">&nbsp</span><code>    z[1] ^= ah[1];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">851</span><span class="line-counter cline-yes">&nbsp</span><code>    z[2] ^= ah[2];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">852</span><span class="line-counter cline-yes">&nbsp</span><code>    z[3] ^= ah[3];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">853</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">854</span><span class="line-counter cline-yes">&nbsp</span><code>  return z;</code></div>
<div class="source-line"><span class="line-number ">855</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">856</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">857</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">858</span><span class="line-counter cline-yes">&nbsp</span><code> * A continuing version of the GHASH algorithm that operates on a single</code></div>
<div class="source-line"><span class="line-number ">859</span><span class="line-counter cline-yes">&nbsp</span><code> * block. The hash block, last hash value (Ym) and the new block to hash</code></div>
<div class="source-line"><span class="line-number ">860</span><span class="line-counter cline-yes">&nbsp</span><code> * are given.</code></div>
<div class="source-line"><span class="line-number ">861</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">862</span><span class="line-counter cline-yes">&nbsp</span><code> * @param h the hash block.</code></div>
<div class="source-line"><span class="line-number ">863</span><span class="line-counter cline-yes">&nbsp</span><code> * @param y the previous value for Ym, use [0, 0, 0, 0] for a new hash.</code></div>
<div class="source-line"><span class="line-number ">864</span><span class="line-counter cline-yes">&nbsp</span><code> * @param x the block to hash.</code></div>
<div class="source-line"><span class="line-number ">865</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">866</span><span class="line-counter cline-yes">&nbsp</span><code> * @return the hashed value (Ym).</code></div>
<div class="source-line"><span class="line-number ">867</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">868</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.ghash = function(h, y, x) {</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">869</span><span class="line-counter cline-yes">&nbsp</span><code>  y[0] ^= x[0];</code></div>
</mark><details class="issue-inline-message issue-major issue-memory-access target-GCM">
                        <summary>🚨&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 66.67% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">870</span><span class="line-counter cline-yes">&nbsp</span><code>  y[1] ^= x[1];</code></div>
</mark><details class="issue-inline-message issue-major issue-memory-access target-GCM">
                        <summary>🚨&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 66.67% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">871</span><span class="line-counter cline-yes">&nbsp</span><code>  y[2] ^= x[2];</code></div>
</mark><details class="issue-inline-message issue-major issue-memory-access target-GCM">
                        <summary>🚨&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 66.67% +/- 0%.</div>
            </details><mark class="issue-line"><div class="source-line"><span class="line-number ">872</span><span class="line-counter cline-yes">&nbsp</span><code>  y[3] ^= x[3];</code></div>
</mark><details class="issue-inline-message issue-major issue-memory-access target-GCM">
                        <summary>🚨&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 66.67% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">873</span><span class="line-counter cline-yes">&nbsp</span><code>  return this.tableMultiply(y);</code></div>
<div class="source-line"><span class="line-number ">874</span><span class="line-counter cline-yes">&nbsp</span><code>  //return this.multiply(y, h);</code></div>
<div class="source-line"><span class="line-number ">875</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">876</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">877</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">878</span><span class="line-counter cline-yes">&nbsp</span><code> * Precomputes a table for multiplying against the hash subkey. This</code></div>
<div class="source-line"><span class="line-number ">879</span><span class="line-counter cline-yes">&nbsp</span><code> * mechanism provides a substantial speed increase over multiplication</code></div>
<div class="source-line"><span class="line-number ">880</span><span class="line-counter cline-yes">&nbsp</span><code> * performed without a table. The table-based multiplication this table is</code></div>
<div class="source-line"><span class="line-number ">881</span><span class="line-counter cline-yes">&nbsp</span><code> * for solves X * H by multiplying each component of X by H and then</code></div>
<div class="source-line"><span class="line-number ">882</span><span class="line-counter cline-yes">&nbsp</span><code> * composing the results together using XOR.</code></div>
<div class="source-line"><span class="line-number ">883</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">884</span><span class="line-counter cline-yes">&nbsp</span><code> * This function can be used to generate tables with different bit sizes</code></div>
<div class="source-line"><span class="line-number ">885</span><span class="line-counter cline-yes">&nbsp</span><code> * for the components, however, this implementation assumes there are</code></div>
<div class="source-line"><span class="line-number ">886</span><span class="line-counter cline-yes">&nbsp</span><code> * 32 components of X (which is a 16 byte vector), therefore each component</code></div>
<div class="source-line"><span class="line-number ">887</span><span class="line-counter cline-yes">&nbsp</span><code> * takes 4-bits (so the table is constructed with bits=4).</code></div>
<div class="source-line"><span class="line-number ">888</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">889</span><span class="line-counter cline-yes">&nbsp</span><code> * @param h the hash subkey.</code></div>
<div class="source-line"><span class="line-number ">890</span><span class="line-counter cline-yes">&nbsp</span><code> * @param bits the bit size for a component.</code></div>
<div class="source-line"><span class="line-number ">891</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">892</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.generateHashTable = function(h, bits) {</code></div>
<div class="source-line"><span class="line-number ">893</span><span class="line-counter cline-yes">&nbsp</span><code>  // TODO: There are further optimizations that would use only the</code></div>
<div class="source-line"><span class="line-number ">894</span><span class="line-counter cline-yes">&nbsp</span><code>  // first table M_0 (or some variant) along with a remainder table;</code></div>
<div class="source-line"><span class="line-number ">895</span><span class="line-counter cline-yes">&nbsp</span><code>  // this can be explored in the future</code></div>
<div class="source-line"><span class="line-number ">896</span><span class="line-counter cline-yes">&nbsp</span><code>  var multiplier = 8 / bits;</code></div>
<div class="source-line"><span class="line-number ">897</span><span class="line-counter cline-yes">&nbsp</span><code>  var perInt = 4 * multiplier;</code></div>
<div class="source-line"><span class="line-number ">898</span><span class="line-counter cline-yes">&nbsp</span><code>  var size = 16 * multiplier;</code></div>
<div class="source-line"><span class="line-number ">899</span><span class="line-counter cline-yes">&nbsp</span><code>  var m = new Array(size);</code></div>
<div class="source-line"><span class="line-number ">900</span><span class="line-counter cline-yes">&nbsp</span><code>  for(var i = 0; i &lt; size; ++i) {</code></div>
<div class="source-line"><span class="line-number ">901</span><span class="line-counter cline-yes">&nbsp</span><code>    var tmp = [0, 0, 0, 0];</code></div>
<div class="source-line"><span class="line-number ">902</span><span class="line-counter cline-yes">&nbsp</span><code>    var idx = (i / perInt) | 0;</code></div>
<div class="source-line"><span class="line-number ">903</span><span class="line-counter cline-yes">&nbsp</span><code>    var shft = ((perInt - 1 - (i % perInt)) * bits);</code></div>
<div class="source-line"><span class="line-number ">904</span><span class="line-counter cline-yes">&nbsp</span><code>    tmp[idx] = (1 &lt;&lt; (bits - 1)) &lt;&lt; shft;</code></div>
<div class="source-line"><span class="line-number ">905</span><span class="line-counter cline-yes">&nbsp</span><code>    m[i] = this.generateSubHashTable(this.multiply(tmp, h), bits);</code></div>
<div class="source-line"><span class="line-number ">906</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">907</span><span class="line-counter cline-yes">&nbsp</span><code>  return m;</code></div>
<div class="source-line"><span class="line-number ">908</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">909</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">910</span><span class="line-counter cline-yes">&nbsp</span><code>/**</code></div>
<div class="source-line"><span class="line-number ">911</span><span class="line-counter cline-yes">&nbsp</span><code> * Generates a table for multiplying against the hash subkey for one</code></div>
<div class="source-line"><span class="line-number ">912</span><span class="line-counter cline-yes">&nbsp</span><code> * particular component (out of all possible component values).</code></div>
<div class="source-line"><span class="line-number ">913</span><span class="line-counter cline-yes">&nbsp</span><code> *</code></div>
<div class="source-line"><span class="line-number ">914</span><span class="line-counter cline-yes">&nbsp</span><code> * @param mid the pre-multiplied value for the middle key of the table.</code></div>
<div class="source-line"><span class="line-number ">915</span><span class="line-counter cline-yes">&nbsp</span><code> * @param bits the bit size for a component.</code></div>
<div class="source-line"><span class="line-number ">916</span><span class="line-counter cline-yes">&nbsp</span><code> */</code></div>
<div class="source-line"><span class="line-number ">917</span><span class="line-counter cline-yes">&nbsp</span><code>modes.gcm.prototype.generateSubHashTable = function(mid, bits) {</code></div>
<div class="source-line"><span class="line-number ">918</span><span class="line-counter cline-yes">&nbsp</span><code>  // compute the table quickly by minimizing the number of</code></div>
<div class="source-line"><span class="line-number ">919</span><span class="line-counter cline-yes">&nbsp</span><code>  // POW operations -- they only need to be performed for powers of 2,</code></div>
<div class="source-line"><span class="line-number ">920</span><span class="line-counter cline-yes">&nbsp</span><code>  // all other entries can be composed from those powers using XOR</code></div>
<div class="source-line"><span class="line-number ">921</span><span class="line-counter cline-yes">&nbsp</span><code>  var size = 1 &lt;&lt; bits;</code></div>
<div class="source-line"><span class="line-number ">922</span><span class="line-counter cline-yes">&nbsp</span><code>  var half = size &gt;&gt;&gt; 1;</code></div>
<div class="source-line"><span class="line-number ">923</span><span class="line-counter cline-yes">&nbsp</span><code>  var m = new Array(size);</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">924</span><span class="line-counter cline-yes">&nbsp</span><code>  m[half] = mid.slice(0);</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">925</span><span class="line-counter cline-yes">&nbsp</span><code>  var i = half &gt;&gt;&gt; 1;</code></div>
<div class="source-line"><span class="line-number ">926</span><span class="line-counter cline-yes">&nbsp</span><code>  while(i &gt; 0) {</code></div>
<div class="source-line"><span class="line-number ">927</span><span class="line-counter cline-yes">&nbsp</span><code>    // raise m0[2 * i] and store in m0[i]</code></div>
<div class="source-line"><span class="line-number ">928</span><span class="line-counter cline-yes">&nbsp</span><code>    this.pow(m[2 * i], m[i] = []);</code></div>
<div class="source-line"><span class="line-number ">929</span><span class="line-counter cline-yes">&nbsp</span><code>    i &gt;&gt;= 1;</code></div>
<div class="source-line"><span class="line-number ">930</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">931</span><span class="line-counter cline-yes">&nbsp</span><code>  i = 2;</code></div>
<div class="source-line"><span class="line-number ">932</span><span class="line-counter cline-yes">&nbsp</span><code>  while(i &lt; half) {</code></div>
<div class="source-line"><span class="line-number ">933</span><span class="line-counter cline-yes">&nbsp</span><code>    for(var j = 1; j &lt; i; ++j) {</code></div>
<div class="source-line"><span class="line-number ">934</span><span class="line-counter cline-yes">&nbsp</span><code>      var m_i = m[i];</code></div>
<div class="source-line"><span class="line-number ">935</span><span class="line-counter cline-yes">&nbsp</span><code>      var m_j = m[j];</code></div>
<div class="source-line"><span class="line-number ">936</span><span class="line-counter cline-yes">&nbsp</span><code>      m[i + j] = [</code></div>
<div class="source-line"><span class="line-number ">937</span><span class="line-counter cline-yes">&nbsp</span><code>        m_i[0] ^ m_j[0],</code></div>
<div class="source-line"><span class="line-number ">938</span><span class="line-counter cline-yes">&nbsp</span><code>        m_i[1] ^ m_j[1],</code></div>
<div class="source-line"><span class="line-number ">939</span><span class="line-counter cline-yes">&nbsp</span><code>        m_i[2] ^ m_j[2],</code></div>
<div class="source-line"><span class="line-number ">940</span><span class="line-counter cline-yes">&nbsp</span><code>        m_i[3] ^ m_j[3]</code></div>
<div class="source-line"><span class="line-number ">941</span><span class="line-counter cline-yes">&nbsp</span><code>      ];</code></div>
<div class="source-line"><span class="line-number ">942</span><span class="line-counter cline-yes">&nbsp</span><code>    }</code></div>
<div class="source-line"><span class="line-number ">943</span><span class="line-counter cline-yes">&nbsp</span><code>    i *= 2;</code></div>
<div class="source-line"><span class="line-number ">944</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">945</span><span class="line-counter cline-yes">&nbsp</span><code>  m[0] = [0, 0, 0, 0];</code></div>
<div class="source-line"><span class="line-number ">946</span><span class="line-counter cline-yes">&nbsp</span><code>  /* Note: We could avoid storing these by doing composition during multiply</code></div>
<div class="source-line"><span class="line-number ">947</span><span class="line-counter cline-yes">&nbsp</span><code>  calculate top half using composition by speed is preferred. */</code></div>
<div class="source-line"><span class="line-number ">948</span><span class="line-counter cline-yes">&nbsp</span><code>  for(i = half + 1; i &lt; size; ++i) {</code></div>
<div class="source-line"><span class="line-number ">949</span><span class="line-counter cline-yes">&nbsp</span><code>    var c = m[i ^ half];</code></div>
<mark class="issue-line"><div class="source-line"><span class="line-number ">950</span><span class="line-counter cline-yes">&nbsp</span><code>    m[i] = [mid[0] ^ c[0], mid[1] ^ c[1], mid[2] ^ c[2], mid[3] ^ c[3]];</code></div>
</mark><details class="issue-inline-message issue-critical issue-memory-access target-GCM">
                        <summary>💥&nbsp;<i>GCM</i> Secret-dependent memory access</summary>
                <div class="issue-description">[GCM] Found vulnerable memory access instruction, leakage score 100.00% +/- 0%.</div>
            </details><div class="source-line"><span class="line-number ">951</span><span class="line-counter cline-yes">&nbsp</span><code>  }</code></div>
<div class="source-line"><span class="line-number ">952</span><span class="line-counter cline-yes">&nbsp</span><code>  return m;</code></div>
<div class="source-line"><span class="line-number ">953</span><span class="line-counter cline-yes">&nbsp</span><code>};</code></div>
<div class="source-line"><span class="line-number ">954</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">955</span><span class="line-counter cline-yes">&nbsp</span><code>/** Utility functions */</code></div>
<div class="source-line"><span class="line-number ">956</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">957</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">function transformIV(iv, blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">958</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(typeof iv === &#39;string&#39;) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">959</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // convert iv string into byte buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">960</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    iv = forge.util.createBuffer(iv);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">961</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">962</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">963</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(forge.util.isArray(iv) &amp;&amp; iv.length &gt; 4) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">964</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // convert iv byte array into byte buffer</span><span></span></code></div>
<div class="source-line"><span class="line-number ">965</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var tmp = iv;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">966</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    iv = forge.util.createBuffer();</span><span></span></code></div>
<div class="source-line"><span class="line-number ">967</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; tmp.length; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">968</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      iv.putByte(tmp[i]);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">969</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">970</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">971</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">972</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(iv.length() &lt; blockSize) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">973</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    throw new Error(</span><span></span></code></div>
<div class="source-line"><span class="line-number ">974</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      &#39;Invalid IV length; got &#39; + iv.length() +</span><span></span></code></div>
<div class="source-line"><span class="line-number ">975</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      &#39; bytes and expected &#39; + blockSize + &#39; bytes.&#39;);</span><span></span></code></div>
<div class="source-line"><span class="line-number ">976</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">977</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">978</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  if(!forge.util.isArray(iv)) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">979</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    // convert iv byte buffer into 32-bit integer array</span><span></span></code></div>
<div class="source-line"><span class="line-number ">980</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var ints = [];</span><span></span></code></div>
<div class="source-line"><span class="line-number ">981</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    var blocks = blockSize / 4;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">982</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    for(var i = 0; i &lt; blocks; ++i) {</span><span></span></code></div>
<div class="source-line"><span class="line-number ">983</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">      ints.push(iv.getInt32());</span><span></span></code></div>
<div class="source-line"><span class="line-number ">984</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">985</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">    iv = ints;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">986</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  }</span><span></span></code></div>
<div class="source-line"><span class="line-number ">987</span><span class="line-counter cline-no">！</span><code><span class="cstat-no" title="statement not covered"><br/></span><span></span></code></div>
<div class="source-line"><span class="line-number ">988</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">  return iv;</span><span></span></code></div>
<div class="source-line"><span class="line-number ">989</span><span class="line-counter cline-no">！</span><code><span></span><span class="cstat-no" title="statement not covered">}</span><span></span></code></div>
<div class="source-line"><span class="line-number ">990</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">991</span><span class="line-counter cline-yes">&nbsp</span><code>function inc32(block) {</code></div>
<div class="source-line"><span class="line-number ">992</span><span class="line-counter cline-yes">&nbsp</span><code>  // increment last 32 bits of block only</code></div>
<div class="source-line"><span class="line-number ">993</span><span class="line-counter cline-yes">&nbsp</span><code>  block[block.length - 1] = (block[block.length - 1] + 1) &amp; 0xFFFFFFFF;</code></div>
<div class="source-line"><span class="line-number ">994</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>
<div class="source-line"><span class="line-number ">995</span><span class="line-counter cline-yes">&nbsp</span><code></code></div>
<div class="source-line"><span class="line-number ">996</span><span class="line-counter cline-yes">&nbsp</span><code>function from64To32(num) {</code></div>
<div class="source-line"><span class="line-number ">997</span><span class="line-counter cline-yes">&nbsp</span><code>  // convert 64-bit number to two BE Int32s</code></div>
<div class="source-line"><span class="line-number ">998</span><span class="line-counter cline-yes">&nbsp</span><code>  return [(num / 0x100000000) | 0, num &amp; 0xFFFFFFFF];</code></div>
<div class="source-line"><span class="line-number ">999</span><span class="line-counter cline-yes">&nbsp</span><code>}</code></div>

    </div>
    <script>

        const ISSUE_TYPE_CLASSES_OR_NAME = {
			'severity-critical': 'issue-critical',
			'severity-major': 'issue-major',
			'severity-minor': 'issue-minor',
			'issue-type-memory-access': 'issue-memory-access',
			'issue-type-branch': 'issue-branch',
		};
            ISSUE_TYPE_CLASSES_OR_NAME['target-RSASIGN'] = 'target-RSASIGN';
            ISSUE_TYPE_CLASSES_OR_NAME['target-DECODE'] = 'target-DECODE';
            ISSUE_TYPE_CLASSES_OR_NAME['target-ECB'] = 'target-ECB';
            ISSUE_TYPE_CLASSES_OR_NAME['target-RSASIGN'] = 'target-RSASIGN';
            ISSUE_TYPE_CLASSES_OR_NAME['target-GCM'] = 'target-GCM';

		const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        const buttons = document.querySelectorAll('input[type="button"]');

		function change() {
            var elem = document.getElementById('button1');
            const fold = ' Fold leak details ';
            const deploy = ' Deploy leak details ';
            if (elem.innerHTML === deploy) {
                elem.innerHTML = fold;
            } else if (elem.innerHTML === fold) {
                elem.innerHTML = deploy;
            } else {
                console.log(elem.innerHTML);
            }

            const issueSummaries = document.querySelectorAll('details.issue-inline-message' + ' summary');
            const issueSummariesOpen = document.querySelectorAll('details.issue-inline-message[open]' + ' summary');
            const issueSummariesArray = Array.from(issueSummaries);
            const issueSummariesOpenArray = Array.from(issueSummariesOpen);

            if (elem.innerHTML === fold) {
                let issueSummariesClose = [];
                for (let i = 0; i < issueSummariesArray.length; i++) {
                    const issue = issueSummariesArray[i];
                    if (!(issueSummariesOpenArray.includes(issue))) {
                        issueSummariesClose.push(issue);
                    }
                }
                for (let k = 0; k < issueSummariesClose.length; k++) {
		            issueSummariesClose[k].click();
		            for (let i = 0; i < 5 ; i++) {
		                checkboxes[i].checked = true;
            	    }
            	}
            } else if (elem.innerHTML === deploy) {
                for (let k = 0; k < issueSummariesOpen.length; k++) {
	                issueSummariesOpenArray[k].click()
	                for (let i = 0; i < 5 ; i++) { // 5 first checkboxes are Severity and Issue type one, others are for target-name
		                checkboxes[i].checked = false;
            	   }
                }
            } else {
                console.log("error");
            }
        }

        change();

        var lastClick = ["0"];
		for (let i = 0; i < checkboxes.length; i++) {
		    checkboxes[i].addEventListener('change', () => {
// 		        console.log(ISSUE_TYPE_CLASSES_OR_NAME[checkboxes[i].name]);
		        const issueSelector = '.' + ISSUE_TYPE_CLASSES_OR_NAME[checkboxes[i].name];
		        const issueSummaries = document.querySelectorAll('details' + issueSelector + ' > summary');
		        for (let i = 0; i < issueSummaries.length; i++) {
			        issueSummaries[i].click();
			    }
	        });
	   }
       
    </script>
  </body>
</html>